<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/4.8.0/d3.min.js"></script>
    <script src="dist/histogram.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"/>
</head>

<style>
    .change-selection-control {
        margin-left:225px;
    }   

    .zoom-control {
        margin-left:275px;
    }

    .invert-control {
        margin-left:10px;
    }    
</style>

<body>
    <input type="checkbox" class="change-selection-control">Custom Selection</button>
    <input type="checkbox" class="zoom-control">Zoom</button>
    <input type="checkbox" class="invert-control">Invert</button>
    <br>
    <div class="graphs-ct"></div>
    <script>
        // docs: https://github.com/d3/d3-format
        // all locales: https://unpkg.com/d3-format@1.2.0/locale/
        // set cs-CZ locale by default
        d3.formatDefaultLocale({
            "decimal": ",",
            "thousands": " ",
            "grouping": [
                3
            ],
            "currency": [
                "",
                " Kč"
            ]
        });

        // histogram 1 (default selection) ================================================================
        var histogram = new Histogram({
            width:360,
            promptHandler:(value)=>{
                return new Promise((success)=>{
                    var result = prompt("Sample prompt handler", value);
                    if (result !== null) {
                        success(result);
                    }
                })
            },
            height:150
        });

        histogram.render(".graphs-ct");

        d3.json("data/buckets_wrong.json", (json) => {
            histogram.setData(json.content);  
        });

        // simulate invert
        d3.select(".change-selection-control").on("click", function(){
            if (this.checked){
                // custom selection
                histogram.setSelection([
                    {
                        "from": 58,
                        "to": 1801.9222222222222,
                        "color": "#e6f3fb"
                    },
                    {
                        "from": 1801.9222222222222,
                        "to": 3095.7999999999997,
                        "color": "#cbe7f6"
                    },
                    {
                        "from": 3095.7999999999997,
                        "to": 15865.81111111111,
                        "color": "#b1dbf2"
                    },
                    {
                        "from": 15865.81111111111,
                        "to": 18003.522222222222,
                        "color": "#98cfee"
                    },
                    {
                        "from": 18003.522222222222,
                        "to": 20310,
                        "color": "#7ec4ea"
                    }
                ]);
                
            } else {
                // default selection
                histogram.setSelection();
            }
        });            

        histogram.on("selectionOver", (selectionIndex)=>{
            console.log("histogram 1: selectionOver:"+selectionIndex);
        });

        histogram.on("toggleSelection", (selectionIndex, enabled)=>{
            console.log("histogram 1: toggleSelection:"+selectionIndex+", enabled:"+enabled);
        });

        histogram.on("selectionChanged", (selection)=>{
            console.log("histogram 1: selectionChanged:"+JSON.stringify(selection, null, 4));
        });

        histogram.on("handleClick", (handleIndex, handleValue)=>{
            console.log("histogram 1: handleClick: index: "+handleIndex+", value: "+handleValue);
        });

        // histogram 2 (filter) ==================================================================================
        var histogram2 = new Histogram({
            width:360,
            height:150,
            selectionType:Histogram.SelectionTypes.FILTER
        });

        histogram2.render(".graphs-ct");

        d3.json("data/sample.json", (json) => {
            histogram2.setData(json.content, [{
                from:100,
                to:300
            }]);
        });

        histogram2.on("selectionOver", (selectionIndex)=>{
            console.log("histogram 2: selectionOver:"+selectionIndex);
        });

        histogram2.on("toggleSelection", (selectionIndex, enabled)=>{
            console.log("histogram 2: toggleSelection:"+selectionIndex+", enabled:"+enabled);
        });        

        histogram2.on("selectionChanged", (selection)=>{
            console.log("histogram 2: selectionChanged:"+JSON.stringify(selection, null, 4));
        });        

        histogram2.on("handleClick", (handleIndex, handleValue)=>{
            console.log("histogram 2: handleClick:"+handleIndex+", value: "+handleValue);
        });        

        // simulate zoom
        d3.select(".zoom-control").on("click", function(){
            if (this.checked){
                d3.json("data/sample-zoomed.json", (json) => {
                    histogram2.setData(json.content, [{
                        from:1,
                        to:421
                    }]);
                });
            } else {
                d3.json("data/sample.json", (json) => {
                    histogram2.setData(json.content, [{
                        from:100,
                        to:300
                    }]);
                });
            }
        }); 

        // simulate invert
        d3.select(".invert-control").on("click", function(){
            if (this.checked){
                histogram2.setSelectionType(Histogram.SelectionTypes.INVERTED_FILTER);
                
            } else {
                histogram2.setSelectionType(Histogram.SelectionTypes.FILTER);
            }
        });        
    </script>
</body>
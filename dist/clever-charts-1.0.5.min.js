!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.CleverCharts=e(t.d3)}(this,function(t){"use strict";function e(t,e){if("undefined"==typeof document)return e;t=t||"";var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");return n.type="text/css",i.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),e}function i(t,e){return void 0===t?e:t}function n(t,e){return void 0===t?e:t}function r(t,e,i,n){var r=t.getLabelBox(),o=e.getLabelBox(),a=o.x-(r.x+r.width)-i;if(a<0){var s=a/2,l=a/2;r.x+s<0&&(s=r.x,l*=2);var h=o.x+o.width-l;return h>n&&(l+=h-n,s*=2),[s,-l]}return[0,0]}function o(t,e){return void 0===t?e:t}function a(t,e){return void 0===t?e:t}!function(){function t(t){this.value=t}function e(e){function i(r,o){try{var a=e[r](o),s=a.value;s instanceof t?Promise.resolve(s.value).then(function(t){i("next",t)},function(t){i("throw",t)}):n(a.done?"return":"normal",a.value)}catch(t){n("throw",t)}}function n(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}(r=r.next)?i(r.key,r.arg):o=null}var r,o;this._invoke=function(t,e){return new Promise(function(n,a){var s={key:t,arg:e,resolve:n,reject:a,next:null};o?o=o.next=s:(r=o=s,i(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}();var s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function t(e,i,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,i);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(n)},u=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},_=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];s(this,t),this._handlers=e.reduce(function(t,e){return t[e]=[],t},{})}return l(t,[{key:"on",value:function(t,e){if(!(t in this._handlers))throw"No such event: "+t;return this._handlers[t].push(e),this}},{key:"off",value:function(t,e){if(!(t in this._handlers))throw"No such event: "+t;if(e){var i=this._handlers[t],n=i.indexOf(e);-1!=n&&i.splice(n,1)}else this._handlers[t]=[];return this}},{key:"fire",value:function(t){if(!(t in this._handlers))throw"No such event: "+t;for(var e=this._handlers[t],i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var o=0;o<e.length;o++)e[o].apply(this,n);return this}},{key:"destroy",value:function(){return this._handlers=null,this}}]),t}(),d=360,f=43,p="#f0f0f0",v="#ffea00",g="#49ace2",b=!1,m=!1,y=13,x=11,k=function(){function e(t,i){s(this,e),this._barData=this._loadBarData(t,i),this._minMax=this._calculateMinMax(this._barData),this._options=i}return l(e,[{key:"getMinMax",value:function(){return this._minMax}},{key:"getData",value:function(){return this._barData}},{key:"_calculateMinMax",value:function(e){return{min:0,max:t.sum(e,function(t){return t.value})}}},{key:"getPrecision",value:function(){var t=this._minMax.max.toString().split(".");return t.length>1?t[1].length:0}},{key:"_loadBarData",value:function(t){return t.slice()}}]),e}(),E=e("._bar_1bn9y_1 text {\r\n    font-family: Roboto;\r\n}\r\n\r\n._bar_1bn9y_1 {\r\n    \r\n}\r\n\r\n._bar-over_1bn9y_17>._bar-active_1bn9y_17 {\r\n    fill:#ffea00;\r\n}\r\n\r\n._bar-disabled_1bn9y_25>._bar-active_1bn9y_17 {\r\n    fill:#c9c9c9;\r\n}\r\n\r\n._bar-disabled_1bn9y_25>text{\r\n    fill:#cacaca;\r\n}\r\n\r\n._bar-active_1bn9y_17 {\r\n\r\n}\r\n\r\n._bar-inactive_1bn9y_49 {\r\n\r\n}\r\n\r\n._bar-label_1bn9y_57 {\r\n    font-weight: 700;\r\n}\r\n\r\n._bar-tooltip_1bn9y_65 {\r\n    \r\n}\r\n\r\n._bar-hover_1bn9y_73 {\r\n    \r\n}\r\n\r\ng text {\r\n    user-select: none;\r\n}",{bar:"_bar_1bn9y_1","bar-over":"_bar-over_1bn9y_17","bar-active":"_bar-active_1bn9y_17","bar-disabled":"_bar-disabled_1bn9y_25","bar-inactive":"_bar-inactive_1bn9y_49","bar-label":"_bar-label_1bn9y_57","bar-tooltip":"_bar-tooltip_1bn9y_65","bar-hover":"_bar-hover_1bn9y_73"}),S=0,w=function(){function e(t){s(this,e),this._options=t,this._containerEl=null,this._groupEl=null,this._svgEl=null,this._barData=null,this._xAxis=null,this._yAxis=null,this._rendered=!1,this._prevData=null,this._observable=new c(["barOver","barOut","barClick","barDisabled"]),this._maskIndex=S++}return l(e,[{key:"isRendered",value:function(){return this._rendered}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"render",value:function(e){var i=this._containerEl=t.select(e),n=this._options.width,r=this._options.height;return this._svgEl=i.append("svg").attr("width",n).attr("class",E.bar).attr("height",r),this._groupEl=this._svgEl.append("g"),this._clipPath=this._svgEl.append("clipPath").attr("id","rounded-corners-"+this._maskIndex).append("rect").attr("y",this._options.labelFontSize+10).attr("rx",2.5).attr("ry",2.5).attr("width",this._options.width).attr("height",5),this._rendered=!0,this}},{key:"_clear",value:function(){this._groupEl.node().innerHTML=""}},{key:"setData",value:function(e){this._barData=e,this._clear();var i=e.getData(),n=e.getMinMax(),r=this._options.barHeight,o=i.length*r;return this._xAxis=t.scaleLinear().range([0,this._options.width]),this._yAxis=t.scaleBand().range([o,0]),this._svgEl.attr("height",o),this._xAxis.domain([0,n.max]),this._yAxis.domain(i.map(function(t,e){return e}).reverse()),this._renderDataBars(i),this._prevData=e.getData(),this}},{key:"_renderDataBars",value:function(e){var i=this,n=this._xAxis,r=this._yAxis,o=this._observable,a=this._options,s=this._groupEl.selectAll("."+E.bar).data(e).enter().append("g").attr("class",E.bar);s.attr("transform",function(t,e){return"translate(0,"+Math.floor(r(e))+")"}).classed(E["bar-over"],function(t){return t.highlighted}).on("mouseover",function(e,i){a.enableBarHover&&(t.select(this).classed(E["bar-over"],!0),o.fire("barOver",i))}).on("mouseout",function(e,i){a.enableBarHover&&(t.select(this).classed(E["bar-over"],!1),o.fire("barOut",i))}).on("click",function(e,i){if(a.enableBarToggle){var n=!t.select(this).classed(E["bar-disabled"]);t.select(this).classed(E["bar-disabled"],n),o.fire("barDisabled",i,n)}o.fire("barClick",i)}),s.classed(E["bar-disabled"],function(t){return t.disabled}),s.append("text").text(function(t){return t.label}).attr("class",E["bar-label"]).attr("x",10).attr("font-size",this._options.labelFontSize).attr("y",this._options.labelFontSize),s.append("text").text(function(t){return t.tooltip||i._options.format(t.value)}).attr("class",E["bar-tooltip"]).attr("x",this._options.width-10).attr("text-anchor","end").attr("font-size",this._options.valueFontSize).attr("y",this._options.labelFontSize),s.append("rect").attr("fill",function(t){return t.color||g}).attr("class",E["bar-active"]).attr("x",0).attr("clip-path","url(#rounded-corners-"+this._maskIndex+")").attr("width",function(t){return Math.floor(n(t.value))}).attr("y",this._options.labelFontSize+10).attr("height",5),s.append("rect").attr("fill",p).attr("class",E["bar-inactive"]).attr("clip-path","url(#rounded-corners-"+S+")").attr("x",function(t){return Math.floor(n(t.value))}).attr("width",function(t){return i._options.width-Math.floor(n(t.value))}).attr("y",this._options.labelFontSize+10).attr("height",5),s.append("rect").attr("class",E["bar-hover"]).attr("fill","transparent").attr("x",0).attr("text-anchor","end").attr("cursor",function(){return i._options.enableBarHover?"pointer":"default"}).attr("y",0).attr("height",this._options.barHeight).attr("width",this._options.width)}},{key:"destroy",value:function(){return this._rendered&&this._containerEl.node().removeChild(this._svgEl.node()),this._observable.destroy(),this}}]),e}(),D=function(){function e(t){var n=this;s(this,e),this._options={},this._options.width=i(t.width,d),this._options.barHeight=i(t.barHeight,f),this._options.format=i(t.format,null),this._options.labelFontSize=i(t.labelFontSize,y),this._options.valueFontSize=i(t.valueFontSize,x),this._options.inactiveBarColor=i(t.inactiveBarColor,p),this._options.overBarColor=i(t.overBarColor,v),this._options.activeBarColor=i(t.activeBarColor,g),this._options.enableBarToggle=i(t.enableBarToggle,b),this._options.enableBarHover=i(t.enableBarHover,m),this._observable=new c(["barOver","barOut","barClick","barDisabled"]),this._barRenderer=new w(this._options),this._barRenderer.on("barOver",function(t){n._observable.fire("barOver",t)}),this._barRenderer.on("barOut",function(t){n._observable.fire("barOut",t)}),this._barRenderer.on("barClick",function(t){n._observable.fire("barClick",t)}),this._barRenderer.on("barDisabled",function(t,e){n._observable.fire("barDisabled",t,e)})}return l(e,[{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"off",value:function(t,e){return this._observable.off(t,e),this}},{key:"destroy",value:function(){return this._observable.destroy(),this._barRenderer.destroy(),this._options=null,this}},{key:"render",value:function(t){return this._barRenderer.render(t),this}},{key:"setData",value:function(e){if(!this._barRenderer.isRendered())throw"Can't call setData() when widget is not rendered, please call .render() first.";var i=this._barData=new k(e,this._options);return this._options.format?"string"==typeof this._options.format&&(this._options.format=t.format(this._options.format)):this._options.format=t.format(",."+this._barData.getPrecision()+"f"),this._barRenderer.setData(i),this}}]),e}(),L=10,M=10,C=0,T="#49ace2",O="#F0F0F0",R="transparent",H=250,A=e("._svg_fm7vm_1 {\r\n    \r\n}\r\n\r\n._doughnut_fm7vm_9 {\r\n    \r\n}\r\n\r\n._arc_fm7vm_17 {\r\n    \r\n}",{svg:"_svg_fm7vm_1",doughnut:"_doughnut_fm7vm_9",arc:"_arc_fm7vm_17"}),P=2*Math.PI,j=function(){function e(t){s(this,e),this._options=t,this._containerEl=null,this._groupEl=null,this._svgEl=null,this._rendered=!1,this._observable=new c(["mouseOver","mouseOut"])}return l(e,[{key:"isRendered",value:function(){return this._rendered}},{key:"render",value:function(e){var i=this,n=this._containerEl=t.select(e),r=this._containerEl.node().offsetWidth,o=this._containerEl.node().offsetHeight,a=this._value=this._options.value,s=this._angle=a/100*P,l=this._innerRadius=this._options.innerRadius,h=this._outerRadius=this._options.outerRadius,u=this._arc=t.arc().innerRadius(l).outerRadius(h).startAngle(0);this._svgEl=n.append("svg").attr("width",r).attr("height",o).attr("class",A.svg);var _=this._groupEl=this._svgEl.append("g").attr("class",A.doughnut).attr("transform","translate("+r/2+", "+o/2+")");return this._inactiveArc=_.append("path").datum({endAngle:P}).attr("fill",this._options.inactiveColor).attr("d",u),this._activeArc=_.append("path").datum({endAngle:s}).attr("fill",this._options.activeColor).attr("d",u),this._backgroundArc=_.append("circle").attr("fill",this._options.backgroundColor).attr("r",l).attr("cx",0).attr("cy",0),this._backgroundArc=_.append("circle").attr("fill",this._options.backgroundColor).attr("r",l).attr("cx",0).attr("cy",0),this._hoverEl=_.append("rect").attr("fill","transparent").attr("x",-r/2).attr("y",-o/2).attr("width",r).attr("height",o),_.on("mouseover",function(){i._observable.fire("mouseOver")}),_.on("mouseout",function(){i._observable.fire("mouseOut")}),this._rendered=!0,this}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"off",value:function(t,e){return this._observable.off(t,e),this}},{key:"update",value:function(t){var e=this,i=t||{};void 0===i.value?i.value=this._value:this._value=i.value;var n=this._activeArc.transition().duration(this._options.animationDuration).attrTween("d",this._arcTween(i,!0));return this._inactiveArc.transition().duration(this._options.animationDuration).attrTween("d",function(){return function(){return e._arc({endAngle:P})}}),this._backgroundArc.transition().duration(this._options.animationDuration).attrTween("r",function(){return function(){return e._innerRadius}}),i.activeColor&&i.activeColor!==this._options.activeColor&&(this._options.activeColor=i.activeColor,n.attr("fill",i.activeColor)),this}},{key:"_arcTween",value:function(e){var i=this,n=e.value/100*P;void 0!==e.value&&(n=e.value/100*P);var r=this._innerRadius,o=this._outerRadius;void 0!==e.innerRadius&&(r=e.innerRadius),void 0!==e.outerRadius&&(o=e.outerRadius);var a=t.interpolate(this._outerRadius,o),s=t.interpolate(this._innerRadius,r);return function(e){var r=t.interpolate(e.endAngle,n);return function(t){return i._arc.outerRadius(i._outerRadius=a(t)),i._arc.innerRadius(i._innerRadius=s(t)),e.endAngle=i._angle=r(t),i._arc(e)}}}},{key:"destroy",value:function(){return this._rendered&&this._containerEl.node().removeChild(this._svgEl.node()),this._observable.destroy(),this}}]),e}(),B=function(){function t(e){var i=this;s(this,t),this._options={},this._options.outerRadius=n(e.outerRadius,L),this._options.innerRadius=n(e.innerRadius,M),this._options.activeColor=n(e.activeColor,T),this._options.inactiveColor=n(e.inactiveColor,O),this._options.backgroundColor=n(e.backgroundColor,R),this._options.value=n(e.value,C),this._options.animationDuration=n(e.animationDuration,H),this._options.renderTo=n(e.renderTo,null),this._observable=new c(["mouseOver","mouseOut"]),this._doughnutRenderer=new j(this._options),this._doughnutRenderer.on("mouseOver",function(){i._observable.fire("mouseOver")}),this._doughnutRenderer.on("mouseOut",function(){i._observable.fire("mouseOut")}),e.renderTo&&this.render(e.renderTo)}return l(t,[{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"off",value:function(t,e){return this._observable.off(t,e),this}},{key:"destroy",value:function(){return this._observable.destroy(),this._doughnutRenderer.destroy(),this._options=null,this}},{key:"render",value:function(t){return this._doughnutRenderer.render(t),this}},{key:"update",value:function(t){if(!this._doughnutRenderer.isRendered())throw"Can't call update() when widget is not rendered, please call .render() first.";return this._doughnutRenderer.update(t),this}}]),t}(),q=360,z=150,I={top:0,left:5,right:5,bottom:15},F="#f0f0f0",G=1,V="#ffea00",N=1,X="#49ace2",W=!0,U=11,Z=["#e6f3fb","#cbe7f6","#b1dbf2","#98cfee","#7ec4ea"],J=function(){function e(t,i){s(this,e),this._histogramData=this._loadHistogramData(t,i.width),this._minMax=this._calculateMinMax(this._histogramData),this._options=i}return l(e,[{key:"getMinMax",value:function(){return this._minMax}},{key:"getData",value:function(){return this._histogramData}},{key:"_calculateMinMax",value:function(e){return{min:t.min(e,function(t){return t.value}),max:t.max(e,function(t){return t.value})}}},{key:"getValueRatio",value:function(){return(this._minMax.max-this._minMax.min)/this._options.width}},{key:"positionToValue",value:function(t){var e=this.getMinMax();return 0===t?e.min:t===this._options.width?e.max:t*this.getValueRatio()+e.min}},{key:"valueToPosition",value:function(t){var e=this.getValueRatio(),i=this.getMinMax(),n=Math.min(Math.max(t,i.min),i.max);return Math.round(n/e-i.min/e)}},{key:"_loadHistogramData",value:function(e,i){var n=[],r=(i-1)/e.length;return e.forEach(function(i,o){var a=(i.max-i.min)/r;t.range(i.min,i.max,a).forEach(function(t){n.push({value:t,volume:i.volume})}),o==e.length-1&&n.push({value:i.max,volume:i.volume})}),n}}]),e}(),K=e("._histogram_jlgqn_1 text {\r\n    font-family: Roboto;\r\n}\r\n\r\n._bar_jlgqn_9 {\r\n\r\n}\r\n\r\ng {\r\n    border:1px solid #eeeeee;\r\n}\r\n\r\ng ._selectionbar_jlgqn_25 {\r\n    cursor:default;\r\n}\r\n\r\n._x-axis_jlgqn_33>path {\r\n    stroke: #F1F1F1;\r\n}\r\n\r\n._x-axis_jlgqn_33 {\r\n    border:0;\r\n}\r\n\r\ng > text {\r\n    user-select: none;\r\n}\r\n\r\n._x-axis_jlgqn_33>._tick_jlgqn_57>text {\r\n    fill:#7d7d7d;\r\n}\r\n\r\ng._active_jlgqn_65 ._custom-handle-circle_jlgqn_65 {\r\n    stroke:#4a4a4a;\r\n}\r\n\r\ng._inactive_jlgqn_73:not(._dragging_jlgqn_73) ._custom-handle-circle_jlgqn_65 {\r\n    stroke:#bababa;\r\n    r:2.5;\r\n}\r\n\r\ng._inactive_jlgqn_73._dragging_jlgqn_73 ._custom-handle-circle_jlgqn_65 {\r\n    stroke:#4a4a4a;\r\n}    \r\n\r\ng._brush-drag_jlgqn_91 ._custom-handle-circle_jlgqn_65 {\r\n    stroke:#4a4a4a;\r\n}    \r\n\r\n._custom-handle-circle_jlgqn_65 {\r\n    transition: r 0.1s ease-out;\r\n    pointer-events: none;\r\n}\r\n\r\n._brush-axis-line_jlgqn_109 {\r\n    stroke:#4a4a4a;\r\n    display: none;\r\n    stroke-width: 1px;\r\n}\r\n\r\n._custom-handle-line_jlgqn_121 {\r\n    stroke-width:0;\r\n    fill:#4A4A4A;\r\n    pointer-events: none;\r\n}\r\n\r\n._handle_jlgqn_133 {\r\n    transition: all 0.05s ease-out;\r\n}\r\n\r\n._brush_jlgqn_91>._selection_jlgqn_25 {\r\n    fill: rgba(0, 0, 0, 0);\r\n    stroke: transparent;\r\n    cursor: grab;\r\n    cursor: -webkit-grab;\r\n    cursor: -moz-grab;\r\n}\r\n\r\n._brush_jlgqn_91>._overlay_jlgqn_157._grabbing_jlgqn_157,\r\n._brush_jlgqn_91>._selection_jlgqn_25._grabbing_jlgqn_157 {\r\n    cursor: grabbing ;\r\n    cursor: -webkit-grabbing ;\r\n    cursor: -moz-grabbing ;\r\n}\r\n\r\n._custom-handle_jlgqn_65 {\r\n\r\n}\r\n\r\n._drag-label_jlgqn_179 {\r\n    fill:#4A4A4A;\r\n}",{histogram:"_histogram_jlgqn_1",bar:"_bar_jlgqn_9",selectionbar:"_selectionbar_jlgqn_25","x-axis":"_x-axis_jlgqn_33",tick:"_tick_jlgqn_57",active:"_active_jlgqn_65","custom-handle-circle":"_custom-handle-circle_jlgqn_65",inactive:"_inactive_jlgqn_73",dragging:"_dragging_jlgqn_73","brush-drag":"_brush-drag_jlgqn_91","brush-axis-line":"_brush-axis-line_jlgqn_109","custom-handle-line":"_custom-handle-line_jlgqn_121",handle:"_handle_jlgqn_133",brush:"_brush_jlgqn_91",selection:"_selection_jlgqn_25",overlay:"_overlay_jlgqn_157",grabbing:"_grabbing_jlgqn_157","custom-handle":"_custom-handle_jlgqn_65","drag-label":"_drag-label_jlgqn_179"}),Q=0,Y=function(){function e(t,i,n,r,o){s(this,e),this._observable=new c(["drag","startDrag","endDrag"]),this._handleEl=null,this._handleLineEl=null,this._handleCircleEl=null,this._handleMaskEl=null,this._handleMaskGradientEl=null,this._handleLabelEl=null,this._isOver=!1,this._groupEl=t,this._index=n,this._value=i,this._initialValue=new Number(i),this._position=r.valueToPosition(i),this._initialPosition=new Number(this._position),this._options=o,this._histogramData=r,this._labelSizeCache={},this._elements=[],this._renderHandle()}return l(e,[{key:"destroy",value:function(){this._elements.forEach(function(t){return t.remove()}),this._elements=[]}},{key:"_renderHandle",value:function(){this._elements=[this._createHandleElement(),this._createHandleLineElement(),this._createHandleCircleElement(),this._createDragMaskElement(),this._createMaskGradientElement(),this._createDragLabelElement()],this._handleHoverState(),this._handleDrag()}},{key:"hide",value:function(){this._elements.forEach(function(t){return t.attr("visibility","hidden")})}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"getXPosition",value:function(){return parseInt(this._handleEl.attr("x"))+2}},{key:"setHoverState",value:function(){this._handleLineEl.attr("fill-opacity",1),this._handleLabelEl.attr("fill-opacity",1),this._handleMaskEl.attr("display","block"),this._handleCircleEl.attr("stroke-width",3),this._updateLabelPosition(this._position)}},{key:"getLabelBox",value:function(){return this._handleLabelEl.node().getBBox()}},{key:"setLabelOffset",value:function(t){this._handleLabelEl.attr("transform","translate("+t+", 0)"),this._handleMaskEl.attr("transform","translate("+t+", 0)"),this._updateLabelPosition(this._position)}},{key:"setHandleXPosition",value:function(t){return this._handleCircleEl.attr("transform","translate("+t+", "+this._options.height+")"),this}},{key:"setLabelText",value:function(t){return this._handleLabelEl.text(t),this}},{key:"showLabel",value:function(){return this._handleLabelEl.attr("fill-opacity",1),this._handleMaskEl.attr("display","block"),this}},{key:"hideLabel",value:function(){return this._handleLabelEl.attr("fill-opacity",0),this._handleMaskEl.attr("display","none"),this}},{key:"setLabelPosition",value:function(t){return this.setLabelOffset(0),this._updateLabelPosition(t),this}},{key:"unsetHoverState",value:function(){this._handleLineEl.attr("fill-opacity",0),this._handleLabelEl.attr("fill-opacity",0),this._handleMaskEl.attr("display","none"),this._handleCircleEl.attr("stroke-width",1),this._handleLabelEl.attr("transform","translate(0, 0)"),this._handleMaskEl.attr("transform","translate(0, 0)")}},{key:"enable",value:function(){this._elements.forEach(function(t){return t.attr("pointer-events","all")})}},{key:"disable",value:function(){this._elements.forEach(function(t){return t.attr("pointer-events","none")})}},{key:"_handleHoverState",value:function(){var t=this;this._handleEl.on("mouseover",function(){t._isOver=!0,t.setHoverState()}),this._handleEl.on("mouseout",function(){t._isOver=!1,t.unsetHoverState()})}},{key:"_onStartDrag",value:function(){this._groupEl.classed(K.dragging,!0),this._observable.fire("startDrag",this)}},{key:"_onDrag",value:function(){var e=this._options.width,i=this._options.height,n=Math.round(Math.max(Math.min(t.event.x,e),0));this._handleEl.attr("x",n-2),this._handleLineEl.attr("x",n-2),this._handleCircleEl.attr("transform","translate("+n+","+i+")"),this._handleEl.attr("data-handle-value",this._histogramData.positionToValue(n)),this.setHoverState(),this._position=n,parseInt(this._position)!==parseInt(this._initialPosition)?this._value=this._histogramData.positionToValue(n):this._value=this._initialValue,this._handleLabelEl.text(this._getLabelText()),this._updateLabelPosition(n),this._observable.fire("drag")}},{key:"_getLabelText",value:function(){return this._options.format(this._value)}},{key:"_onEndDrag",value:function(){this._groupEl.classed(K.dragging,!1),this._isOver||this.unsetHoverState(),this._observable.fire("endDrag",this)}},{key:"_handleDrag",value:function(){this._handleEl.call(t.drag().on("drag",this._onDrag.bind(this)).on("start",this._onStartDrag.bind(this)).on("end",this._onEndDrag.bind(this)))}},{key:"_getComputedLabelTextLength",value:function(t){var e=t.innerHTML;return this._labelSizeCache[e]=this._labelSizeCache[e]||t.getComputedTextLength(),this._labelSizeCache[e]}},{key:"_updateLabelPosition",value:function(t){var e=this._handleLabelEl.node(),i=this._options.fontSize,n=this._getComputedLabelTextLength(e),r=n+2*i,o=t-n/2;o<0&&(o=0),o+n>this._options.width?(o=this._options.width-n,this._handleLabelEl.attr("x",this._options.width),this._handleLabelEl.attr("text-anchor","end")):(this._handleLabelEl.attr("x",o),this._handleLabelEl.attr("text-anchor","start")),this._handleMaskEl.attr("x",function(){return parseInt(o)-i}),this._handleMaskGradientEl.attr("x1",o-i),this._handleMaskGradientEl.attr("x2",o+r-i),this._handleMaskEl.attr("width",r),this._handleMaskEl.attr("height",this._options.fontSize)}},{key:"_createMaskGradientElement",value:function(){return this._handleMaskGradientEl=this._groupEl.append("linearGradient").attr("id","brush-mask-gradient-"+Q++).attr("gradientUnits","userSpaceOnUse").attr("y1",0).attr("x1",50).attr("y2",0).attr("x2",0),this._handleMaskGradientEl.selectAll("stop").data([{offset:"0%",color:"rgba(255,255,255,0)"},{offset:"20%",color:"rgba(255,255,255,1)"},{offset:"80%",color:"rgba(255,255,255,1)"},{offset:"100%",color:"rgba(255,255,255,0)"}]).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}),this._handleMaskGradientEl}},{key:"_createHandleElement",value:function(){return this._handleEl=this._groupEl.append("rect").attr("class",K["custom-handle"]).attr("fill-opacity",0).attr("data-handle-index",this._index).attr("data-handle-value",this._value).attr("cursor","ew-resize").attr("width",4).attr("height",this._options.height+5).attr("x",this._position-2),this._handleEl}},{key:"_createHandleLineElement",value:function(){return this._handleLineEl=this._groupEl.append("rect").attr("class",K["custom-handle-line"]).attr("width",4).attr("height",this._options.height).attr("fill-opacity",0).attr("x",this._position-2),this._handleLineEl}},{key:"_createHandleCircleElement",value:function(){return this._handleCircleEl=this._groupEl.append("circle").attr("class",K["custom-handle-circle"]).attr("transform","translate("+this._position+","+this._options.height+")").attr("fill","#ffffff").attr("fill-opacity",1).attr("stroke","#000").attr("stroke-width",1).attr("cursor","ew-resize").attr("r",3.5),this._handleCircleEl}},{key:"_createDragMaskElement",value:function(){return this._handleMaskEl=this._groupEl.append("rect").attr("class",K["drag-label-mask"]).attr("fill","url(#brush-mask-gradient-"+Q+")").attr("y",this._options.height+7).attr("display","none"),this._handleMaskEl}},{key:"_createDragLabelElement",value:function(){var t=this,e=this._options.format,i=this._options.height;return this._handleLabelEl=this._groupEl.append("text").attr("class",K["drag-label"]).attr("fill-opacity",0).attr("font-size",this._options.fontSize).text(function(){return e(t._initialValue)}).attr("y",i+this._options.fontSize+7),this._updateLabelPosition(this._position),this._handleLabelEl}}]),e}(),$=function(){function e(t){s(this,e),this._options=t,this._groupEl=null,this._histogramData=null,this._histogramSelection=null,this._overSelectionIndex=null,this._rendered=!1,this._handles=[],this._draggingHandle=!1,this._prevSelection=null,this._rendered=!1,this._animating=!1,this._observable=new c(["selectionOver","toggleSelection","selectionChanged","handleClick"])}return l(e,[{key:"isRendered",value:function(){return this._rendered}},{key:"render",value:function(t){return this._rendered=!0,this._groupEl=t,this}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"_clear",value:function(){this._destroyHandles(),this._selectionBars&&this._selectionBars.remove()}},{key:"_destroyHandles",value:function(){this._handles.forEach(function(t){return t.destroy()}),this._handles=[]}},{key:"_onHandleClick",value:function(t,e){var i=this;this._options.promptHandler&&this._options.promptHandler(e).then(function(e){var n=JSON.stringify(i._histogramSelection.getOutputSelection());e=parseFloat(e);var r=i._histogramData.getMinMax();e=Math.min(r.max,e),e=Math.max(r.min,e);var o=i._histogramSelection.getSelectionPoints();o[t]={value:e};var a=o.sort(function(t,e){return t.value-e.value}).map(function(t){return i._histogramData.valueToPosition(t.value)});i._updateSelectionPositions(a,o),i._updateSelection(),i._destroyHandles(),i._renderHandles(),JSON.stringify(i._options.selection)!=n&&i._observable.fire("selectionChanged",i._histogramSelection.getOutputSelection())}),this._observable.fire("handleClick",t,e)}},{key:"_toggleSelection",value:function(t){var e=this._options.selection[t];e.disabled=!e.disabled;var i=!e.disabled;this._updateSelection(),this._observable.fire("toggleSelection",t,i)}},{key:"_onClick",value:function(){var e=t.select(t.event.target),i=e.attr("data-selection-index"),n=e.attr("data-handle-index");null!=i&&this._histogramSelection.allowsToggle()?this._toggleSelection(i):null!=n&&this._onHandleClick(n,e.attr("data-handle-value"))}},{key:"_handleClick",value:function(){this._groupEl.on("click",this._onClick.bind(this))}},{key:"refresh",value:function(t,e,i){return this._animate=i&&i.animate,this._animate&&this._histogramSelection&&this._histogramSelection.getSelection().length==e.getSelection().length&&(this._prevSelection=this._histogramSelection.getSelection(),this._prevHistogramData=this._histogramSelection.getSelection()),this._animate&&this._histogramData&&(this._prevHistogramData=this._histogramData),this._histogramData=t,this._histogramSelection=e,this._clear(),this._renderSelection(),this._updateSelection(),this._handleHoverState(),this._handleClick(),this}},{key:"_updateSelectionControlsHoverState",value:function(t){var e=this._handles.slice().sort(function(t,e){return t.getXPosition()-e.getXPosition()});if(e.forEach(function(t){return t.unsetHoverState()}),null!=t){var i=e[t],n=e[t+1];i.setHoverState(),n.setHoverState();var o=r(i,n,this._options.fontSize,this._options.width);i.setLabelOffset(o[0]),n.setLabelOffset(o[1])}}},{key:"_onSelectionMouseOver",value:function(e,i,n){if(!this._draggingHandle){t.select(n[i]).attr("fill","rgba(0,0,0,0.00)");var r=parseInt(t.select(t.event.target).attr("data-selection-index"));this._overSelectionIndex!=r&&(this._overSelectionIndex=r,this._updateSelection(),this._updateSelectionControlsHoverState(r),this._observable.fire("selectionOver",this._overSelectionIndex))}}},{key:"_onSelectionMouseOut",value:function(e,i,n){this._draggingHandle||(t.select(n[i]).attr("fill","rgba(0,0,0,0)"),this._overSelectionIndex=null,this._updateSelectionControlsHoverState(null),this._updateSelection(),this._observable.fire("selectionOver",this._overSelectionIndex))}},{key:"_handleHoverState",value:function(){var t=this._groupEl;t.selectAll("."+K.selectionbar).on("mouseout",this._onSelectionMouseOut.bind(this)),t.selectAll("."+K.selectionbar).on("mouseover",this._onSelectionMouseOver.bind(this))}},{key:"_onHandleDrag",value:function(){var t=this._handles.map(function(t){return t.getXPosition()}).sort(function(t,e){return t-e});this._updateSelectionPositions(t),this._updateSelection()}},{key:"_updateSelectionPositions",value:function(t,e){var i=this,n=this._histogramSelection.getSelection();t.forEach(function(r,o){if(!(o>n.length-1)){var a={from:r,to:t[o+1]},s={from:e?e[o].value:i._histogramData.positionToValue(a.from),to:e?e[o+1].value:i._histogramData.positionToValue(a.to)};["from","to"].forEach(function(t){(e?n[o][t]!==s[t]:n[o].position[t]!==a[t])&&(n[o][t]=s[t],n[o].position[t]=a[t])})}})}},{key:"_renderSelection",value:function(){var t=this._options.height,e=this._histogramSelection.getSelection();this._selectionBars=this._groupEl.selectAll("."+K.selectionbar).data(e).enter().append("rect").attr("class",K.selectionbar).attr("y",0).attr("fill","rgba(0,0,0,0.00)").attr("height",t),this._renderHandles()}},{key:"_renderHandles",value:function(){var t=this;this._handles=this._histogramSelection.getSelectionPoints().map(function(e,i){var n=e.value,r=new Y(t._groupEl,n,i,t._histogramData,t._options);e.hidden&&r.hide(),r.on("drag",function(){t._onHandleDrag()},t);var o;return r.on("startDrag",function(){o=JSON.stringify(t._options.selection),t._draggingHandle=!0,t._handles.forEach(function(t){return t.disable()}),r.enable()},t),r.on("endDrag",function(){t._draggingHandle=!1,t._handles.forEach(function(t){return t.enable()}),JSON.stringify(t._options.selection)!=o&&t._observable.fire("selectionChanged",t._histogramSelection.getOutputSelection())},t),r})}},{key:"_getBarSelectionIndex",value:function(t,e,i){for(var n=0;n<e.length;n++){var r=e[n],o=n==e.length-1;if(t>=i.valueToPosition(r.from)&&(t<i.valueToPosition(r.to)||o&&t<=i.valueToPosition(r.to)))return n}return null}},{key:"_getBarColor",value:function(t,e,i){var n=this._options.inactiveBarColor,r=this._options.overSelectionColor,o=this._getBarSelectionIndex(t,e,i);return null==o?n:e[o].disabled?n:this._histogramSelection.allowsToggle()&&this._overSelectionIndex==o?r:e[o].color||this._options.selectionColor}},{key:"_getBarOpacity",value:function(t,e,i){var n=this._getBarSelectionIndex(t,e,i),r=this._histogramSelection.allowsToggle()&&this._overSelectionIndex==n,o=null!=n&&e[n].disabled;return r?this._options.overSelectionOpacity:o?this._options.inactiveBarOpacity:null!=n&&null!=e[n].opacity?e[n].opacity:1}},{key:"_onSelectionTransition",value:function(t,e,i,n,r,o){var a=this;t.forEach(function(s,l){var h=e[l],u=a._options.width;if(t[l]){var _=[],c=[];_.push([Math.round(i.valueToPosition(s.from)),Math.round(n.valueToPosition(h.from))]),_.push([Math.round(i.valueToPosition(s.to)),Math.round(n.valueToPosition(h.to))]),c=[Math.abs((_[0][0]-_[0][1])/u),Math.abs((_[1][0]-_[1][1])/u)],_.forEach(function(t,e){for(var i=0;t[0]!==t[1];)setTimeout(r.bind(a,t[0],l,e),i),i+=.5/c[e],t[0]=t[0]>t[1]?t[0]-1:t[0]+1;i>0&&setTimeout(function(t,e,i){r(t,e,i),o(t,e,i)}.bind(a,t[1],l,e),++i)})}})}},{key:"_updateSelection",value:function(){var e=this,i=this._histogramSelection.getSelection(),n=this._groupEl.selectAll("."+K.bar),r=function(t,i){n.attr("fill",function(n){var r=e._histogramData.valueToPosition(n.value);return e._getBarColor(r,t,i)}),n.attr("fill-opacity",function(n){var r=e._histogramData.valueToPosition(n.value);return e._getBarOpacity(r,t,i)})};if(this._animate&&this._prevSelection){var o=this._prevSelection,a=this._prevHistogramData;r(o,this._prevHistogramData),o.forEach(function(t,i){var n=e._prevHistogramData.valueToPosition(t.from),r=e._prevHistogramData.valueToPosition(t.to);e._handles[i].setHandleXPosition(n).setLabelPosition(n),e._handles[i+1].setHandleXPosition(r).setLabelPosition(r)}),this._animating=!0,this._onSelectionTransition(o,i,a,this._histogramData,function(r,o,a){var s=t.select(n.nodes()[r]),l=e._getBarColor(r,i,e._histogramData);s.attr("fill",l),[e._handles[o],e._handles[o+1]][a].setHandleXPosition(r).setLabelPosition(r)},function(){r(i,e._histogramData),e._animating=!1}),this._prevSelection=null,this._prevHistogramData=null}else r(i,this._histogramData);this._groupEl.selectAll("."+K.selectionbar).data(i).attr("data-selection-index",function(t,e){return e}).attr("x",function(t){return e._histogramData.valueToPosition(t.from)}).attr("width",function(t){return e._histogramData.valueToPosition(t.to)-e._histogramData.valueToPosition(t.from)})}},{key:"showSelectionLabels",value:function(){var t=this;if(this._animating)return this._handles.forEach(function(t){return t.showLabel()});this._histogramSelection.getSelection().forEach(function(e,i){var n=t._handles[i],o=t._handles[i+1],a=r(n,o,t._options.fontSize,t._options.width);n.setLabelOffset(a[0]),o.setLabelOffset(a[1])}),this._handles.forEach(function(t){return t.showLabel()})}},{key:"hideSelectionLabels",value:function(){this._handles.forEach(function(t){return t.hideLabel()})}},{key:"destroy",value:function(){return this._observable.destroy(),this._clear(),this}}]),e}(),tt=function(){function e(i){var n=this;s(this,e),this._options=i,this._containerEl=null,this._groupEl=null,this._svgEl=null,this._historyData=null,this._xAxis=t.scaleBand().range([0,i.width]),this._yAxis=t.scaleLinear().range([i.height,0]),this._rendered=!1,this._prevData=null,this._selectionRenderer=new $(i),this._labelsVisible=!1,this._observable=new c(["selectionOver","toggleSelection","selectionChanged","handleClick"]),this._selectionRenderer.on("selectionOver",function(t){n._observable.fire("selectionOver",t)}),this._selectionRenderer.on("toggleSelection",function(t,e){n._observable.fire("toggleSelection",t,e)}),this._selectionRenderer.on("selectionChanged",function(t){n._observable.fire("selectionChanged",t)}),this._selectionRenderer.on("handleClick",function(t,e){n._observable.fire("handleClick",t,e)})}return l(e,[{key:"isRendered",value:function(){return this._rendered}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"render",value:function(e){var i=this._containerEl=t.select(e),n=this._options.width,r=this._options.height,o=I,a=this._svgEl=i.append("svg").attr("width",n+o.left+o.right).attr("height",r+o.top+this._options.fontSize+o.bottom).classed(K.histogram,!0),s=this._groupEl=this._svgEl.append("g").classed(K.inactive,!0).attr("transform","translate("+o.left+","+o.top+")");return a.on("mouseover.hover",function(){s.classed(K.active,!0),s.classed(K.inactive,!1)}),a.on("mouseout.hover",function(){s.classed(K.inactive,!0),s.classed(K.active,!1)}),this._selectionRenderer.render(s),this._rendered=!0,this}},{key:"_clear",value:function(){this._groupEl.node().innerHTML=""}},{key:"refresh",value:function(e,i,n){return this._animate=n&&n.animate,this._histogramData=e,this._clear(),this._xAxis.domain(e.getData().map(function(t){return t.value})),this._yAxis.domain([0,t.max(e.getData(),function(t){return t.volume})]),this._renderXAxis(),this._renderDataBars(),this._prevData=e.getData(),this._selectionRenderer.refresh(e,i,n),this._labelsVisible&&this.showSelectionLabels(),this}},{key:"showSelectionLabels",value:function(){this._selectionRenderer.showSelectionLabels(),this._groupEl.selectAll("."+K["x-axis"]).attr("display","none"),this._labelsVisible=!0}},{key:"hideSelectionLabels",value:function(){this._selectionRenderer.hideSelectionLabels(),this._groupEl.selectAll("."+K["x-axis"]).attr("display","block"),this._labelsVisible=!1}},{key:"_renderDataBars",value:function(){var t=this,e=this._histogramData.getData(),i=this._options.height,n=this._yAxis;this._groupEl.selectAll("."+K.bar).data(e).enter().append("rect").attr("class",K.bar).attr("x",function(e){return t._histogramData.valueToPosition(e.value)}).attr("width","1").attr("y",function(t){return Math.floor(n(t.volume))}).attr("height",function(t){return Math.ceil(i-n(t.volume))})}},{key:"_renderXAxis",value:function(){var t=this,e=this._histogramData.getMinMax(),i=this._options.format,n=this._options.height+this._options.fontSize+7;this._groupEl.selectAll("."+K["x-axis"]).data([e.min,e.max]).enter().append("text").text(function(t){return i(t)}).attr("font-size",this._options.fontSize).attr("transform",function(e,i){return["translate(0,"+n+")","translate("+t._options.width+","+n+")"][i]}).attr("text-anchor",function(t,e){return["start","end"][e]}).classed(K["x-axis"],!0)}},{key:"destroy",value:function(){return this._rendered&&this._containerEl.node().removeChild(this._svgEl.node()),this._observable.destroy(),this._selectionRenderer.destroy(),this}}]),e}(),et=function(){function t(e,i){s(this,t),this._selection=i.map(function(t){return Object.assign(t,{position:{from:e.valueToPosition(t.from),to:e.valueToPosition(t.to)}})})}return l(t,[{key:"getSelection",value:function(){return this._selection}},{key:"getOutputSelection",value:function(){throw"HistogramSelection.getOutputSelection() has to be implemented"}},{key:"getSelectionType",value:function(){throw"HistogramSelection.getSelectionType() has to be implemented"}},{key:"allowsToggle",value:function(){throw"HistogramSelection.allowsToogle() has to be implemented"}},{key:"getSelectionPoints",value:function(){throw"HistogramSelection.getSelection() has to be implemented"}}]),t}(),it={MULTI:"multi",FILTER:"filter",INVERTED_FILTER:"inverted-filter"},nt=function(t){function e(t,i){return s(this,e),_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i))}return u(e,et),l(e,[{key:"getSelectionType",value:function(){return it.MULTI}},{key:"getOutputSelection",value:function(){return this._selection}},{key:"allowsToggle",value:function(){return!0}},{key:"getSelectionPoints",value:function(){var t=[],e=this.getSelection();return e.forEach(function(i,n){t.push({value:i.from}),n==e.length-1&&t.push({value:i.to})}),t}}]),e}(),rt=function(t){function e(t){s(this,e);var i=t.getMinMax(),n=Z,r=i.min,o=(i.max-i.min)/n.length,a=n.map(function(t){var e=r,i=r+o;return r+=o,{from:e,to:i,color:t}});return _(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,a))}return u(e,nt),e}(),ot=function(t){function e(t,i){if(s(this,e),1!=i.length)throw"Filter selection doesn't allow more than one selection";return _(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i))}return u(e,et),l(e,[{key:"getOutputSelection",value:function(){return this._selection}},{key:"getSelectionType",value:function(){return it.FILTER}},{key:"allowsToggle",value:function(){return!1}},{key:"getSelectionPoints",value:function(){var t=[],e=this.getSelection();return e.forEach(function(i,n){t.push({value:i.from}),n==e.length-1&&t.push({value:i.to})}),t}}]),e}(),at=function(t){function e(t,i){s(this,e);var n=_(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return n._selection=n._getInvertedSelection(t,i),n}return u(e,ot),l(e,[{key:"_getInvertedSelection",value:function(t,e){var i=t.getMinMax();return[{from:i.min,to:e[0].from},{from:e[0].from,disabled:!0,to:e[0].to},{from:e[0].to,to:i.max}]}},{key:"getOutputSelection",value:function(){return[{from:this._selection[1].from,to:this._selection[1].to}]}},{key:"getSelectionType",value:function(){return it.INVERTED_FILTER}},{key:"getSelectionPoints",value:function(){var t=h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getSelectionPoints",this).call(this);return t[0].hidden=!0,t[t.length-1].hidden=!0,t}}]),e}(),st=function(){function t(e){s(this,t),this._options=e}return l(t,[{key:"getHistogramSelection",value:function(t,e){return t?this._options.selectionType==it.FILTER?new ot(e,t):this._options.selectionType==it.INVERTED_FILTER?new at(e,t):new nt(e,t):new rt(e,this._options.selection)}}]),t}(),lt=function(){function e(i){var n=this;s(this,e),this._options={},this._options.promptHandler=i.promptHandler||null,this._options.width=o(i.width,q),this._options.height=o(i.height,z),this._options.format=o(i.format,null),this._options.inactiveBarColor=o(i.inactiveBarColor,F),this._options.inactiveBarOpacity=o(i.inactiveBarOpacity,G),this._options.overSelectionColor=o(i.overSelectionColor,V),this._options.overSelectionOpacity=o(i.overSelectionOpacity,N),this._options.selectionColor=o(i.selectionColor,X),this._options.enableSelectionToggle=o(i.enableSelectionToggle,W),this._options.fontSize=o(i.fontSize,U),this._options.selectionType=o(i.selectionType,null),this._observable=new c(["selectionOver","toggleSelection","selectionChanged","handleClick"]),this._histogramRenderer=new tt(this._options),this._histogramRenderer.on("selectionOver",function(t){n._observable.fire("selectionOver",t)}),this._histogramRenderer.on("toggleSelection",function(e,i){n._observable.fire("toggleSelection",e,i,t.event)}),this._histogramRenderer.on("selectionChanged",function(t){n._observable.fire("selectionChanged",t)}),this._histogramRenderer.on("handleClick",function(t,e){n._observable.fire("handleClick",t,e)}),this._selectionFactory=new st(this._options)}return l(e,[{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"off",value:function(t,e){return this._observable.off(t,e),this}},{key:"destroy",value:function(){return this._observable.destroy(),this._histogramRenderer.destroy(),this._options=null,this}},{key:"render",value:function(t){return this._histogramRenderer.render(t),this}},{key:"setData",value:function(e,i,n){if(!this._histogramRenderer.isRendered())throw"Can't call setData() when widget is not rendered, please call .render() first.";var r=this._histogramData=new J(e,this._options),o=this._histogramSelection=this._selectionFactory.getHistogramSelection(i,r);return this._options.selection=o.getSelection(),this._selection=i,this._options.format?"string"==typeof this._options.format&&(this._options.format=t.format(this._options.format)):this._options.format=function(t){return String(t)},this._histogramRenderer.refresh(r,o,n),this}},{key:"setSelectionType",value:function(t){return this._options.selectionType=t,this.setSelection(this._selection),this}},{key:"showSelectionLabels",value:function(){this._histogramRenderer.showSelectionLabels()}},{key:"hideSelectionLabels",value:function(){this._histogramRenderer.hideSelectionLabels()}},{key:"setSelection",value:function(t,e){if(!this._histogramRenderer.isRendered())throw"Can't call setData() when widget is not rendered, please call .render() first.";if(!this._histogramData)throw"Can't call setSelection() when no data is available.";var i=this._histogramSelection=this._selectionFactory.getHistogramSelection(t,this._histogramData);return this._options.selection=i.getSelection(),this._selection=t,this._histogramRenderer.refresh(this._histogramData,this._histogramSelection,e),this}}]),e}();lt.SelectionTypes=it;var ht=360,ut=200,_t="#7ed321",ct=1,dt="#7ed321",ft=.1,pt=3,vt=6,gt={bottom:28},bt="#f0f0f0",mt="#bababa",yt=function(){function e(t,i){s(this,e),this._lineData=this._loadLineData(t,i),this._minMax=this._calculateMinMax(this._lineData)}return l(e,[{key:"getMinMax",value:function(){return this._minMax}},{key:"getData",value:function(){return this._lineData}},{key:"_calculateMinMax",value:function(e){var i=t.min(e,function(t){return t.value}),n=t.max(e,function(t){return t.value});return 1==e.length&&(i=Math.min(i,0),n=Math.max(n,0)),{min:i,max:n}}},{key:"getPrecision",value:function(){var t=this._minMax.max.toString().split(".");return t.length>1?t[1].length:0}},{key:"_loadLineData",value:function(t){return t.slice()}}]),e}(),xt=e("._line_xmcxd_1 text {\r\n    font-size: 11px;\r\n    fill:#7d7d7d;\r\n    font-family: Roboto;\r\n}\r\n\r\n._line_xmcxd_1 {\r\n    \r\n}\r\n\r\n._area_xmcxd_21 {\r\n    \r\n}\r\n\r\n._tooltip-group_xmcxd_29 {\r\n    \r\n}\r\n\r\n._tooltip-hover-area_xmcxd_37 {\r\n    \r\n}\r\n\r\n._tooltip-line-circle_xmcxd_45 {\r\n    fill: white;\r\n}\r\n\r\n._tooltip-axis-circle_xmcxd_53 {\r\n    stroke:#bababa;\r\n    fill: white;\r\n}\r\n\r\n._tooltip-label-mask_xmcxd_63 {\r\n    \r\n}\r\n\r\n._tooltip-top-label_xmcxd_71 {\r\n    border-radius: 4px;\r\n    font-size: 11px;\r\n    fill:#7d7d7d;\r\n    pointer-events: none;\r\n    white-space: nowrap;\r\n    font-family: Roboto;    \r\n    background-color: #ffffff;\r\n    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2);\r\n    padding:6px 10px;\r\n}\r\n\r\n._svg_xmcxd_95 {\r\n    overflow: visible;\r\n}",{line:"_line_xmcxd_1",area:"_area_xmcxd_21","tooltip-group":"_tooltip-group_xmcxd_29","tooltip-hover-area":"_tooltip-hover-area_xmcxd_37","tooltip-line-circle":"_tooltip-line-circle_xmcxd_45","tooltip-axis-circle":"_tooltip-axis-circle_xmcxd_53","tooltip-label-mask":"_tooltip-label-mask_xmcxd_63","tooltip-top-label":"_tooltip-top-label_xmcxd_71",svg:"_svg_xmcxd_95"}),kt=0,Et=function(){function e(t){s(this,e),this._options=t,this._groupEl=null,this._lineData=null,this._xAxis=null,this._yAxis=null,this._rendered=!1,this._observable=new c(["pointOver"])}return l(e,[{key:"isRendered",value:function(){return this._rendered}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"render",value:function(t){return this._groupEl=t,this._rendered=!0,this._groupEl.on("mouseout",this._onMouseOut.bind(this)),this}},{key:"_getTextAnchor",value:function(t,e,i){var n=t;return n-e/2<0?"start":n+e/2>i?"end":"middle"}},{key:"_onHoverAreaOver",value:function(t){var e=(this._tooltipGroup.attr("visibility"),0),i=this._xAxis,n=this._yAxis,r=this._options.width,o=i(t.label);this._tooltipGroup.transition().duration(e).attr("visibility","visible").attr("transform","translate("+o+", 0)");var a=this._tooltipBottomLabel.node().getBBox().width,s=this._getTextAnchor(o,a,r);this._tooltipBottomLabel.text(t.label).attr("text-anchor",s),this._tooltipBottomLabel.attr("transform",function(){return{start:"translate("+-o+", 0)",middle:"translate(0, 0)",end:"translate("+(r-o)+", 0)"}[s]});var l=50+a;this._tooltipBottomLabelMask.attr("width",l).attr("x",function(){return{start:-o-25,middle:-l/2,end:r-o-l+25}[s]}),this._handleMaskGradientEl.attr("x1",-l/2),this._handleMaskGradientEl.attr("x2",l/2);var h=t.tooltip||this._options.format(t.value);this._tooltipTopLabel.node().innerHTML=h;var u=this._getLabelLeft(o);t.value?(this._tooltipTopLabel.style("left",u+"px").style("visibility","visible").style("top",n(t.value)-50+"px"),this._tooltipLineCircle.transition().duration(e).style("visibility","visible").attr("cy",n(t.value))):(this._tooltipTopLabel.style("visibility","hidden"),this._tooltipLineCircle.style("visibility","hidden"))}},{key:"_getLabelLeft",value:function(t){var e=this._tooltipTopLabel.node().offsetWidth,i=t-e/2;return i<0&&(i=0),i>this._options.width-e&&(i=this._options.width-e),i}},{key:"_onMouseOut",value:function(){this._groupEl.node().parentNode.contains(t.event.relatedTarget)||(this._hideTooltip(),this._tooltipLineCircle.style("visibility","hidden"))}},{key:"_hideTooltip",value:function(){this._tooltipGroup.attr("visibility","hidden"),this._tooltipTopLabel.style("visibility","hidden")}},{key:"_renderTooltip",value:function(){var e,i=this,n=this._lineData.getData();e=n.length>1?this._options.width/(n.length-1):this._options.width,this._hoverAreas=this._groupEl.selectAll("."+xt["tooltip-hover-area"]).data(n).enter().append("rect").attr("class",xt["tooltip-hover-area"]).attr("width",e).attr("fill-opacity",0).attr("x",function(t){return i._xAxis(t.label)-e/2}).attr("height",this._options.height).on("mouseover",this._onHoverAreaOver.bind(this)),this._tooltipGroup=this._groupEl.append("g").attr("visibility","hidden").attr("class",xt["tooltip-group"]),this._tooltipLineCircle=this._tooltipGroup.append("circle").attr("class",xt["tooltip-line-circle"]).attr("stroke-width",this._options.lineWidth).attr("stroke",this._options.lineColor).attr("stroke-opacity",this._options.lineOpacity).attr("r",2.5+this._options.lineWidth/2),this._tooltipAxisCircle=this._tooltipGroup.append("circle").attr("class",xt["tooltip-axis-circle"]).attr("stroke-width",1).attr("cy",this._options.height-gt.bottom).attr("r",3),this._tooltipBottomLabelMask=this._tooltipGroup.append("rect").attr("fill","url(#"+this._handleMaskGradientEl.attr("id")+")").attr("class",xt["tooltip-label-mask"]).attr("y",this._options.height-5-15).attr("height",20),this._tooltipBottomLabel=this._tooltipGroup.append("text").attr("class",xt["tooltip-label"]).attr("y",this._options.height-5).attr("text-anchor","start").text(n[0].label),this._tooltipTopLabel=t.select(this._groupEl.node().parentNode.parentNode).insert("span",":first-child").attr("class",xt["tooltip-top-label"]).style("position","absolute").style("visibility","hidden"),this._tooltipRendered=!0}},{key:"_createMaskGradientElement",value:function(){return this._handleMaskGradientEl=this._groupEl.append("linearGradient").attr("id",xt["tooltip-label-mask"]+"-"+kt+++"-gradient").attr("gradientUnits","userSpaceOnUse").attr("y1","0").attr("x1","0").attr("y2","0").attr("x2","0"),this._handleMaskGradientEl.selectAll("stop").data([{offset:"0%",color:"rgba(255,255,255,0)"},{offset:"20%",color:"rgba(255,255,255,1)"},{offset:"80%",color:"rgba(255,255,255,1)"},{offset:"100%",color:"rgba(255,255,255,0)"}]).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}),this._handleMaskGradientEl}},{key:"_clear",value:function(){this._tooltipRendered&&(this._hoverAreas.remove(),this._tooltipGroup.remove(),this._tooltipTopLabel.remove(),this._tooltipRendered=!1)}},{key:"update",value:function(t,e,i){return this._xAxis=e,this._yAxis=i,this._lineData=t,this._createMaskGradientElement(),this._clear(),this._renderTooltip(),this}},{key:"destroy",value:function(){return this._rendered&&this._clear(),this._observable.destroy(),this}}]),e}(),St=function(){function e(t){s(this,e),this._options=t,this._containerEl=null,this._groupEl=null,this._svgEl=null,this._lineData=null,this._xAxis=null,this._yAxis=null,this._rendered=!1,this._prevData=null,this._observable=new c(["pointOver"]),this._tooltipRenderer=new Et(t)}return l(e,[{key:"isRendered",value:function(){return this._rendered}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"render",value:function(e){var i=this._containerEl=t.select(e),n=this._options.width,r=this._options.height;return i.style("position","relative"),this._svgEl=i.append("svg").attr("width",n).attr("height",r).classed(xt.svg,!0).classed(xt.line,!0),this._groupEl=this._svgEl.append("g"),this._tooltipRenderer.render(this._groupEl),this._rendered=!0,this}},{key:"_clear",value:function(){this._groupEl.node().innerHTML=""}},{key:"update",value:function(e){this._lineData=e,this._clear();var i=this._options.width,n=this._options.height,r=this._options.verticalSpacing,o=e.getData(),a=e.getMinMax(),s=this._xAxis=t.scalePoint().range([0,i]),l=this._yAxis=t.scaleLinear().range([n-r,r]);return s.domain(o.map(function(t){return t.label})),l.domain([a.min,a.max]),this._renderZeroLine(o),this._renderDataLines(o),this._renderXAxis(o),this._tooltipRenderer.update(e,s,l),this}},{key:"_renderXAxis",value:function(t){this._groupEl.append("line").attr("x1",0).attr("x2",this._options.width).attr("y1",this._options.height-gt.bottom).attr("y2",this._options.height-gt.bottom).attr("stroke-width",1).attr("stroke",this._options.axisColor),t.length>1?(this._groupEl.append("text").text(t[0].label).attr("x",0).attr("y",this._options.height-5),this._groupEl.append("text").text(t[t.length-1].label).attr("x",this._options.width).attr("text-anchor","end").attr("y",this._options.height-5)):1==t.length&&this._groupEl.append("text").text(t[0].label).attr("x",this._options.width/2).attr("text-anchor","middle").attr("y",this._options.height-5)}},{key:"_showZeroLine",value:function(){return this._yAxis(0)<this._options.height-gt.bottom-10}},{key:"_renderZeroLine",value:function(){this._showZeroLine()&&this._groupEl.append("line").attr("x1",0).attr("x2",this._options.width).attr("y1",Math.round(this._yAxis(0))).attr("y2",Math.round(this._yAxis(0))).attr("stroke-dasharray","2 ,2").attr("stroke",this._options.zeroLineColor)}},{key:"_renderDataLines",value:function(e){var i=this,n=this._xAxis,r=this._yAxis,o=this._options,a=this._options.height-gt.bottom,s=this._showZeroLine()?Math.min(a,r(0)):a,l=t.area().x(function(t){return n(t.label)}).y0(s).y1(function(t){return r(t.value)}),h=t.line().x(function(t){return n(t.label)}).y(function(t){return r(t.value)});this._getGroupedData(e).forEach(function(t){t.length>1&&i._groupEl.append("path").data([t]).attr("class",xt.area).attr("fill",o.fillColor).attr("fill-opacity",o.fillOpacity).attr("d",l),t.length&&i._groupEl.append("path").data([t]).attr("fill","none").attr("stroke-linecap","round").attr("stroke",o.lineColor).attr("stroke-opacity",1).attr("stroke-width",t.length>1?o.lineWidth:o.dotSize).attr("class",xt.line).attr("d",function(t){var e=h(t);return e&&2==e.split(",").length?e+" "+e:e})})}},{key:"_getGroupedData",value:function(t){var e=[],i=[e];return t.forEach(function(t){null===t.value?(e=[],i.push(e)):e.push(t)}),i}},{key:"destroy",value:function(){return this._rendered&&this._containerEl.node().removeChild(this._svgEl.node()),this._observable.destroy(),this}}]),e}();return{Bar:D,Doughnut:B,Histogram:lt,Line:function(){function e(t){var i=this;s(this,e),this._options={},this._options.width=a(t.width,ht),this._options.height=a(t.height,ut),this._options.lineWidth=a(t.lineWidth,pt),this._options.dotSize=a(t.dotSize,vt),this._options.format=a(t.format,null),this._options.lineColor=a(t.lineColor,_t),this._options.lineOpacity=a(t.lineOpacity,ct),this._options.fillColor=a(t.fillColor,dt),this._options.fillOpacity=a(t.fillOpacity,ft),this._options.axisColor=a(t.axisColor,bt),this._options.zeroLineColor=a(t.zeroLineColor,mt),this._options.verticalSpacing=a(t.verticalSpacing,this._options.height/4),this._observable=new c(["pointOver"]),this._lineRenderer=new St(this._options),this._lineRenderer.on("pointOver",function(t){i._observable.fire("pointOver",t)})}return l(e,[{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"off",value:function(t,e){return this._observable.off(t,e),this}},{key:"destroy",value:function(){return this._observable.destroy(),this._lineRenderer.destroy(),this._options=null,this}},{key:"render",value:function(t){return this._lineRenderer.render(t),this}},{key:"setData",value:function(e){if(!this._lineRenderer.isRendered())throw"Can't call setData() when widget is not rendered, please call .render() first.";var i=this._lineData=new yt(e,this._options);return this._options.format?"string"==typeof this._options.format&&(this._options.format=t.format(this._options.format)):this._options.format=t.format(",."+this._lineData.getPrecision()+"f"),this._lineRenderer.update(i),this}}]),e}()}});
//# sourceMappingURL=clever-charts-1.0.5.min.js.map

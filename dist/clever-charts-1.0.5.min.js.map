{"version":3,"file":"clever-charts-1.0.5.min.js","sources":["../src/bar/Bar.js","../src/doughnut/Doughnut.js","../src/histogram/utils/PositionUtils.js","../src/histogram/Histogram.js","../src/line/Line.js","../src/utils/Observable.js","../src/bar/BarDefaults.js","../src/bar/BarData.js","../src/bar/BarRenderer.js","../src/doughnut/DoughnutDefaults.js","../src/doughnut/DoughnutRenderer.js","../src/histogram/HistogramDefaults.js","../src/histogram/HistogramData.js","../src/histogram/selection/HistogramHandle.js","../src/histogram/selection/HistogramSelectionRenderer.js","../src/histogram/HistogramRenderer.js","../src/histogram/selection/HistogramSelection.js","../src/histogram/selection/MultipleHistogramSelectionImpl.js","../src/histogram/selection/DefaultHistogramSelectionImpl.js","../src/histogram/selection/FilterHistogramSelectionImpl.js","../src/histogram/selection/InvertedFilterHistogramSelectionImpl.js","../src/histogram/selection/HistogramSelectionFactory.js","../src/line/LineDefaults.js","../src/line/LineData.js","../src/line/TooltipRenderer.js","../src/line/LineRenderer.js","../src/CleverCharts.js"],"sourcesContent":["import * as d3 from \"d3\";\r\nimport Observable from \"../utils/Observable\";\r\nimport * as Defaults from \"./BarDefaults\";\r\nimport BarData from \"./BarData\";\r\nimport BarRenderer from \"./BarRenderer\";\r\n\r\n/**\r\n * @private \r\n * @param {*} optionValue option value \r\n * @param {*} defaultOptionValue default option value \r\n * @returns option or default option value \r\n */\r\nfunction getOptionValue(optionValue, defaultOptionValue) {\r\n\treturn typeof optionValue == \"undefined\" ? defaultOptionValue : optionValue;\r\n}\r\n\r\n/**\r\n * @class\r\n * Main Bar class\r\n * @param {Object} options\r\n */\r\nclass Bar {\r\n\tconstructor(options) {\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * Options property exposing widget's options\r\n\t\t */\r\n\t\tthis._options = {};\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Width of the widget\r\n\t\t */\r\n\t\tthis._options.width = getOptionValue(options.width, Defaults.WIDTH);\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Height of the widget\r\n\t\t */\r\n\t\tthis._options.barHeight = getOptionValue(options.barHeight, Defaults.BAR_HEIGHT);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Format for widget labels \r\n\t\t */\r\n\t\tthis._options.format = getOptionValue(options.format, null);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Label font size \r\n\t\t */\r\n\t\tthis._options.labelFontSize = getOptionValue(options.labelFontSize, Defaults.LABEL_FONT_SIZE);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Label font size \r\n\t\t */\r\n\t\tthis._options.valueFontSize = getOptionValue(options.valueFontSize, Defaults.VALUE_FONT_SIZE);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Inactive bar color \r\n\t\t */\r\n\t\tthis._options.inactiveBarColor = getOptionValue(options.inactiveBarColor, Defaults.INACTIVE_BAR_COLOR);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Over bar color \r\n\t\t */\r\n\t\tthis._options.overBarColor = getOptionValue(options.overBarColor, Defaults.OVER_BAR_COLOR);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Selection color \r\n\t\t */\r\n\t\tthis._options.activeBarColor = getOptionValue(options.activeBarColor, Defaults.ACTIVE_BAR_COLOR);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Selection color \r\n\t\t */\r\n\t\tthis._options.activeBarColors = getOptionValue(options.activeBarColors, Defaults.ACTIVE_BAR_COLORS);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Enables bar toggle\r\n\t\t */\r\n\t\tthis._options.enableBarToggle = getOptionValue(options.enableBarToggle, Defaults.ENABLE_BAR_TOGGLE);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Enables bar hover \r\n\t\t */\r\n\t\tthis._options.enableBarHover = getOptionValue(options.enableBarHover, Defaults.ENABLE_BAR_HOVER);\t\t\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Allows to set minMax range, default is 'sum' (sum of all data items), can be also 'auto' (min/max based on data)\r\n\t\t */\r\n\t\tthis._options.minMax = getOptionValue(options.minMax, Defaults.MINMAX);\t\t\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * observable handler\r\n\t\t */\r\n\t\tthis._observable = new Observable([\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when mouse is over a bar\r\n\t\t\t * @param {int} barIndex\r\n\t\t\t */\r\n\t\t\t\"barOver\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when mouse is out of bar\r\n\t\t\t * @param {int} barIndex\r\n\t\t\t */\r\n\t\t\t\"barOut\",\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when bar is clicked\r\n\t\t\t * @param {int} barIndex\r\n\t\t\t */\r\n\t\t\t\"barClick\",\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when bar is disabled\r\n\t\t\t * @param {int} barIndex\r\n\t\t\t * @param {boolean} disabled\r\n\t\t\t */\r\n\t\t\t\"barDisabled\"\r\n\t\t]);\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * BarRenderer\r\n\t\t */\r\n\t\tthis._barRenderer = new BarRenderer(this._options);\r\n\r\n\t\tthis._barRenderer.on(\"barOver\", barIndex=>{\r\n\t\t\tthis._observable.fire(\"barOver\", barIndex);\r\n\t\t})\r\n\r\n\t\tthis._barRenderer.on(\"barOut\", barIndex=>{\r\n\t\t\tthis._observable.fire(\"barOut\", barIndex);\r\n\t\t})\r\n\r\n\t\tthis._barRenderer.on(\"barClick\", (barIndex)=>{\r\n\t\t\tthis._observable.fire(\"barClick\", barIndex);\r\n\t\t})\r\n\r\n\t\tthis._barRenderer.on(\"barDisabled\", (barIndex, disabled)=>{\r\n\t\t\tthis._observable.fire(\"barDisabled\", barIndex, disabled);\r\n\t\t})\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * Bind widget event\r\n\t * @param {String} event event name\r\n\t * @param {Function} handler event handler\r\n\t * @returns {Bar} returns this widget instance\r\n\t */\r\n\ton(eventName, handler) {\r\n\t\tthis._observable.on(eventName, handler);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Unbind widget event\r\n\t * @param {String} event event name\r\n\t * @param {Function} [handler] event handler\r\n\t * @returns {Bar} returns this widget instance\r\n\t */\r\n\toff(eventName, handler) {\r\n\t\tthis._observable.off(eventName, handler);\r\n\t\treturn this;\r\n\t}\t\r\n\r\n\t/**\r\n\t * Destroys widget\r\n\t * @returns {Bar} returns this widget instance\r\n\t */\r\n\tdestroy() {\r\n\t\tthis._observable.destroy();\r\n\t\tthis._barRenderer.destroy();\r\n\t\tthis._options = null;\r\n\r\n\t\treturn this;\r\n\t}\t\r\n\r\n\t/**\r\n\t * Render logic of this widget\r\n\t * @param {String|DOMElement} selector selector or DOM element \r\n\t * @returns {Bar} returns this widget instance\r\n\t */\r\n\trender(selector) {\r\n\t\tthis._barRenderer.render(selector);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets widget data\r\n\t * @param {...Array} series\r\n\t * @returns {Bar} returns this widget instance \r\n\t */\r\n\tsetData(...series) {\r\n\t\tif (!this._barRenderer.isRendered()) {\r\n\t\t\tthrow \"Can't call setData() when widget is not rendered, please call .render() first.\"\r\n\t\t}\r\n\r\n\t\tvar barData = this._barData = new BarData(series, this._options);\r\n\r\n\t\tif (!this._options.format) {\r\n\t\t\tthis._options.format = d3.format(\",.\" + this._barData.getPrecision() + \"f\")\r\n\t\t} else if (typeof this._options.format == \"string\"){\r\n\t\t\tthis._options.format = d3.format(this._options.format);\r\n\t\t}\r\n\r\n\t\tthis._barRenderer.setData(barData);\r\n\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\nexport default Bar;\r\n","import Observable from \"../utils/Observable\";\nimport * as Defaults from \"./DoughnutDefaults\";\nimport DoughnutRenderer from \"./DoughnutRenderer\";\n\n/**\n * @private \n * @param {*} optionValue option value \n * @param {*} defaultOptionValue default option value \n * @returns option or default option value \n */\nfunction getOptionValue(optionValue, defaultOptionValue) {\n\treturn typeof optionValue == \"undefined\" ? defaultOptionValue : optionValue;\n}\n\n/**\n * @class\n * Main doughnut class\n * @param {Object} options\n */\nclass Doughnut {\n\tconstructor(options) {\n\t\t/**\n\t\t * @private\n\t\t * Options property exposing widget's options\n\t\t */\n\t\tthis._options = {};\n\n\t\t/**\n\t\t * @public\n\t\t * Width of the widget\n\t\t */\n\t\tthis._options.outerRadius = getOptionValue(options.outerRadius, Defaults.OUTER_RADIUS);\n\n\t\t/**\n\t\t * @public\n\t\t * Width of the widget\n\t\t */\n\t\tthis._options.innerRadius = getOptionValue(options.innerRadius, Defaults.INNER_RADIUS);\n\n\t\t/**\n\t\t * @public\n\t\t * Active color\n\t\t */\n\t\tthis._options.activeColor = getOptionValue(options.activeColor, Defaults.ACTIVE_COLOR);\n\n\t\t/**\n\t\t * @public\n\t\t * Inactive color\n\t\t */\n\t\tthis._options.inactiveColor = getOptionValue(options.inactiveColor, Defaults.INACTIVE_COLOR);\n\n\t\t/**\n\t\t * @public\n\t\t * Inactive color\n\t\t */\n\t\tthis._options.backgroundColor = getOptionValue(options.backgroundColor, Defaults.BACKGROUND_COLOR);\n\n\t\t/**\n\t\t * @public\n\t\t * Value\n\t\t */\n\t\tthis._options.value = getOptionValue(options.value, Defaults.VALUE);\n\n\t\t/**\n\t\t * @public\n\t\t * Animation duration\n\t\t */\n\t\tthis._options.animationDuration = getOptionValue(options.animationDuration, Defaults.ANIMATION_DURATION);\n\n\t\t/**\n\t\t * @public\n\t\t * Render to container\n\t\t */\n\t\tthis._options.renderTo = getOptionValue(options.renderTo, null);\t\t\n\n\t\t/**\n\t\t * @private\n\t\t * observable handler\n\t\t */\n\t\tthis._observable = new Observable([\n\t\t\t/**\n\t\t\t * @event \n\t\t\t * Fires when mouse is over\n\t\t\t */\n\t\t\t\"mouseOver\",\n\t\t\t/**\n\t\t\t * @event \n\t\t\t * Fires when mouse is out\n\t\t\t */\n\t\t\t\"mouseOut\"\n\t\t]);\n\n\t\t/**\n\t\t * @private\n\t\t * DoughnutRenderer\n\t\t */\n\t\tthis._doughnutRenderer = new DoughnutRenderer(this._options);\n\n\t\tthis._doughnutRenderer.on(\"mouseOver\", ()=>{\n\t\t\tthis._observable.fire(\"mouseOver\")\n\t\t});\n\n\t\tthis._doughnutRenderer.on(\"mouseOut\", ()=>{\n\t\t\tthis._observable.fire(\"mouseOut\")\n\t\t});\n\n\t\tif (options.renderTo){\n\t\t\tthis.render(options.renderTo);\n\t\t}\n\t}\n\n\t/**\n\t * Bind widget event\n\t * @param {String} event event name\n\t * @param {Function} handler event handler\n\t * @returns {Doughnut} returns this widget instance\n\t */\n\ton(eventName, handler) {\n\t\tthis._observable.on(eventName, handler);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Unbind widget event\n\t * @param {String} event event name\n\t * @param {Function} [handler] event handler\n\t * @returns {Doughnut} returns this widget instance\n\t */\n\toff(eventName, handler) {\n\t\tthis._observable.off(eventName, handler);\n\t\treturn this;\n\t}\t\n\n\t/**\n\t * Destroys widget\n\t * @returns {Doughnut} returns this widget instance\n\t */\n\tdestroy() {\n\t\tthis._observable.destroy();\n\t\tthis._doughnutRenderer.destroy();\n\t\tthis._options = null;\n\n\t\treturn this;\n\t}\t\n\n\t/**\n\t * Render logic of this widget\n\t * @param {String|DOMElement} selector selector or DOM element \n\t * @returns {Doughnut} returns this widget instance\n\t */\n\trender(selector) {\n\t\tthis._doughnutRenderer.render(selector);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Sets widget data\n\t * @param {Object} options\n\t * @returns {Doughnut} returns this widget instance \n\t */\n\tupdate(options) {\n\t\tif (!this._doughnutRenderer.isRendered()) {\n\t\t\tthrow \"Can't call update() when widget is not rendered, please call .render() first.\"\n\t\t}\n\n\t\tthis._doughnutRenderer.update(options);\n\n\t\treturn this;\n\t}\n}\n\nexport default Doughnut;\n","/**\n * @public\n * Returns handle positions offsets so that labels don't conflict visually\n * @param {HistogramData} histogramData \n * @returns {Array} label offsets\n */\nexport function getHandlePositionOffsets(handle1, handle2, maskPadding, width){\n    var label1Box = handle1.getLabelBox();\n    var label2Box = handle2.getLabelBox();\n\n    // calculate conflict number\n    var conflictDiff = label2Box.x - (label1Box.x + label1Box.width)-maskPadding;\n    // and handle if there is not enough space\n    if (conflictDiff<0){\n        // pos1 diff to the left\n        var posDiff1 = conflictDiff/2;\n        // pos2 diff to to right\n        var posDiff2 = conflictDiff/2;\n\n        // position left to 0 if position would be lower than 0\n        var xMin = label1Box.x+posDiff1;\n        if (xMin < 0){\n            posDiff1 = label1Box.x; \n            // also shift right label so we keep it visible\n            posDiff2 = posDiff2*2\n        }\n\n        // same with max value\n        var xMax = label2Box.x+label2Box.width-posDiff2;\n        if (xMax > width){\n            posDiff2 += xMax-width; \n            posDiff1 = posDiff1*2\n        }\n        return [posDiff1, -posDiff2];                  \n    }\n\n    return [0,0];\n}","import * as d3 from \"d3\";\r\nimport Observable from \"../utils/Observable\";\r\nimport * as Defaults from \"./HistogramDefaults\";\r\nimport HistogramData from \"./HistogramData\";\r\nimport HistogramRenderer from \"./HistogramRenderer\";\r\nimport HistogramSelectionFactory from \"./selection/HistogramSelectionFactory\"\r\nimport {SelectionTypes} from \"./selection/HistogramSelection\";\r\n\r\n/**\r\n * @private \r\n * @param {*} optionValue option value \r\n * @param {*} defaultOptionValue default option value \r\n * @returns option or default option value \r\n */\r\nfunction getOptionValue(optionValue, defaultOptionValue) {\r\n\treturn typeof optionValue == \"undefined\" ? defaultOptionValue : optionValue;\r\n}\r\n\r\n/**\r\n * @class\r\n * Main histogram class\r\n * @param {Object} options\r\n */\r\nclass Histogram {\r\n\tconstructor(options) {\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * Options property exposing widget's options\r\n\t\t */\r\n\t\tthis._options = {};\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * prompt handler\r\n\t\t */\r\n\t\tthis._options.promptHandler = options.promptHandler || null;\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Width of the widget\r\n\t\t */\r\n\t\tthis._options.width = getOptionValue(options.width, Defaults.WIDTH);\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Height of the widget\r\n\t\t */\r\n\t\tthis._options.height = getOptionValue(options.height, Defaults.HEIGHT);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Format for widget labels \r\n\t\t */\r\n\t\tthis._options.format = getOptionValue(options.format, null);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Inactive bar color \r\n\t\t */\r\n\t\tthis._options.inactiveBarColor = getOptionValue(options.inactiveBarColor, Defaults.INACTIVE_BAR_COLOR);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Inactive bar opacity \r\n\t\t */\r\n\t\tthis._options.inactiveBarOpacity = getOptionValue(options.inactiveBarOpacity, Defaults.INACTIVE_BAR_OPACITY);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Over bar color \r\n\t\t */\r\n\t\tthis._options.overSelectionColor = getOptionValue(options.overSelectionColor, Defaults.OVER_SELECTION_COLOR);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Over selection opacity \r\n\t\t */\r\n\t\tthis._options.overSelectionOpacity = getOptionValue(options.overSelectionOpacity, Defaults.OVER_SELECTION_OPACITY);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Selection color \r\n\t\t */\r\n\t\tthis._options.selectionColor = getOptionValue(options.selectionColor, Defaults.SELECTION_COLOR);\r\n\t\t\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Enable selection toggle \r\n\t\t */\r\n\t\tthis._options.enableSelectionToggle = getOptionValue(options.enableSelectionToggle, Defaults.ENABLE_SELECTION_TOGGLE);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * Font size\r\n\t\t */\r\n\t\tthis._options.fontSize = getOptionValue(options.fontSize, Defaults.FONT_SIZE);\r\n\r\n\t\t/**\r\n\t\t * @public\r\n\t\t * selection type\r\n\t\t */\r\n\t\tthis._options.selectionType = getOptionValue(options.selectionType, null);\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * observable handler\r\n\t\t */\r\n\t\tthis._observable = new Observable([\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when mouse is over a selection\r\n\t\t\t * @param {int} selectionIndex\r\n\t\t\t */\r\n\t\t\t\"selectionOver\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when selection is toggled\r\n\t\t\t * @param {int} selectionIndex\r\n\t\t\t * @param {bool} enabled\r\n\t\t\t * @param {MouseEvent} browser event\r\n\t\t\t */\r\n\t\t\t\"toggleSelection\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when selection is toggled\r\n\t\t\t * @param {int} selectionIndex\r\n\t\t\t * @param {bool} enabled\r\n\t\t\t */\r\n\t\t\t\"selectionChanged\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when user clicks on a handle\r\n\t\t\t * @param {int} handleIndex\r\n\t\t\t * @param {Number} handleValue\r\n\t\t\t */\r\n\t\t\t\"handleClick\"\r\n\t\t]);\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * histogramRenderer\r\n\t\t */\r\n\t\tthis._histogramRenderer = new HistogramRenderer(this._options);\r\n\r\n\t\tthis._histogramRenderer.on(\"selectionOver\", selectionIndex=>{\r\n\t\t\tthis._observable.fire(\"selectionOver\", selectionIndex);\r\n\t\t})\r\n\r\n\t\tthis._histogramRenderer.on(\"toggleSelection\", (selectionIndex, enabled)=>{\r\n\t\t\tthis._observable.fire(\"toggleSelection\", selectionIndex, enabled, d3.event);\r\n\t\t})\r\n\r\n\t\tthis._histogramRenderer.on(\"selectionChanged\", (selection)=>{\r\n\t\t\tthis._observable.fire(\"selectionChanged\", selection);\r\n\t\t})\r\n\r\n\t\tthis._histogramRenderer.on(\"handleClick\", (handleIndex, handleValue)=>{\r\n\t\t\tthis._observable.fire(\"handleClick\", handleIndex, handleValue);\r\n\t\t});\r\n\t\t\r\n\t\tthis._selectionFactory = new HistogramSelectionFactory(this._options);\r\n\t}\r\n\r\n\t/**\r\n\t * Bind widget event\r\n\t * @param {String} event event name\r\n\t * @param {Function} handler event handler\r\n\t * @returns {Histogram} returns this widget instance\r\n\t */\r\n\ton(eventName, handler) {\r\n\t\tthis._observable.on(eventName, handler);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Unbind widget event\r\n\t * @param {String} event event name\r\n\t * @param {Function} [handler] event handler\r\n\t * @returns {Histogram} returns this widget instance\r\n\t */\r\n\toff(eventName, handler) {\r\n\t\tthis._observable.off(eventName, handler);\r\n\t\treturn this;\r\n\t}\t\r\n\r\n\t/**\r\n\t * Destroys widget\r\n\t * @returns {Histogram} returns this widget instance\r\n\t */\r\n\tdestroy() {\r\n\t\tthis._observable.destroy();\r\n\t\tthis._histogramRenderer.destroy();\r\n\t\tthis._options = null;\r\n\r\n\t\treturn this;\r\n\t}\t\r\n\r\n\t/**\r\n\t * Render logic of this widget\r\n\t * @param {String|DOMElement} selector selector or DOM element \r\n\t * @returns {Histogram} returns this widget instance\r\n\t */\r\n\trender(selector) {\r\n\t\tthis._histogramRenderer.render(selector);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets widget data\r\n\t * @param {Array} data\r\n\t * @param {Array} selection\r\n\t * @param {Object} set data options\r\n\t * @returns {Histogram} returns this widget instance \r\n\t */\r\n\tsetData(data, selection, options) {\r\n\t\tif (!this._histogramRenderer.isRendered()) {\r\n\t\t\tthrow \"Can't call setData() when widget is not rendered, please call .render() first.\"\r\n\t\t}\r\n\r\n\t\tvar histogramData = this._histogramData = new HistogramData(data, this._options);\r\n\t\tvar histogramSelection = this._histogramSelection = this._selectionFactory.getHistogramSelection(selection, histogramData);\r\n\r\n\t\tthis._options.selection = histogramSelection.getSelection();\r\n\t\tthis._selection = selection;\r\n\r\n\t\tif (!this._options.format) {\r\n\t\t\tthis._options.format = (value => String(value));\r\n\t\t} else if (typeof this._options.format == \"string\"){\r\n\t\t\tthis._options.format = d3.format(this._options.format);\r\n\t\t}\r\n\r\n\t\tthis._histogramRenderer.refresh(histogramData, histogramSelection, options);\r\n\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @public\r\n\t * Sets selection type\r\n\t * @param {String} selectionType\r\n\t * @returns {Histogram} returns this widget instance \r\n\t */\r\n\tsetSelectionType(selectionType){\r\n\t\tthis._options.selectionType = selectionType;\r\n\t\tthis.setSelection(this._selection);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Shows selection labels\r\n\t */\r\n\tshowSelectionLabels(){\r\n\t\tthis._histogramRenderer.showSelectionLabels();\r\n\t}\r\n\r\n\t/**\r\n\t * Hides selection labels\r\n\t */\r\n\thideSelectionLabels(){\r\n\t\tthis._histogramRenderer.hideSelectionLabels();\r\n\t}\r\n\t\r\n\t/**\r\n\t * @public\r\n\t * Sets selection\r\n\t * @param {Array} selection\r\n\t * @param {Object} options\r\n\t * @returns {Histogram} returns this widget instance \r\n\t */\r\n\tsetSelection(selection, options) {\r\n\t\tif (!this._histogramRenderer.isRendered()) {\r\n\t\t\tthrow \"Can't call setData() when widget is not rendered, please call .render() first.\"\r\n\t\t}\r\n\r\n\t\tif (!this._histogramData) {\r\n\t\t\tthrow \"Can't call setSelection() when no data is available.\"\r\n\t\t}\r\n\r\n\t\tvar histogramSelection = this._histogramSelection = this._selectionFactory.getHistogramSelection(selection, this._histogramData);\r\n\t\tthis._options.selection = histogramSelection.getSelection();\r\n\t\tthis._selection = selection;\r\n\t\tthis._histogramRenderer.refresh(this._histogramData, this._histogramSelection, options);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n}\r\n\r\nHistogram.SelectionTypes = SelectionTypes;\r\nexport default Histogram;\r\n","import * as d3 from \"d3\";\nimport Observable from \"../utils/Observable\";\nimport * as Defaults from \"./LineDefaults\";\nimport LineData from \"./LineData\";\nimport LineRenderer from \"./LineRenderer\";\n\n/**\n * @private \n * @param {*} optionValue option value \n * @param {*} defaultOptionValue default option value \n * @returns option or default option value \n */\nfunction getOptionValue(optionValue, defaultOptionValue) {\n\treturn typeof optionValue == \"undefined\" ? defaultOptionValue : optionValue;\n}\n\n/**\n * @class\n * Main Line class\n * @param {Object} options\n */\nclass Line {\n\tconstructor(options) {\n\t\t/**\n\t\t * @private\n\t\t * Options property exposing widget's options\n\t\t */\n\t\tthis._options = {};\n\n\t\t/**\n\t\t * @public\n\t\t * Width of the widget\n\t\t */\n\t\tthis._options.width = getOptionValue(options.width, Defaults.WIDTH);\n\t\t/**\n\t\t * @public\n\t\t * Height of the widget\n\t\t */\n\t\tthis._options.height = getOptionValue(options.height, Defaults.HEIGHT);\n\n\t\t/**\n\t\t * @public\n\t\t * Line width\n\t\t */\n\t\tthis._options.lineWidth = getOptionValue(options.lineWidth, Defaults.LINE_WIDTH);\t\t\n\n\t\t/**\n\t\t * @public\n\t\t * Dot size\n\t\t */\n\t\tthis._options.dotSize = getOptionValue(options.dotSize, Defaults.DOT_SIZE);\t\t\t\t\n\n\t\t/**\n\t\t * @public\n\t\t * Format for widget labels \n\t\t */\n\t\tthis._options.format = getOptionValue(options.format, null);\n\n\t\t/**\n\t\t * @public\n\t\t * Line color \n\t\t */\n\t\tthis._options.lineColor = getOptionValue(options.lineColor, Defaults.LINE_COLOR);\n\n\t\t/**\n\t\t * @public\n\t\t * Line colors \n\t\t */\n\t\tthis._options.lineColors = getOptionValue(options.lineColors, Defaults.LINE_COLORS);\t\t\n\n\t\t/**\n\t\t * @public\n\t\t * Line opacity \n\t\t */\n\t\tthis._options.lineOpacity = getOptionValue(options.lineOpacity, Defaults.LINE_OPACITY);\n\n\t\t/**\n\t\t * @public\n\t\t * Fill color \n\t\t */\n\t\tthis._options.fillColor = getOptionValue(options.fillColor, Defaults.FILL_COLOR);\n\n\t\t/**\n\t\t * @public\n\t\t * Fill colors\n\t\t */\n\t\tthis._options.fillColors = getOptionValue(options.fillColors, Defaults.FILL_COLORS);\t\t\n\n\t\t/**\n\t\t * @public\n\t\t * Fill opacity\n\t\t */\n\t\tthis._options.fillOpacity = getOptionValue(options.fillOpacity, Defaults.FILL_OPACITY);\n\n\t\t/**\n\t\t * @public\n\t\t * Axis color\n\t\t */\n\t\tthis._options.axisColor = getOptionValue(options.axisColor, Defaults.AXIS_COLOR);\t\t\n\n\n\t\t/**\n\t\t * @public\n\t\t * Axis color\n\t\t */\n\t\tthis._options.zeroLineColor = getOptionValue(options.zeroLineColor, Defaults.ZERO_LINE_COLOR);\t\t\n\n\t\t/**\n\t\t * @public\n\t\t * Vertical spacing\n\t\t */\n\t\tthis._options.verticalSpacing = getOptionValue(options.verticalSpacing, this._options.height / 4);\t\t\n\t\t\n\t\t/**\n\t\t * @private\n\t\t * observable handler\n\t\t */\n\t\tthis._observable = new Observable([\n\t\t\t/**\n\t\t\t * @event \n\t\t\t * Fires when mouse is over a line point\n\t\t\t * @param {Array} [x,y] data\n\t\t\t */\n\t\t\t\"pointOver\"\n\t\t]);\n\n\t\t/**\n\t\t * @private\n\t\t * LineRenderer\n\t\t */\n\t\tthis._lineRenderer = new LineRenderer(this._options);\n\n\t\tthis._lineRenderer.on(\"pointOver\", data=>{\n\t\t\tthis._observable.fire(\"pointOver\", data);\n\t\t})\n\t}\n\n\t/**\n\t * Bind widget event\n\t * @param {String} event event name\n\t * @param {Function} handler event handler\n\t * @returns {Line} returns this widget instance\n\t */\n\ton(eventName, handler) {\n\t\tthis._observable.on(eventName, handler);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Unbind widget event\n\t * @param {String} event event name\n\t * @param {Function} [handler] event handler\n\t * @returns {Line} returns this widget instance\n\t */\n\toff(eventName, handler) {\n\t\tthis._observable.off(eventName, handler);\n\t\treturn this;\n\t}\t\n\n\t/**\n\t * Destroys widget\n\t * @returns {Line} returns this widget instance\n\t */\n\tdestroy() {\n\t\tthis._observable.destroy();\n\t\tthis._lineRenderer.destroy();\n\t\tthis._options = null;\n\n\t\treturn this;\n\t}\t\n\n\t/**\n\t * Render logic of this widget\n\t * @param {String|DOMElement} selector selector or DOM element \n\t * @returns {Line} returns this widget instance\n\t */\n\trender(selector) {\n\t\tthis._lineRenderer.render(selector);\n\t\treturn this;\n\t}\n\n\t/**\n\t * Sets multiple series of data\n\t * @param {Array[]} series\n\t * @returns {Line} returns this widget instance \n\t */\n\tsetSeries(series) {\n\t\treturn this.setData.apply(this, series);\n\t}\n\n\t/**\n\t * Sets line data\n\t * @param {...Array} series\n\t * @returns {Line} returns this widget instance \n\t */\n\tsetData(...series) {\n\t\tif (!this._lineRenderer.isRendered()) {\n\t\t\tthrow \"Can't call setData() when widget is not rendered, please call .render() first.\"\n\t\t}\n\n\t\tvar lineData = this._lineData = new LineData(series, this._options);\n\n\t\tif (!this._options.format) {\n\t\t\tthis._options.format = d3.format(\",.\" + this._lineData.getPrecision() + \"f\")\n\t\t} else if (typeof this._options.format == \"string\"){\n\t\t\tthis._options.format = d3.format(this._options.format);\n\t\t}\n\n\t\tthis._lineRenderer.update(lineData);\n\n\t\treturn this;\n\t}\n}\n\nexport default Line;\n","/**\r\n * @class\r\n * Observable class, handles binding and firing events\r\n * @param {Array} events list of events for this observable\r\n */\r\nexport default class Observable {\r\n    /**\r\n     * @param {Array} events\r\n     */\r\n    constructor(events = []) {\r\n        // create a map of handlers where each event has an array of bound handlers\r\n        this._handlers = events.reduce((acc, cur)=>{\r\n            acc[cur] = [];\r\n            return acc;\r\n        },{});\r\n    }\r\n\r\n\t/**\r\n\t * @public\r\n\t * Bind event\r\n\t * @param {String} event event name\r\n\t * @param {Function} handler event handler\r\n\t */\r\n    on(event, handler) {\r\n        if (!(event in this._handlers)) throw \"No such event: \" + event;\r\n\t\tthis._handlers[event].push(handler);\r\n\t\treturn this;\r\n    }\r\n\r\n\t/**\r\n\t * @public\r\n\t * Unbind event\r\n\t * @param {String} event event name\r\n\t * @param {Function} [handler] event handler, optional\r\n\t */\r\n    off(event, handler) {\r\n        if (!(event in this._handlers)) throw \"No such event: \" + event;\r\n\t\tif (!handler) {\r\n\t\t\tthis._handlers[event] = [];\r\n\t\t} else {\r\n\t\t\tvar handlers = this._handlers[event];\r\n\t\t\tvar index = handlers.indexOf(handler);\r\n\t\t\tif (index != -1){\r\n\t\t\t\thandlers.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this;\r\n    }\r\n\r\n\t/**\r\n\t * @public\r\n\t * Fire widget event\r\n\t * @param {String} event event name\r\n\t * @param {*} ...args event arguments\r\n\t */\r\n\tfire(event, ...args) {\r\n\t\tif (!(event in this._handlers)) throw \"No such event: \" + event;\r\n\t\tvar handlers = this._handlers[event];\r\n\t\tfor (var i = 0; i < handlers.length; i++) {\r\n\t\t\thandlers[i].apply(this, args);\r\n\t\t}\r\n\t\treturn this;\r\n    }\r\n\r\n\t/**\r\n\t * @public\r\n\t * Destorys this observable, removes events and so on \r\n\t */\r\n\tdestroy() {\r\n\t\tthis._handlers = null;\r\n\t\treturn this;\r\n    }\r\n\t\r\n}","/**\r\n * @public\r\n * Default widget width\r\n */\r\nexport const WIDTH = 360;\r\n\r\n/**\r\n * @public\r\n * Default bar height\r\n */\r\nexport const BAR_HEIGHT = 43;\r\n\r\n/**\r\n * @public\r\n * Default inactive bar color\r\n */\r\nexport const INACTIVE_BAR_COLOR = \"#f0f0f0\";\r\n\r\n/**\r\n * @public\r\n * Default over bar color\r\n */\r\nexport const OVER_BAR_COLOR = \"#ffea00\";\r\n\r\n/**\r\n * @public\r\n * Default active bar color\r\n */\r\nexport const ACTIVE_BAR_COLOR = \"#49ace2\";\r\n\r\n/**\r\n * @public\r\n * Default active bar colors\r\n */\r\nexport const ACTIVE_BAR_COLORS = [];\r\n\r\n/**\r\n * @public\r\n * Enables bar toggle\r\n */\r\nexport const ENABLE_BAR_TOGGLE = false;\r\n\r\n/**\r\n * @public\r\n * Enables bar hover \r\n */\r\nexport const ENABLE_BAR_HOVER = false;\r\n\r\n/**\r\n * @public\r\n * Label font size\r\n */\r\nexport const LABEL_FONT_SIZE = 13;\r\n\r\n/**\r\n * @public\r\n * Value font size\r\n */\r\nexport const VALUE_FONT_SIZE = 11;\r\n\r\n/**\r\n * @public\r\n * Default minMax value\r\n */\r\nexport const MINMAX = \"sum\";","import * as d3 from \"d3\";\r\n\r\n/**\r\n * @class\r\n * series representing data for the line\r\n */\r\nexport default class BarData {\r\n\t/**\r\n\t * @param {Array} series\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(series, options) {\r\n\t\tthis._options = options;\r\n\t\tthis._series = series.slice();\r\n\t\tthis._minMax = this._calculateMinMax(this._series);\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns min max of history data\r\n\t * @returns {Object} minMax\r\n\t * @returns {Number} minMax.min\r\n\t * @returns {Number} minMax.max\r\n\t */\r\n\tgetMinMax() {\r\n\t\treturn this._minMax;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns line series\r\n\t * @returns {Array} line series\r\n\t */\r\n\tgetSeries() {\r\n\t\treturn this._series;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns all data from all series merged into one array\r\n\t * @returns {Array}\r\n\t */\r\n\tgetAllData() {\r\n\t\treturn [].concat.apply([], this._series);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns merged data where each unique label has an array of values\r\n\t */\r\n\tgetMergedData() {\r\n\t\tvar dataMap = {};\r\n\t\tthis.getAllData().forEach((item=>{\r\n\t\t\tconst result = dataMap[item.label] || {\r\n\t\t\t\tlabel:item.label,\r\n\t\t\t\tvalues:[],\r\n\t\t\t\tdisabled:item.disabled,\r\n\t\t\t\thighlighted:item.highlighted,\r\n\t\t\t\tcolors:[],\r\n\t\t\t\ttooltips:[]\r\n\t\t\t};\r\n\t\t\tresult.values.push(item.value);\r\n\t\t\tresult.tooltips.push(item.tooltip);\r\n\t\t\tresult.colors.push(item.color);\r\n\t\t\tdataMap[item.label] = result;\r\n\t\t}));\r\n\r\n\t\treturn Object.values(dataMap);\r\n\t}\r\n\r\n\t/**\r\n\t* @private\r\n\t* Returns min max values for given series\r\n\t* @param {Array} series\r\n\t* @returns {Object} minMax.min\r\n\t* @returns {Object} minMax.max\r\n\t*/\r\n\t_calculateMinMax(series) {\r\n\t\tlet data = [].concat.apply([], series);\r\n\t\tif (this._options.minMax == \"sum\"){\r\n\t\t\tlet sums = this._series.map((data)=>{\r\n\t\t\t\treturn d3.sum(data, function (d) { return d.value; });\r\n\t\t\t});\r\n\t\t\treturn {\r\n\t\t\t\tmin:0,\r\n\t\t\t\tmax:Math.max.apply(Math, sums)\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet min = d3.min(data, function (d) { return d.value; });\r\n\t\t\tlet max = d3.max(data, function (d) { return d.value; });\r\n\t\r\n\t\t\tif (data.length <= series.length) {\r\n\t\t\t\tmin = Math.min(min, 0);\r\n\t\t\t\tmax = Math.max(max, 0);\r\n\t\t\t}\r\n\t\r\n\t\t\treturn {\r\n\t\t\t\tmin: min,\r\n\t\t\t\tmax: max\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns precision (number of floating digits) for given number\r\n\t */\r\n\tgetPrecision() {\r\n\t\tvar num = this._minMax.max;\r\n\t\tvar numParts = num.toString().split(\".\");\r\n\t\tif (numParts.length > 1) {\r\n\t\t\treturn numParts[1].length;\r\n\t\t} else {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n}","import style from \"./Bar.css\";\r\nimport * as Defaults from \"./BarDefaults\";\r\nimport Observable from \"../utils/Observable\";\r\nimport * as d3 from \"d3\";\r\n\r\nvar MASK_INDEX = 0;\r\n\r\n/**\r\n * @class\r\n * Bar renderer class\r\n * @param {Object} options\r\n */\r\nexport default class BarRenderer {\r\n    constructor(options) {\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Bar options\r\n\t\t */\r\n\t\tthis._options = options;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * DOM container of this widget\r\n\t\t */\r\n\t\tthis._containerEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Main group element of this widget\r\n\t\t */\r\n\t\tthis._groupEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Main SVG element of this widget\r\n\t\t */\r\n\t\tthis._svgEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * Bar data \r\n\t\t */\r\n\t\tthis._barData = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * X axis\r\n\t\t */\r\n\t\tthis._xAxis = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * Y axis\r\n\t\t */\r\n\t\tthis._yAxis = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * true if Bar has been rendered\r\n\t\t */\r\n\t\tthis._rendered = false;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * observable handler\r\n\t\t */\r\n\t\tthis._observable = new Observable([\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when mouse is over a bar\r\n\t\t\t * @param {int} barIndex\r\n\t\t\t */\r\n\t\t\t\"barOver\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when mouse is out of a bar\r\n\t\t\t * @param {int} barIndex\r\n\t\t\t */\r\n\t\t\t\"barOut\",\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when bar is clicked\r\n\t\t\t * @param {int} barIndex\r\n\t\t\t */\r\n\t\t\t\"barClick\",\t\t\t\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when bar is disabled\r\n\t\t\t * @param {int} barIndex\r\n\t\t\t * @param {boolean} disabled\r\n\t\t\t */\r\n\t\t\t\"barDisabled\"\r\n\t\t]);\r\n\r\n\t\tthis._maskIndex = MASK_INDEX++;\r\n    }\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns whether Bar has been rendered or not\r\n\t * @returns {boolean} true if Bar has been rendered\r\n\t */\r\n\tisRendered(){\r\n\t\treturn this._rendered;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Bind handle event\r\n\t * @param {String} event event name\r\n\t * @param {Function} handler event handler\r\n\t * @returns {BarHandle} returns this handle instance\r\n\t */\r\n\ton(eventName, handler) {\r\n\t\tthis._observable.on(eventName, handler);\r\n\t\treturn this;\r\n\t}\t\r\n\r\n\t/**\r\n\t * @public\r\n\t * Render logic of this widget\r\n\t * @param {String|DOMElement} selector selector or DOM element \r\n\t * @returns {Bar} returns this widget instance\r\n\t */\r\n\trender(selector){\r\n\t\t// get container element using selector or given element\r\n\t\tvar ct = this._containerEl = d3.select(selector);\r\n\t\tvar width = this._options.width;\r\n\t\tvar height = this._options.height;\r\n\r\n\t\t// render SVG\r\n\t\tthis._svgEl = ct.append(\"svg\")\r\n\t\t\t.attr(\"width\", width)\r\n\t\t\t.attr(\"class\", style.bar)\r\n\t\t\t.attr(\"height\", height);\r\n\r\n\t\t// render group element\r\n\t\tthis._groupEl = this._svgEl.append(\"g\");\r\n\r\n\r\n\t\tthis._clipPath = this._svgEl.append(\"clipPath\")\r\n\t\t\t.attr(\"id\", \"rounded-corners-\"+this._maskIndex)\r\n\t\t\t.append(\"rect\")\r\n\t\t\t.attr(\"y\", this._options.labelFontSize + 10)\r\n\t\t\t.attr(\"rx\", 2.5)\r\n\t\t\t.attr(\"ry\", 2.5)\r\n\t\t\t.attr(\"width\",this._options.width)\r\n\t\t\t.attr(\"height\", 5);\r\n\r\n\t\tthis._rendered = true;\r\n\r\n\t\treturn this;\r\n\t} \r\n\r\n\t/**\r\n\t * @private\r\n\t * Clears selection controls and data \r\n\t */\r\n\t_clear(){\r\n\t\tthis._groupEl.node().innerHTML = \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Sets bar data \r\n\t * @param {BarData}\r\n\t */\r\n\tsetData(barData){\r\n\t\tthis._barData = barData;\t\t\r\n\t\tthis._clear();\r\n\r\n\t\tvar data = barData.getMergedData();\r\n\t\tvar minMax = barData.getMinMax();\r\n\r\n\t\tvar barHeight = this._options.barHeight;\r\n\t\tvar height = data.length * barHeight;\r\n\r\n\t\tthis._xAxis = d3.scaleLinear().range([0, this._options.width]);\r\n\t\tthis._yAxis = d3.scaleBand().range([height, 0]);\t\r\n\r\n\t\tthis._svgEl.attr(\"height\", height);\t\r\n\r\n\t\tthis._xAxis.domain([0, minMax.max]);\r\n\t\tthis._yAxis.domain(data.map((item, i)=>i).reverse());\r\n\r\n\t\tthis._renderDataBars(data);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {Array} data\r\n\t * Renders data bars\r\n\t*/\r\n\t_renderDataBars(data) { \r\n\t\tvar x = this._xAxis;\r\n\t\tvar y = this._yAxis;\r\n\t\tvar horizontalPadding = 10;\r\n\t\tvar barHeight = 5;\r\n\t\tvar observable = this._observable;\r\n\t\tvar options = this._options;\r\n\t\t\r\n\t\tdata.forEach((d, i)=>{\r\n\t\t\tconst barGroup = this._groupEl\r\n\t\t\t\t.datum(d)\r\n\t\t\t\t.append(\"g\")\r\n\t\t\t\t.attr(\"class\", style[\"bar\"])\r\n\t\t\t\t.attr(\"transform\", ()=> {\r\n\t\t\t\t\treturn \"translate(0,\"+ (Math.floor(y(i)))+\")\"\r\n\t\t\t\t})\r\n\t\t\t\t.classed(style[\"bar-over\"], (d)=>{\r\n\t\t\t\t\treturn d.highlighted;\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"mouseover\", function(d, i){\r\n\t\t\t\t\tif (options.enableBarHover){\r\n\t\t\t\t\t\td3.select(this).classed(style[\"bar-over\"], true);\r\n\t\t\t\t\t\tobservable.fire(\"barOver\", i);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"mouseout\", function(d, i){\r\n\t\t\t\t\tif (options.enableBarHover){\r\n\t\t\t\t\t\td3.select(this).classed(style[\"bar-over\"], false);\r\n\t\t\t\t\t\tobservable.fire(\"barOut\", i);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"click\", function(d, i){\r\n\t\t\t\t\tif (options.enableBarToggle){\r\n\t\t\t\t\t\tvar disabled = !d3.select(this).classed(style[\"bar-disabled\"]);\r\n\t\t\t\t\t\td3.select(this).classed(style[\"bar-disabled\"], disabled);\r\n\t\t\t\t\t\tobservable.fire(\"barDisabled\", i, disabled);\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tobservable.fire(\"barClick\", i);\r\n\t\t\t\t})\r\n\t\t\t\t.classed(style[\"bar-disabled\"], (d)=>{\r\n\t\t\t\t\treturn d.disabled;\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// label\r\n\t\t\t\tbarGroup.append(\"text\")\r\n\t\t\t\t\t.text(d=>d.label)\r\n\t\t\t\t\t.attr(\"class\", style[\"bar-label\"])\r\n\t\t\t\t\t.attr(\"x\", horizontalPadding)\r\n\t\t\t\t\t.attr(\"font-size\", this._options.labelFontSize)\r\n\t\t\t\t\t.attr(\"y\", this._options.labelFontSize)\r\n\r\n\t\t\t\t// tooltip\r\n\t\t\t\tlet tooltipX = horizontalPadding;\r\n\t\t\t\td.values.forEach((value, valueIndex)=>{\r\n\t\t\t\t\tconst tooltipEl = barGroup.append(\"text\")\r\n\t\t\t\t\t\t.text(()=>{\r\n\t\t\t\t\t\t\t// generating tooltip in reversed order as it goes from right -> left\r\n\t\t\t\t\t\t\tconst reversedIndex = d.values.length - 1 - valueIndex;\r\n\t\t\t\t\t\t\treturn d.tooltips[reversedIndex] || this._options.format(d.values[reversedIndex])\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.attr(\"class\", style[\"bar-tooltip\"])\r\n\t\t\t\t\t\t.attr(\"x\", this._options.width-tooltipX)\r\n\t\t\t\t\t\t.attr(\"text-anchor\",\"end\")\r\n\t\t\t\t\t\t.attr(\"font-size\", this._options.valueFontSize)\r\n\t\t\t\t\t\t.attr(\"y\", this._options.labelFontSize)\r\n\r\n\t\t\t\t\ttooltipX+= tooltipEl.node().getComputedTextLength()+20;\r\n\r\n\t\t\t\t\tif (d.values.length>1){\r\n\t\t\t\t\t\tbarGroup\r\n\t\t\t\t\t\t\t.append(\"circle\")\r\n\t\t\t\t\t\t\t.attr(\"r\", 3)\r\n\t\t\t\t\t\t\t.attr(\"fill\", ()=>{\r\n\t\t\t\t\t\t\t\t// generating in reversed order as it goes from right -> left\r\n\t\t\t\t\t\t\t\tconst reversedIndex = d.values.length - 1 - valueIndex;\r\n\t\t\t\t\t\t\t\treturn d.colors[reversedIndex] || options.activeBarColors[reversedIndex] || options.activeBarColor\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.attr(\"cx\", this._options.width-tooltipX-this._options.labelFontSize+25)\r\n\t\t\t\t\t\t\t.attr(\"cy\", this._options.labelFontSize/1.5)\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst barOffset = valueIndex*(barHeight+1);\r\n\t\t\t\t\t// active bar\r\n\t\t\t\t\tbarGroup.append(\"rect\")\r\n\t\t\t\t\t\t.attr(\"transform\", \"translate(0,\"+ barOffset + \")\")\t\t\t\t\t\t\r\n\t\t\t\t\t\t.attr(\"fill\",()=>{\r\n\t\t\t\t\t\t\treturn d.colors[valueIndex] || options.activeBarColors[valueIndex] || options.activeBarColor;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.attr(\"class\", style[\"bar-active\"])\r\n\t\t\t\t\t\t.attr(\"x\", 0)\r\n\t\t\t\t\t\t.attr(\"clip-path\", \"url(#rounded-corners-\"+this._maskIndex+\")\")\r\n\t\t\t\t\t\t.attr(\"width\", function () { return Math.floor(x(value)); })\r\n\t\t\t\t\t\t.attr(\"y\", this._options.labelFontSize + 10)\r\n\t\t\t\t\t\t.attr(\"height\", barHeight);\r\n\r\n\t\t\t\t\t// inactive bar\r\n\t\t\t\t\tbarGroup.append(\"rect\")\r\n\t\t\t\t\t\t.attr(\"transform\", \"translate(0,\"+ barOffset + \")\")\t\t\t\t\t\t\r\n\t\t\t\t\t\t.attr(\"fill\",Defaults.INACTIVE_BAR_COLOR)\r\n\t\t\t\t\t\t.attr(\"class\", style[\"bar-inactive\"])\r\n\t\t\t\t\t\t.attr(\"clip-path\", \"url(#rounded-corners-\"+MASK_INDEX+\")\")\r\n\t\t\t\t\t\t.attr(\"x\", () => {\r\n\t\t\t\t\t\t\treturn Math.floor(x(value));\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.attr(\"width\", ()=> { return this._options.width - Math.floor(x(value)); })\r\n\t\t\t\t\t\t.attr(\"y\", this._options.labelFontSize + 10)\r\n\t\t\t\t\t\t.attr(\"height\", barHeight)\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\t// hover\r\n\t\t\t\tbarGroup.append(\"rect\")\r\n\t\t\t\t\t.attr(\"class\", style[\"bar-hover\"])\r\n\t\t\t\t\t.attr(\"fill\", \"transparent\")\r\n\t\t\t\t\t.attr(\"x\", 0)\r\n\t\t\t\t\t.attr(\"text-anchor\",\"end\")\r\n\t\t\t\t\t.attr(\"cursor\",()=>this._options.enableBarHover?\"pointer\":\"default\")\r\n\t\t\t\t\t.attr(\"y\", 0)\r\n\t\t\t\t\t.attr(\"height\", this._options.barHeight)\t\t\t\t\t\r\n\t\t\t\t\t.attr(\"width\", this._options.width)\r\n\r\n\t\t});\r\n\t\t\r\n\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Destorys Bar UI  \r\n\t */\r\n\tdestroy() {\r\n\t\tif (this._rendered){\r\n\t\t\tthis._containerEl.node().removeChild(this._svgEl.node());\r\n\t\t}\r\n\r\n\t\tthis._observable.destroy();\r\n\r\n\t\treturn this;\r\n    }\t\r\n\t\r\n}","/**\r\n * @public\r\n * Default outer radius\r\n */\r\nexport const OUTER_RADIUS = 10;\r\n\r\n/**\r\n * @public\r\n * Default inner radius\r\n */\r\nexport const INNER_RADIUS = 10;\r\n\r\n/**\r\n * @public\r\n * Default value\r\n */\r\nexport const VALUE = 0;\r\n\r\n/**\r\n * @public\r\n * Default active color\r\n */\r\nexport const ACTIVE_COLOR = \"#49ace2\";\r\n\r\n/**\r\n * @public\r\n * Default inactive color\r\n */\r\nexport const INACTIVE_COLOR = \"#F0F0F0\";\r\n\r\n/**\r\n * @public\r\n * Default background color\r\n */\r\nexport const BACKGROUND_COLOR = \"transparent\";\r\n\r\n/**\r\n * @public\r\n * Default animation duration\r\n */\r\nexport const ANIMATION_DURATION = 250;","import style from \"./Doughnut.css\";\r\nimport Observable from \"../utils/Observable\";\r\nimport * as d3 from \"d3\";\r\n\r\nconst tau = 2 * Math.PI; // http://tauday.com/tau-manifesto\r\n\r\n/**\r\n * @class\r\n * Doughnut renderer class\r\n * @param {Object} options\r\n */\r\nexport default class DoughnutRenderer {\r\n\tconstructor(options) {\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Doughnut options\r\n\t\t */\r\n\t\tthis._options = options;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * DOM container of this widget\r\n\t\t */\r\n\t\tthis._containerEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Main group element of this widget\r\n\t\t */\r\n\t\tthis._groupEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Main SVG element of this widget\r\n\t\t */\r\n\t\tthis._svgEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * true if Doughnut has been rendered\r\n\t\t */\r\n\t\tthis._rendered = false;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * observable handler\r\n\t\t */\r\n\t\tthis._observable = new Observable([\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when mouse is over\r\n\t\t\t */\r\n\t\t\t\"mouseOver\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when mouse is out\r\n\t\t\t */\r\n\t\t\t\"mouseOut\"\r\n\t\t]);\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns whether Doughnut has been rendered or not\r\n\t * @returns {boolean} true if Doughnut has been rendered\r\n\t */\r\n\tisRendered() {\r\n\t\treturn this._rendered;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Render logic of this widget\r\n\t * @param {String|DOMElement} selector selector or DOM element \r\n\t * @returns {Doughnut} returns this widget instance\r\n\t */\r\n\trender(selector) {\r\n\t\t// get container element using selector or given element\r\n\t\tvar ct = this._containerEl = d3.select(selector);\r\n\t\tvar width = this._containerEl.node().offsetWidth;\r\n\t\tvar height = this._containerEl.node().offsetHeight;\r\n\t\tvar value = this._value = this._options.value;\r\n\t\tvar angle = this._angle = value / 100 * tau;\r\n\t\tvar innerRadius = this._innerRadius = this._options.innerRadius;\r\n\t\tvar outerRadius = this._outerRadius = this._options.outerRadius;\r\n\r\n\t\t// arc settings\r\n\t\tvar arc = this._arc = d3.arc()\r\n\t\t\t.innerRadius(innerRadius)\r\n\t\t\t.outerRadius(outerRadius)\r\n\t\t\t.startAngle(0);\r\n\r\n\t\t// render SVG\r\n\t\tthis._svgEl = ct.append(\"svg\")\r\n\t\t\t.attr(\"width\", width)\r\n\t\t\t.attr(\"height\", height)\r\n\t\t\t.attr(\"class\", style[\"svg\"]);\r\n\r\n\t\t// render group\r\n\t\tvar g = this._groupEl = this._svgEl\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"class\", style[\"doughnut\"])\r\n\t\t\t.attr(\"transform\", \"translate(\" + width / 2 + \", \" + height / 2 + \")\");\r\n\r\n\t\t// render inactive doughtnut\t\r\n\t\tthis._inactiveArc = g.append(\"path\")\r\n\t\t\t.datum({ endAngle: tau })\r\n\t\t\t.attr(\"fill\", this._options.inactiveColor)\r\n\t\t\t.attr(\"d\", arc);\r\n\r\n\t\t// render active doughtnut\t\r\n\t\tthis._activeArc = g.append(\"path\")\r\n\t\t\t.datum({ endAngle: angle })\r\n\t\t\t.attr(\"fill\", this._options.activeColor)\r\n\t\t\t.attr(\"d\", arc);\r\n\r\n\t\t// render background\t\r\n\t\tthis._backgroundArc = g.append(\"circle\")\r\n\t\t\t.attr(\"fill\", this._options.backgroundColor)\r\n\t\t\t.attr(\"r\", innerRadius)\r\n\t\t\t.attr(\"cx\", 0)\r\n\t\t\t.attr(\"cy\", 0)\r\n\r\n\t\t// render background\t\r\n\t\tthis._backgroundArc = g.append(\"circle\")\r\n\t\t\t.attr(\"fill\", this._options.backgroundColor)\r\n\t\t\t.attr(\"r\", innerRadius)\r\n\t\t\t.attr(\"cx\", 0)\r\n\t\t\t.attr(\"cy\", 0)\r\n\r\n\t\t// hover element, this needs to be rendered in order to have stable and animation\r\n\t\t// independent hover \r\n\t\tthis._hoverEl = g.append(\"rect\")\r\n\t\t\t.attr(\"fill\", \"transparent\")\r\n\t\t\t.attr(\"x\", -width/2)\r\n\t\t\t.attr(\"y\", -height/2)\r\n\t\t\t.attr(\"width\",width)\r\n\t\t\t.attr(\"height\",height)\r\n\r\n\t\tg.on(\"mouseover\", ()=>{\r\n\t\t\tthis._observable.fire(\"mouseOver\");\r\n\t\t})\r\n\r\n\t\tg.on(\"mouseout\", ()=>{\r\n\t\t\tthis._observable.fire(\"mouseOut\");\r\n\t\t})\r\n\r\n\t\tthis._rendered = true;\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t\t * Bind widget event\r\n\t\t * @param {String} event event name\r\n\t\t * @param {Function} handler event handler\r\n\t\t * @returns {Doughnut} returns this widget instance\r\n\t\t */\r\n\t\ton(eventName, handler) {\r\n\t\t\tthis._observable.on(eventName, handler);\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Unbind widget event\r\n\t\t * @param {String} event event name\r\n\t\t * @param {Function} [handler] event handler\r\n\t\t * @returns {Doughnut} returns this widget instance\r\n\t\t */\r\n\t\toff(eventName, handler) {\r\n\t\t\tthis._observable.off(eventName, handler);\r\n\t\t\treturn this;\r\n\t\t}\t\r\n\t\r\n\r\n\t/**\r\n\t * @public\r\n\t * @param {opts} new options\r\n\t * Updates doughnut with new options\r\n\t */\r\n\tupdate(opts) {\r\n\t\tvar options = opts || {};\r\n\r\n\t\tif (typeof options.value == \"undefined\"){\r\n\t\t\toptions.value = this._value;\r\n\t\t} else {\r\n\t\t\tthis._value = options.value;\r\n\t\t}\r\n\r\n\t\t// first tween foreground, note that this is also changing this._arc radiuses \r\n\t\tvar activeArcTransition = this._activeArc.transition()\r\n\t\t\t.duration(this._options.animationDuration)\r\n\t\t\t.attrTween(\"d\", this._arcTween(options, true))\r\n\r\n\t\t// se we only get new path on background as it uses radiuses saved in the previous call\r\n\t\tthis._inactiveArc.transition()\r\n\t\t\t.duration(this._options.animationDuration)\r\n\t\t\t.attrTween(\"d\", () => {\r\n\t\t\t\treturn () => {\r\n\t\t\t\t\treturn this._arc({ endAngle: tau });\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\tthis._backgroundArc.transition()\r\n\t\t\t.duration(this._options.animationDuration)\r\n\t\t\t.attrTween(\"r\", () => {\r\n\t\t\t\treturn () => {\r\n\t\t\t\t\treturn this._innerRadius;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\tif (options.activeColor && options.activeColor !== this._options.activeColor){\r\n\t\t\tthis._options.activeColor = options.activeColor;\r\n\t\t\tactiveArcTransition.attr(\"fill\", options.activeColor)\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {options} new options\r\n\t * returns tween function for arc \r\n\t */\r\n\t_arcTween(options) {\r\n\t\tvar angle = options.value / 100 * tau;\r\n\t\t// change angle if new value is provided \r\n\t\tif (typeof options.value != \"undefined\") {\r\n\t\t\tangle = options.value / 100 * tau;\r\n\t\t}\r\n\r\n\t\t// handle new radiuses\r\n\t\tvar innerRadius = this._innerRadius;\r\n\t\tvar outerRadius = this._outerRadius;\r\n\r\n\t\tif (typeof options.innerRadius != \"undefined\") {\r\n\t\t\tinnerRadius = options.innerRadius;\r\n\t\t}\r\n\r\n\t\tif (typeof options.outerRadius != \"undefined\") {\r\n\t\t\touterRadius = options.outerRadius;\r\n\t\t}\r\n\r\n\t\t// get interpolation fns between new radiuses and old ones\r\n\t\t// for simlicity, do this even if value doesn't change as we\r\n\t\t// likely generate new path anyway\r\n\t\tvar interpolateOuterRadius = d3.interpolate(this._outerRadius, outerRadius);\r\n\t\tvar interpolateInnerRadius = d3.interpolate(this._innerRadius, innerRadius);\r\n\r\n\t\treturn (d) => {\r\n\t\t\t// get angle interpolation fn \r\n\t\t\tvar interpolateAngle = d3.interpolate(d.endAngle, angle);\r\n\r\n\t\t\treturn (t) => {\r\n\t\t\t\t// on each cycle, set new radiuses and endAngle\r\n\t\t\t\tthis._arc.outerRadius(this._outerRadius = interpolateOuterRadius(t));\r\n\t\t\t\tthis._arc.innerRadius(this._innerRadius = interpolateInnerRadius(t));\r\n\r\n\t\t\t\td.endAngle = this._angle = interpolateAngle(t);\r\n\t\t\t\treturn this._arc(d);\r\n\t\t\t};\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Destorys Doughnut UI  \r\n\t */\r\n\tdestroy() {\r\n\t\tif (this._rendered) {\r\n\t\t\tthis._containerEl.node().removeChild(this._svgEl.node());\r\n\t\t}\r\n\r\n\t\tthis._observable.destroy();\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n}","/**\r\n * @public\r\n * Default widget width\r\n */\r\nexport const WIDTH = 360;\r\n\r\n/**\r\n * @public\r\n * Default widget height\r\n */\r\nexport const HEIGHT = 150;\r\n\r\n/**\r\n * @public\r\n * Default widget margin\r\n */\r\nexport const MARGIN = {\r\n    top:0,\r\n    left:5,\r\n    right:5,\r\n    bottom:15\r\n};\r\n\r\n/**\r\n * Default label margin from x axis\r\n */\r\nexport const LABEL_MARGIN = 7;\r\n\r\n/**\r\n * @public\r\n * Default inactive bar color\r\n */\r\nexport const INACTIVE_BAR_COLOR = \"#f0f0f0\";\r\n\r\n/**\r\n * @public\r\n * Default inactive bar opacity\r\n */\r\nexport const INACTIVE_BAR_OPACITY = 1;\r\n\r\n/**\r\n * @public\r\n * Default over bar color\r\n */\r\nexport const OVER_SELECTION_COLOR = \"#ffea00\";\r\n\r\n/**\r\n * @public\r\n * Default over selection opacity\r\n */\r\nexport const OVER_SELECTION_OPACITY = 1;\r\n\r\n/**\r\n * @public\r\n * Default over bar color\r\n */\r\nexport const SELECTION_COLOR = \"#49ace2\";\r\n\r\n/**\r\n * @public\r\n * Enable selection toggle\r\n */\r\nexport const ENABLE_SELECTION_TOGGLE = true;\r\n\r\n/**\r\n * @public\r\n * Default font size\r\n */\r\nexport const FONT_SIZE = 11;\r\n\r\n/**\r\n * @public\r\n * Default colors \r\n */\r\nexport const DEFAULT_COLORS = [\"#e6f3fb\", \"#cbe7f6\", \"#b1dbf2\", \"#98cfee\", \"#7ec4ea\"];\r\n\r\n/**\r\n * @public\r\n * Default width of active handle area\r\n */\r\nexport const ACTIVE_HANDLE_AREA_WIDTH = 4;","import * as d3 from \"d3\";\r\n\r\n/**\r\n * @class\r\n * HistogramData representing data for the histogram view\r\n */\r\nexport default class HistogramData {\r\n\t/**\r\n\t * @param {data} data\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(data, options) {\r\n\t\tthis._histogramData = this._loadHistogramData(data, options.width);\r\n\t\tthis._minMax = this._calculateMinMax(this._histogramData);\r\n\t\tthis._options = options;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns min max of history data\r\n\t * @returns {Object} minMax\r\n\t * @returns {Number} minMax.min\r\n\t * @returns {Number} minMax.max\r\n\t */\r\n\tgetMinMax() {\r\n\t\treturn this._minMax;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns histogram data\r\n\t * @returns {Array} histogram data\r\n\t */\r\n\tgetData() {\r\n\t\treturn this._histogramData;\r\n\t}\r\n\r\n\t/**\r\n\t* @private\r\n\t* Returns min max values for given histogramData\r\n\t* @param {Array} histogramData\r\n\t* @returns {Object} minMax.min\r\n\t* @returns {Object} minMax.max\r\n\t*/\r\n\t_calculateMinMax(histogramData) {\r\n\t\tvar min = d3.min(histogramData, function (d) { return d.value; });\r\n\t\tvar max = d3.max(histogramData, function (d) { return d.value; });\r\n\r\n\t\treturn {\r\n\t\t\tmin: min,\r\n\t\t\tmax: max\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t* Returns value ratio between bars and data\r\n\t* @return {Number} value ratio \r\n\t*/\r\n\tgetValueRatio() {\r\n\t\tvar range = this._minMax.max - this._minMax.min;\r\n\t\treturn range / this._options.width;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns data value from given position \r\n\t * @param {Number} position\r\n\t */\r\n\tpositionToValue(position) {\r\n\t\tvar minMax = this.getMinMax();\r\n\t\t// return min if position is 0\r\n\t\tif (position === 0){\r\n\t\t\treturn minMax.min;\r\n\t\t}\r\n\r\n\t\t// return max if position is at the end\r\n\t\tif (position === this._options.width){\r\n\t\t\treturn minMax.max;\r\n\t\t}\r\n\r\n\t\t// else calculate based on value ratio and min/max\r\n\t\tvar valueRatio = this.getValueRatio();\r\n\t\treturn position * valueRatio + minMax.min;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns position from given data value \r\n\t * @param {Number} value\r\n\t */\r\n\tvalueToPosition(value) {\r\n\t\tvar valueRatio = this.getValueRatio();\r\n\t\tvar minMax = this.getMinMax();\r\n\t\tvar constrainedValue = Math.min(Math.max(value, minMax.min), minMax.max);\r\n\t\t\r\n\t\treturn Math.round(constrainedValue / valueRatio - minMax.min / valueRatio);\r\n\t}\r\n\r\n\t/** \r\n\t* @private\r\n\t* @param {Array} buckets\r\n\t* @param {int} numOfBarsPerBucket - number of bars per column\\\r\n\t* @returns {Array} data from given buckets \r\n\t*/\r\n\t_loadHistogramData(data, width) {\r\n\t\tvar histogramData = [];\r\n\t\t// calculate number of bars per bucket excluding last pixel for max value\r\n\t\tvar numOfBarsPerBucket = (width-1) / data.length;\r\n\r\n\t\tdata.forEach((bucket, i) => {\r\n\t\t\tvar step = (bucket.max - bucket.min) / numOfBarsPerBucket;\r\n\t\t\t// support array as well as single values\r\n\t\t\tconst volume = Array.isArray(bucket.volume)?bucket.volume:[bucket.volume];\r\n\r\n\t\t\td3.range(bucket.min, bucket.max, step).forEach((value) => {\r\n\t\t\t\thistogramData.push({\r\n\t\t\t\t\tvalue: value,\r\n\t\t\t\t\tvolume: volume\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\t// adding max value pixel as each non-last bucket ends one pixel before next bucket starts\r\n\t\t\tif (i == data.length-1){\r\n\t\t\t\thistogramData.push({\r\n\t\t\t\t\tvalue: bucket.max,\r\n\t\t\t\t\tvolume: volume\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn histogramData;\r\n\t}\r\n}","import * as d3 from \"d3\";\r\nimport style from \"../Histogram.css\";\r\nimport * as Defaults from \"../HistogramDefaults\";\r\nimport Observable from \"../../utils/Observable\";\r\n\r\n/**\r\n * Gradient index shared for all instances\r\n */\r\nvar gradientIndex = 0;\r\n\r\n/**\r\n * @class\r\n * HistogramHandle representing control handle for histogram\r\n */\r\nexport default class HistogramHandle {\r\n\t/**\r\n\t * @param {D3Selection} groupEl\r\n\t * @param {Number} value\r\n\t * @param {Number} index\r\n\t * @param {HistoryData} histogramData\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(groupEl, value, index, histogramData, options) {\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * observable handler\r\n\t\t */\r\n\t\tthis._observable = new Observable([\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when mouse is over a selection\r\n\t\t\t * @param {int} selectionIndex\r\n\t\t\t */\r\n\t\t\t\"drag\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when drag on handle starts\r\n\t\t\t * @param {HistogramHandle} handle\r\n\t\t\t */\r\n\t\t\t\"startDrag\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when drag on handle ends\r\n\t\t\t * @param {HistogramHandle} handle\r\n\t\t\t */\r\n\t\t\t\"endDrag\"\r\n\t\t]);\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * handle element\r\n\t\t */\r\n\t\tthis._handleEl = null;\r\n\t\t\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * handle line element\r\n\t\t */\r\n\t\tthis._handleLineEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * handle circle element\r\n\t\t */\r\n\t\tthis._handleCircleEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * handle mask element\r\n\t\t */\r\n\t\tthis._handleMaskEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * handle mask gradient element\r\n\t\t */\r\n\t\tthis._handleMaskGradientEl = null;\t\t\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * handle label element\r\n\t\t */\r\n\t\tthis._handleLabelEl = null;\t\t\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * True if handle is over\r\n\t\t */\r\n\t\tthis._isOver = false;\r\n\t\t\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Main group element\r\n\t\t */\t\t\r\n\t\tthis._groupEl = groupEl;\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * handle index\r\n\t\t */\t\t\r\n\t\tthis._index = index;\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * handle value\r\n\t\t */\t\t\r\n\t\tthis._value = value;\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * initial handle value\r\n\t\t */\t\t\r\n\t\tthis._initialValue = new Number(value);\t\t\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * handle position\r\n\t\t */\t\t\r\n\t\tthis._position = histogramData.valueToPosition(value);\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * initial handle position\r\n\t\t */\t\t\r\n\t\tthis._initialPosition = new Number(this._position);\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * bar options\r\n\t\t */\t\t\r\n\t\tthis._options = options;\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * histogram data\r\n\t\t */\t\t\r\n\t\tthis._histogramData = histogramData;\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Cache for storing label size, enhances performance when animating\r\n\t\t */\t\t\r\n\t\tthis._labelSizeCache = {};\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * elements\r\n\t\t */\t\t\r\n\t\tthis._elements = [];\t\t\r\n\t\t\r\n\t\tthis._renderHandle();\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Destroys this handle\r\n\t */\r\n\tdestroy(){\r\n\t\tthis._elements.forEach(element=>element.remove());\r\n\t\tthis._elements = [];\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t   * Renders drag handle\r\n\t   */\r\n\t_renderHandle() {\r\n\t\tthis._elements = [\r\n\t\t\tthis._createHandleElement(),\r\n\t\t\tthis._createHandleLineElement(),\r\n\t\t\tthis._createHandleCircleElement(),\r\n\t\t\tthis._createDragMaskElement(),\r\n\t\t\tthis._createMaskGradientElement(),\r\n\t\t\tthis._createDragLabelElement()\r\n\t\t];\r\n\r\n\t\tthis._handleHoverState();\r\n\t\tthis._handleDrag();\r\n\t}\t\r\n\r\n\thide(){\r\n\t\tthis._elements.forEach(element=>element.attr(\"visibility\", \"hidden\"));\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Bind handle event\r\n\t * @param {String} event event name\r\n\t * @param {Function} handler event handler\r\n\t * @returns {HistogramHandle} returns this handle instance\r\n\t */\r\n\ton(eventName, handler) {\r\n\t\tthis._observable.on(eventName, handler);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns X position of this handle\r\n\t * @returns {Number} X position handle\r\n\t */\r\n\tgetXPosition() {\r\n\t\treturn parseInt(this._handleEl.attr(\"x\"))+Defaults.ACTIVE_HANDLE_AREA_WIDTH/2;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Sets hover state\r\n\t */\r\n\tsetHoverState(){\r\n\t\tthis._handleLineEl.attr(\"fill-opacity\", 1);\r\n\t\tthis._handleLabelEl.attr(\"fill-opacity\", 1);\r\n\t\tthis._handleMaskEl.attr(\"display\", \"block\");\r\n\t\tthis._handleCircleEl.attr(\"stroke-width\", 3);\r\n\t\tthis._updateLabelPosition(this._position);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @public \r\n\t * @returns {SVGRect} \r\n\t * Returns drag label box for this handle\r\n\t */\r\n\tgetLabelBox(){\r\n\t\treturn this._handleLabelEl.node().getBBox();\r\n\t}\r\n\r\n\t/**\r\n\t * @public \r\n\t * Shifts handle label by given offset so it can handle label position conflicts\r\n\t */\r\n\tsetLabelOffset(offset){\r\n\t\tthis._handleLabelEl.attr(\"transform\", \"translate(\"+offset+\", 0)\");\r\n\t\tthis._handleMaskEl.attr(\"transform\", \"translate(\"+offset+\", 0)\");\r\n\t\tthis._updateLabelPosition(this._position);\r\n\t}\r\n\r\n\t/**\r\n\t * @public \r\n\t * Sets handle position\r\n\t */\r\n\tsetHandleXPosition(position){\r\n\t\tthis._handleCircleEl.attr(\"transform\", \"translate(\"+position+\", \"+this._options.height+\")\")\r\n\t\treturn this;\r\n\t}\r\n\r\n\tsetLabelText(text){\r\n\t\tthis._handleLabelEl.text(text);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tshowLabel(){\r\n\t\tthis._handleLabelEl.attr(\"fill-opacity\", 1);\r\n\t\tthis._handleMaskEl.attr(\"display\", \"block\");\r\n\t\treturn this;\r\n\t}\r\n\r\n\thideLabel(){\r\n\t\tthis._handleLabelEl.attr(\"fill-opacity\", 0);\r\n\t\tthis._handleMaskEl.attr(\"display\", \"none\");\r\n\t\treturn this;\r\n\t}\t\r\n\r\n\tsetLabelPosition(position){\r\n\t\tthis.setLabelOffset(0);\r\n\t\tthis._updateLabelPosition(position);\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Unsets hover state\r\n\t */\r\n\tunsetHoverState(){\r\n\t\tthis._handleLineEl.attr(\"fill-opacity\", 0);\r\n\t\tthis._handleLabelEl.attr(\"fill-opacity\", 0);\r\n\t\tthis._handleMaskEl.attr(\"display\", \"none\");\r\n\t\tthis._handleCircleEl.attr(\"stroke-width\", 1);\r\n\t\tthis._handleLabelEl.attr(\"transform\", \"translate(0, 0)\")\r\n\t\tthis._handleMaskEl.attr(\"transform\", \"translate(0, 0)\")\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Enables this handle \r\n\t */\r\n\tenable(){\r\n\t\tthis._elements.forEach(element => element.attr(\"pointer-events\", \"all\"));\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Disables this handle \r\n\t */\r\n\tdisable(){\r\n\t\tthis._elements.forEach(element => element.attr(\"pointer-events\", \"none\"));\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Handle hover state\r\n\t */\r\n\t_handleHoverState(){\r\n\t\t// line hover effect\r\n\t\tthis._handleEl.on(\"mouseover\", () => {\r\n\t\t\tthis._isOver = true;\r\n\t\t\tthis.setHoverState();\r\n\t\t})\r\n\t\tthis._handleEl.on(\"mouseout\", () => {\r\n\t\t\tthis._isOver = false;\r\n\t\t\tthis.unsetHoverState();\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * handles what happens when drag starts\r\n\t */\r\n\t_onStartDrag(){\r\n\t\tthis._groupEl.classed(style[\"dragging\"], true);\r\n\t\tthis._observable.fire(\"startDrag\", this);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * handles what happens on drag\r\n\t */\r\n\t_onDrag(){\r\n\t\tvar width = this._options.width;\r\n\t\tvar height = this._options.height;\r\n\t\tvar xpos = Math.round(Math.max(Math.min(d3.event.x, width), 0));\r\n\r\n\t\tthis._handleEl.attr(\"x\", xpos - Defaults.ACTIVE_HANDLE_AREA_WIDTH/2);\r\n\t\tthis._handleLineEl.attr(\"x\", xpos - 2);\r\n\t\tthis._handleCircleEl.attr(\"transform\", \"translate(\" + xpos + \",\" + height + \")\");\r\n\t\tthis._handleEl.attr(\"data-handle-value\", this._histogramData.positionToValue(xpos))\r\n\r\n\t\tthis.setHoverState();\r\n\r\n\t\tthis._position = xpos;\r\n\r\n\t\t// prevent recalculating value for the same position\r\n\t\tif (parseInt(this._position) !== parseInt(this._initialPosition)){\r\n\t\t\tthis._value = this._histogramData.positionToValue(xpos);\r\n\t\t} else {\r\n\t\t\tthis._value = this._initialValue;\r\n\t\t}\r\n\r\n\t\tthis._handleLabelEl.text(this._getLabelText())\r\n\r\n\t\tthis._updateLabelPosition(xpos);\r\n\t\tthis._observable.fire(\"drag\");\t\t\r\n\t}\r\n\r\n\t_getLabelText() {\r\n\t\treturn this._options.format(this._value);\r\n\t}\r\n\t/**\r\n\t * @private\r\n\t * handles what happens when drag ends\r\n\t */\r\n\t_onEndDrag(){\r\n\t\tthis._groupEl.classed(style[\"dragging\"], false);\r\n\t\tif (!this._isOver) {\r\n\t\t\tthis.unsetHoverState();\r\n\t\t}\r\n\r\n\t\tthis._observable.fire(\"endDrag\", this);\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Handles handle drag \r\n\t */\r\n\t_handleDrag(){\r\n\t\tthis._handleEl.call(d3.drag()\r\n\t\t\t.on(\"drag\", this._onDrag.bind(this))\r\n\t\t\t.on(\"start\", this._onStartDrag.bind(this))\r\n\t\t\t.on(\"end\", this._onEndDrag.bind(this)));\r\n\t}\r\n\t/**\r\n\t * @private\r\n\t * Return computed or stored label length\r\n\t * @param {SVGElement}\r\n\t * @param {Number} length \r\n\t */\r\n\t_getComputedLabelTextLength(label){\r\n\t\tvar content = label.innerHTML;\r\n\t\tthis._labelSizeCache[content] = this._labelSizeCache[content] || label.getComputedTextLength();\r\n\t\treturn this._labelSizeCache[content];\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Updates label position\r\n\t * @param {Number} position \r\n\t */\r\n\t_updateLabelPosition(position) {\r\n\t\tvar label = this._handleLabelEl.node();\r\n\t\tvar maskPadding = this._options.fontSize;\t\t\r\n\r\n\t\t// we need to calculate text length so we can create mask and center text\r\n\t\tvar textLength = this._getComputedLabelTextLength(label);\r\n\t\tvar maskWidth = textLength + maskPadding * 2;\r\n\t\tvar xPosition = position - textLength / 2;\r\n\r\n\t\t// handle when dragging towards left side\r\n\t\tif (xPosition < 0) {\r\n\t\t\txPosition = 0;\r\n\t\t}\r\n\r\n\t\t// handle when dragging towards right side\r\n\t\tif (xPosition + textLength > this._options.width) {\r\n\t\t\txPosition = this._options.width  - textLength;\r\n\t\t\tthis._handleLabelEl.attr(\"x\", this._options.width);\r\n\t\t\tthis._handleLabelEl.attr(\"text-anchor\", \"end\");\r\n\t\t} else {\r\n\t\t\tthis._handleLabelEl.attr(\"x\", xPosition);\r\n\t\t\tthis._handleLabelEl.attr(\"text-anchor\", \"start\");\r\n\t\t}\r\n\r\n\t\t// position mask\r\n\t\tthis._handleMaskEl.attr(\"x\", () => {\r\n\t\t\treturn parseInt(xPosition) - maskPadding;\r\n\t\t});\r\n\r\n\t\tthis._handleMaskGradientEl.attr(\"x1\", xPosition - maskPadding);\r\n\t\tthis._handleMaskGradientEl.attr(\"x2\", xPosition + maskWidth - maskPadding);\r\n\r\n\t\tthis._handleMaskEl.attr(\"width\", maskWidth);\r\n\t\tthis._handleMaskEl.attr(\"height\", this._options.fontSize);\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Creates mask gradient element\r\n\t * @param {Number} handleIndex \r\n\t */\r\n\t_createMaskGradientElement(){\r\n\t\tthis._handleMaskGradientEl = this._groupEl.append(\"linearGradient\")\r\n\t\t\t.attr(\"id\", \"brush-mask-gradient-\" + gradientIndex++)\r\n\t\t\t.attr(\"gradientUnits\", \"userSpaceOnUse\")\r\n\t\t\t.attr(\"y1\", 0).attr(\"x1\", 50)\r\n\t\t\t.attr(\"y2\", 0).attr(\"x2\", 0);\r\n\r\n\t\tthis._handleMaskGradientEl.selectAll(\"stop\")\r\n\t\t\t.data([\r\n\t\t\t\t{ offset: \"0%\", color: \"rgba(255,255,255,0)\" },\r\n\t\t\t\t{ offset: \"20%\", color: \"rgba(255,255,255,1)\" },\r\n\t\t\t\t{ offset: \"80%\", color: \"rgba(255,255,255,1)\" },\r\n\t\t\t\t{ offset: \"100%\", color: \"rgba(255,255,255,0)\" }\r\n\t\t\t])\r\n\t\t\t.enter().append(\"stop\")\r\n\t\t\t.attr(\"offset\", function (d) { return d.offset; })\r\n\t\t\t.attr(\"stop-color\", function (d) { return d.color; });\r\n\r\n\t\treturn this._handleMaskGradientEl;\r\n\t}\r\n\r\n\t/**\r\n\t * @private \r\n\t * Renders main handle element \r\n\t * @returns {SVGElement}\r\n\t */\r\n\t_createHandleElement(){\r\n\t\tthis._handleEl = this._groupEl.append(\"rect\")\r\n\t\t\t.attr(\"class\", style[\"custom-handle\"])\r\n\t\t\t.attr(\"fill-opacity\", 0)\r\n\t\t\t.attr(\"data-handle-index\", this._index)\r\n\t\t\t.attr(\"data-handle-value\", this._value)\r\n\t\t\t.attr(\"cursor\", \"ew-resize\")\r\n\t\t\t.attr(\"width\", Defaults.ACTIVE_HANDLE_AREA_WIDTH)\r\n\t\t\t.attr(\"height\", this._options.height + 5)\r\n\t\t\t.attr(\"x\", this._position - Defaults.ACTIVE_HANDLE_AREA_WIDTH/2);\r\n\r\n\t\treturn this._handleEl;\r\n\t}\r\n\r\n\t/**\r\n\t * @private \r\n\t * Renders handle line element \r\n\t * @returns {SVGElement} \r\n\t */\r\n\t_createHandleLineElement(){\r\n\t\tthis._handleLineEl = this._groupEl.append(\"rect\")\r\n\t\t\t.attr(\"class\", style[\"custom-handle-line\"])\r\n\t\t\t.attr(\"width\", 4)\r\n\t\t\t.attr(\"height\", this._options.height)\r\n\t\t\t.attr(\"fill-opacity\", 0)\r\n\t\t\t.attr(\"x\", this._position - 2);\r\n\r\n\t\treturn this._handleLineEl;\r\n\t}\t\r\n\r\n\t/**\r\n\t * @private \r\n\t * Renders handle circle element \r\n\t * @returns {SVGElement} \r\n\t */\r\n\t_createHandleCircleElement(){\r\n\t\tthis._handleCircleEl = this._groupEl.append(\"circle\")\r\n\t\t\t.attr(\"class\", style[\"custom-handle-circle\"])\r\n\t\t\t.attr(\"transform\", \"translate(\" + this._position + \",\" + this._options.height + \")\")\r\n\t\t\t.attr(\"fill\", \"#ffffff\")\r\n\t\t\t.attr(\"fill-opacity\", 1)\r\n\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t.attr(\"stroke-width\", 1)\r\n\t\t\t.attr(\"cursor\", \"ew-resize\")\r\n\t\t\t.attr(\"r\", 3.5);\r\n\r\n\t\treturn this._handleCircleEl;\r\n\t}\t\t\r\n\r\n\t/**\r\n\t * @private \r\n\t * Renders drag mask element \r\n\t * @returns {SVGElement} \r\n\t */\r\n\t_createDragMaskElement(){\r\n\t\tthis._handleMaskEl = this._groupEl.append(\"rect\")\r\n\t\t\t.attr(\"class\", style[\"drag-label-mask\"])\r\n\t\t\t.attr(\"fill\", \"url(#brush-mask-gradient-\" + gradientIndex+\")\")\r\n\t\t\t.attr(\"y\", this._options.height + Defaults.LABEL_MARGIN)\r\n\t\t\t.attr(\"display\", \"none\");\t\t\t\r\n\r\n\t\treturn this._handleMaskEl;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @private \r\n\t * Renders handle label element \r\n\t * @returns {SVGElement}  \r\n\t */\r\n\t_createDragLabelElement(){\r\n\t\tvar format = this._options.format;\r\n\t\tvar height = this._options.height;\r\n\t\tthis._handleLabelEl = this._groupEl.append(\"text\")\r\n\t\t\t.attr(\"class\", style[\"drag-label\"])\r\n\t\t\t.attr(\"fill-opacity\", 0)\r\n\t\t\t.attr(\"font-size\", this._options.fontSize)\r\n\t\t\t.text(() => {\r\n\t\t\t\tvar formattedValue = format(this._initialValue);\r\n\t\t\t\treturn formattedValue;\r\n\t\t\t})\r\n\t\t\t.attr(\"y\", height + this._options.fontSize + Defaults.LABEL_MARGIN);\r\n\r\n\t\t\r\n\t\tthis._updateLabelPosition(this._position);\r\n\t\treturn this._handleLabelEl;\r\n\t}\r\n}","import style from \"../Histogram.css\";\r\nimport HistogramHandle from \"./HistogramHandle\";\r\nimport Observable from \"../../utils/Observable\";\r\nimport * as PositionUtils from \"../utils/PositionUtils\"\r\nimport * as d3 from \"d3\";\r\n\r\n/**\r\n * @class\r\n * Histogram renderer class\r\n * @param {Object} options\r\n */\r\nexport default class HistogramSelectionRenderer {\r\n    constructor(options) {\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Histogram options\r\n\t\t */\r\n\t\tthis._options = options;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Main group element of this widget\r\n\t\t */\r\n\t\tthis._groupEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * Bar data \r\n\t\t */\r\n\t\tthis._histogramData = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * history selection\r\n\t\t */\r\n\t\tthis._histogramSelection = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * index of over selection  \r\n\t\t */\r\n\t\tthis._overSelectionIndex = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * true if histogram has been rendered\r\n\t\t */\r\n\t\tthis._rendered = false;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * selection handles\r\n\t\t */\r\n\t\tthis._handles = [];\t\t\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * true if handle is dragged\r\n\t\t */\r\n\t\tthis._draggingHandle = false;\t\t\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * stores previous selection for animation\r\n\t\t */\r\n\t\tthis._prevSelection = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * true if histogram has been rendered\r\n\t\t */\r\n\t\tthis._rendered = false;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * true if animation is run\r\n\t\t */\r\n\t\tthis._animating = false;\r\n\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * observable handler\r\n\t\t */\r\n\t\tthis._observable = new Observable([\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when mouse is over a category\r\n\t\t\t * @param {int} selectionIndex\r\n\t\t\t */\r\n\t\t\t\"selectionOver\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when selection is toggled\r\n\t\t\t * @param {int} selectionIndex\r\n\t\t\t * @param {bool} enabled\r\n\t\t\t */\r\n\t\t\t\"toggleSelection\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when selection is changed\r\n\t\t\t * @param {int} selectionIndex\r\n\t\t\t * @param {bool} enabled\r\n\t\t\t */\r\n\t\t\t\"selectionChanged\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when user clicks on a handle\r\n\t\t\t * @param {int} handleIndex\r\n\t\t\t * @param {Number} handleValue\r\n\t\t\t */\r\n\t\t\t\"handleClick\"\r\n\t\t]);\t\t\r\n    }\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns whether histogram has been rendered or not\r\n\t * @returns {boolean} true if histogram has been rendered\r\n\t */\r\n\tisRendered(){\r\n\t\treturn this._rendered;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * @param {DOMElement}  \r\n\t * @returns {HistogramSelectionRenderer} returns this widget instance\r\n\t */\r\n\trender(groupEl){\r\n\t\tthis._rendered = true;\r\n\t\tthis._groupEl = groupEl\r\n\r\n\t\treturn this;\r\n\t} \t\r\n\r\n\t/**\r\n\t * @public\r\n\t * Bind handle event\r\n\t * @param {String} event event name\r\n\t * @param {Function} handler event handler\r\n\t * @returns {HistogramHandle} returns this handle instance\r\n\t */\r\n\ton(eventName, handler) {\r\n\t\tthis._observable.on(eventName, handler);\r\n\t\treturn this;\r\n\t}\t \r\n\r\n\t/**\r\n\t * @private\r\n\t * Clears selection controls and data \r\n\t */\r\n\t_clear(){\r\n\t\tthis._destroyHandles();\r\n\t\tif (this._selectionBars){\r\n\t\t\tthis._selectionBars.remove();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Destroys selection controls \r\n\t */\r\n\t_destroyHandles(){\r\n\t\tthis._handles.forEach(handle=>handle.destroy());\r\n\t\tthis._handles = [];\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Handles click on handle\r\n\t * @param {Number} handleIndex\r\n\t * @param {Number} handleValue \r\n\t */\r\n\t_onHandleClick(handleIndex, handleValue){\r\n\t\t// call prompt handler if available\r\n\t\tif (this._options.promptHandler){\r\n\t\t\tthis._options.promptHandler(handleValue).then((promptResult)=>{\r\n\t\t\t\tvar startSelectionSnapshot = JSON.stringify(this._histogramSelection.getOutputSelection());\r\n\t\t\t\tpromptResult = parseFloat(promptResult);\r\n\t\t\t\t// must be within min max range\r\n\t\t\t\tvar minMax = this._histogramData.getMinMax();\r\n\t\t\t\tpromptResult = Math.min(minMax.max, promptResult);\r\n\t\t\t\tpromptResult = Math.max(minMax.min, promptResult);\r\n\r\n\t\t\t\tvar points = this._histogramSelection.getSelectionPoints();\r\n\t\t\t\tpoints[handleIndex] = {\r\n\t\t\t\t\tvalue:promptResult\r\n\t\t\t\t};\r\n\r\n\t\t\t\tvar positions = points\r\n\t\t\t\t\t.sort((p1,p2)=>p1.value-p2.value)\r\n\t\t\t\t\t.map(point=>this._histogramData.valueToPosition(point.value));\r\n\t\t\t\t\r\n\t\t\t\tthis._updateSelectionPositions(positions, points);\r\n\t\t\t\tthis._updateSelection();\r\n\r\n\t\t\t\t// TODO: update handles without destroying them\r\n\t\t\t\tthis._destroyHandles();\r\n\t\t\t\tthis._renderHandles();\r\n\r\n\t\t\t\t// fire selection change if selection is changed\r\n\t\t\t\tif (JSON.stringify(this._options.selection) != startSelectionSnapshot){\r\n\t\t\t\t\tthis._observable.fire(\"selectionChanged\", this._histogramSelection.getOutputSelection());\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tthis._observable.fire(\"handleClick\", handleIndex, handleValue);\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Toggles selection\r\n\t * @param {Number} selectionIndex \r\n\t */\r\n\t_toggleSelection(selectionIndex){\r\n\t\tvar selection = this._options.selection[selectionIndex];\r\n\t\tselection.disabled = !selection.disabled;\r\n\t\tvar enabled = !selection.disabled;\r\n\t\tthis._updateSelection();\r\n\t\tthis._observable.fire(\"toggleSelection\", selectionIndex, enabled);\r\n\t}\t\r\n\r\n\t/**\r\n\t * @private\r\n\t * Handles click on chart\r\n\t */\r\n\t_onClick(){\r\n\t\tvar target = d3.select(d3.event.target);\r\n\t\tvar selectionIndex = target.attr(\"data-selection-index\");\r\n\t\tvar handleIndex = target.attr(\"data-handle-index\");\r\n\r\n\t\tif (selectionIndex != null && this._histogramSelection.allowsToggle()){\r\n\t\t\tthis._toggleSelection(selectionIndex)\r\n\t\t} else if (handleIndex != null){\r\n\t\t\tthis._onHandleClick(handleIndex, target.attr(\"data-handle-value\"));\r\n\t\t}\r\n\t}\r\n\t/**\r\n\t * @private\r\n\t * Handles handle click \r\n\t */\r\n\t_handleClick(){\r\n\t\tthis._groupEl.on(\"click\", this._onClick.bind(this));\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Refreshes histogram data \r\n\t * @param {HistogramData}\r\n\t * @param {HistogramSelection}\r\n\t * @param {Object} options\r\n\t */\r\n\trefresh(histogramData, histogramSelection, options){\r\n\t\tthis._animate = options && options.animate;\r\n\t\tif (this._animate && this._histogramSelection && this._histogramSelection.getSelection().length == histogramSelection.getSelection().length){\r\n\t\t\tthis._prevSelection = this._histogramSelection.getSelection();\r\n\t\t\tthis._prevHistogramData = this._histogramSelection.getSelection();\r\n\t\t}\r\n\r\n\t\tif (this._animate && this._histogramData){\r\n\t\t\tthis._prevHistogramData = this._histogramData;\r\n\t\t}\r\n\r\n\t\tthis._histogramData = histogramData;\r\n\t\tthis._histogramSelection = histogramSelection;\r\n\t\t\r\n\t\tthis._clear();\r\n\t\tthis._renderSelection();\r\n\t\tthis._updateSelection();\r\n\r\n\t\tthis._handleHoverState();\r\n\t\tthis._handleClick();\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Updates selection controls on hover\r\n\t * @param {Number} selectionIndex \r\n\t */\r\n\t_updateSelectionControlsHoverState(selectionIndex){\r\n\t\t// get all handles sorted by X position\r\n\t\tvar handles = this._handles.slice().sort((h1,h2)=>{\r\n\t\t\treturn h1.getXPosition() - h2.getXPosition();\r\n\t\t});\r\n\r\n\t\t// unset hover state on all handles\r\n\t\thandles.forEach(handle=>handle.unsetHoverState());\r\n\r\n\t\t// selection is active, active both handles for active selection\r\n\t\tif (selectionIndex != null){\r\n\t\t\tvar handle1 = handles[selectionIndex];\r\n\t\t\tvar handle2 = handles[selectionIndex+1];\r\n\r\n\t\t\thandle1.setHoverState();\r\n\t\t\thandle2.setHoverState();\r\n\r\n\t\t\tvar labelOffsets = PositionUtils.getHandlePositionOffsets(handle1, handle2, this._options.fontSize, this._options.width);\r\n\r\n\t\t\thandle1.setLabelOffset(labelOffsets[0]);\r\n\t\t\thandle2.setLabelOffset(labelOffsets[1]);\r\n\t\t}\r\n\t}\t\r\n\r\n\t/**\r\n\t * \r\n\t * @private \r\n\t * Handles what happens when mouse is over selection\r\n\t * @param {String} type \r\n\t * @param {Number} i \r\n\t * @param {HTMLElement[]} array \r\n\t */\r\n\t_onSelectionMouseOver(d, i, nodes){\r\n\t\t// prevent selection when dragging handles\r\n\t\tif (this._draggingHandle){\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\td3.select(nodes[i]).attr(\"fill\", \"rgba(0,0,0,0.00)\")\r\n\t\tvar selectionIndex = parseInt(d3.select(d3.event.target).attr(\"data-selection-index\"));\r\n\t\tif (this._overSelectionIndex != selectionIndex){\r\n\t\t\tthis._overSelectionIndex = selectionIndex;\r\n\t\t\tthis._updateSelection();\r\n\t\t\tthis._updateSelectionControlsHoverState(selectionIndex);\r\n\t\t\tthis._observable.fire(\"selectionOver\", this._overSelectionIndex);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * \r\n\t * @private \r\n\t * Handles what happens when mouse is out of selection\r\n\t * @param {String} type \r\n\t * @param {Number} i \r\n\t * @param {HTMLElement[]} array \r\n\t */\r\n\t_onSelectionMouseOut(d, i, nodes){\r\n\t\t// prevent selection when dragging handles\r\n\t\tif (this._draggingHandle){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\td3.select(nodes[i]).attr(\"fill\", \"rgba(0,0,0,0)\")\r\n\r\n\t\tthis._overSelectionIndex = null;\r\n\t\tthis._updateSelectionControlsHoverState(null);\r\n\t\tthis._updateSelection();\r\n\t\tthis._observable.fire(\"selectionOver\", this._overSelectionIndex);\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * @private \r\n\t * Handles hover state\r\n\t */\r\n\t_handleHoverState(){\r\n\t\tvar g = this._groupEl;\r\n\t\tg.selectAll(\".\"+style.selectionbar).on(\"mouseout\", this._onSelectionMouseOut.bind(this));\r\n\t\tg.selectAll(\".\"+style.selectionbar).on(\"mouseover\", this._onSelectionMouseOver.bind(this));\r\n\t}\t\r\n\r\n\t/**\r\n\t * @private \r\n\t * Handles when handle is dragged\r\n\t */\r\n\t_onHandleDrag(){\r\n\t\tvar positions = this._handles.map(handle=>handle.getXPosition()).sort((p1, p2)=>{\r\n\t\t\treturn p1-p2;\r\n\t\t});\r\n\r\n\t\tthis._updateSelectionPositions(positions);\r\n\t\tthis._updateSelection();\r\n\t}\r\n\r\n\t/**\r\n\t* @private\r\n\t* Updates selection with new positions\r\n\t* @param {Array} positions\r\n\t* @param {Array} points\r\n\t*/\r\n\t_updateSelectionPositions(positions, points){\r\n\t\tvar selection = this._histogramSelection.getSelection();\r\n\t\tpositions.forEach((p, index)=>{\r\n\t\t\tif (index>selection.length-1){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar position = {\r\n\t\t\t\tfrom:p,\r\n\t\t\t\tto:positions[index+1]\r\n\t\t\t};\r\n\r\n\t\t\tvar value = {\r\n\t\t\t\tfrom:points?points[index].value:this._histogramData.positionToValue(position.from),\r\n\t\t\t\tto:points?points[index+1].value:this._histogramData.positionToValue(position.to),\r\n\t\t\t};\r\n\r\n\t\t\t[\"from\", \"to\"].forEach(pos=>{\r\n\t\t\t\tconst selectionChanged = points?\r\n\t\t\t\t\t// if new points are given, we need to compare selection values\r\n\t\t\t\t\tselection[index][pos] !== value[pos]:\r\n\t\t\t\t\t// otherwise, we need to compare selection position\r\n\t\t\t\t\tselection[index][\"position\"][pos] !== position[pos];\r\n\r\n\t\t\t\t// update selection on change\r\n\t\t\t\tif (selectionChanged){\r\n\t\t\t\t\tselection[index][pos] = value[pos];\t\r\n\t\t\t\t\tselection[index][\"position\"][pos] = position[pos];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t}\t\r\n\r\n\t/**\r\n\t* @private\r\n\t* Renders selection bars\r\n\t*/\r\n\t_renderSelection() {\r\n\t\tvar height = this._options.height;\r\n\t\tvar selection = this._histogramSelection.getSelection();\r\n\r\n\t\t// hover selection bars\r\n\t\tthis._selectionBars = this._groupEl.selectAll(\".\"+style.selectionbar)\r\n\t\t\t.data(selection)\r\n\t\t\t.enter().append(\"rect\")\r\n\t\t\t.attr(\"class\", style.selectionbar)\r\n\t\t\t.attr(\"y\", 0)\r\n\t\t\t.attr(\"fill\", \"rgba(0,0,0,0.00)\")\r\n\t\t\t.attr(\"height\", height);      \r\n\r\n\r\n\t\tthis._renderHandles();\r\n\t}\r\n\r\n\t/**\r\n\t* @private\r\n\t* Renders selection controls\r\n\t*/\r\n\t_renderHandles(){\r\n\t\t// render selection controls\r\n\t\tthis._handles = this._histogramSelection.getSelectionPoints().map((point, index)=>{\r\n\t\t\tvar value = point.value;\r\n\r\n\t\t\tvar handle = new HistogramHandle(this._groupEl, value, index, this._histogramData, this._options);\r\n\r\n\t\t\tif(point.hidden){\r\n\t\t\t\thandle.hide();\r\n\t\t\t}\r\n\r\n\t\t\thandle.on(\"drag\", ()=>{\r\n\t\t\t\tthis._onHandleDrag();\r\n\t\t\t}, this);\r\n\r\n\t\t\tvar startSelectionSnapshot;\r\n\r\n\t\t\t// disable other handles when draggin starts\r\n\t\t\thandle.on(\"startDrag\", ()=>{\r\n\t\t\t\tstartSelectionSnapshot = JSON.stringify(this._options.selection);\r\n\t\t\t\t\r\n\t\t\t\tthis._draggingHandle = true;\r\n\t\t\t\tthis._handles.forEach(handle=>handle.disable());\r\n\t\t\t\thandle.enable();\r\n\t\t\t}, this);\r\n\r\n\t\t\t// enable all handles when draggin starts\r\n\t\t\thandle.on(\"endDrag\", ()=>{\r\n\t\t\t\tthis._draggingHandle = false;\r\n\t\t\t\tthis._handles.forEach(handle=>handle.enable());\r\n\r\n\t\t\t\tif (JSON.stringify(this._options.selection) != startSelectionSnapshot){\r\n\t\t\t\t\tthis._observable.fire(\"selectionChanged\", this._histogramSelection.getOutputSelection());\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\r\n\t\t\r\n\t\t\treturn handle;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t* @private\r\n\t* Returns bar color based on X position\r\n\r\n\t* @param {Number} barX\r\n\t* @param {Array} selection\r\n\t* @returns {Number} bar category index\r\n\t* @param {HistogramData} histogram data \r\n\t*/\r\n\t_getBarSelectionIndex(barX, selection, data){\r\n\t\tfor (var i=0;i<selection.length;i++){\r\n\t\t\tvar s = selection[i];\r\n\t\t\tvar isLast = i == selection.length-1;\r\n\t\t\tvar within = barX >= data.valueToPosition(s.from) && (barX < data.valueToPosition(s.to) || (isLast && barX <= data.valueToPosition(s.to)));\r\n\t\t\tif (within) return i;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\t\r\n\r\n\t/**\r\n\t * @private\r\n\t * Returns selection color\r\n\t * @param {Object} selection\r\n\t * @param {Object} d datum\r\n\t */\r\n\t_getSelectionColor(selection, d){\r\n\t\tif (selection.colors){\r\n\t\t\treturn selection.colors[d.volumeIndex];\r\n\t\t}\r\n\r\n\t\tif (selection.color){\r\n\t\t\treturn selection.color\r\n\t\t}\r\n\r\n\t\treturn this._options.selectionColor;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Returns bar color for given bar position with given selection\r\n\t * @param {Number} barX \r\n\t * @param {Array} selection \r\n\t * @param {HistogramData} histogram data \r\n\t */\r\n\t_getBarColor (barX, selection, data, d){\r\n\t\tvar inactiveBarColor = this._options.inactiveBarColor;\r\n\t\tvar overSelectionColor = this._options.overSelectionColor;\r\n\t\t\r\n\t\tvar barSelectionIndex = this._getBarSelectionIndex(barX, selection, data);\r\n\t\tif (barSelectionIndex == null){\r\n\t\t\treturn inactiveBarColor;\r\n\t\t} else if (selection[barSelectionIndex].disabled){\r\n\t\t\treturn inactiveBarColor;\r\n\t\t} if (this._histogramSelection.allowsToggle() && this._overSelectionIndex == barSelectionIndex){\r\n\t\t\treturn overSelectionColor;\r\n\t\t} else {\r\n\t\t\treturn this._getSelectionColor(selection[barSelectionIndex], d);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Returns bar color for given bar position with given selection\r\n\t * @param {Number} barX \r\n\t * @param {Array} selection \r\n\t * @param {HistogramData} histogram data \r\n\t */\r\n\t_getBarOpacity (barX, selection, data){\r\n\t\tvar defaultOpacity = 1;\r\n\r\n\t\tvar barSelectionIndex = this._getBarSelectionIndex(barX, selection, data);\r\n\t\tvar isOver = this._histogramSelection.allowsToggle() && this._overSelectionIndex == barSelectionIndex;\r\n\t\tvar isDisabled = barSelectionIndex != null && selection[barSelectionIndex].disabled;\r\n\r\n\t\tif (isOver){\r\n\t\t\treturn this._options.overSelectionOpacity;\r\n\t\t}\r\n\r\n\t\tif (isDisabled){\r\n\t\t\treturn this._options.inactiveBarOpacity;\r\n\t\t}\r\n\t\t\r\n\t\t// otherwise use set opacity if \r\n\t\tif (barSelectionIndex != null && selection[barSelectionIndex].opacity != null){\r\n\t\t\treturn selection[barSelectionIndex].opacity;\r\n\t\t} \r\n\r\n\t\treturn defaultOpacity;\r\n\t}\t\r\n\r\n\t/**\r\n\t * Runs onTransition as a transition between two selections\r\n\t * @param {Array} selection1 \r\n\t * @param {Array} selection2 \r\n\t * @param {Function} onTransition handler\r\n\t */\r\n\t_onSelectionTransition(selection1, selection2, data1, data2, onTransition, onComplete){\r\n\t\tselection1.forEach((s1,selectionIndex)=>{\r\n\t\t\tvar s2 = selection2[selectionIndex];\r\n\t\t\tvar width = this._options.width;\r\n\t\t\tif (selection1[selectionIndex]){\r\n\t\t\t\tvar transitions = [];\r\n\t\t\t\tvar frames = [];\r\n\r\n\t\t\t\ttransitions.push([Math.round(data1.valueToPosition(s1.from)), Math.round(data2.valueToPosition(s2.from))]);\r\n\t\t\t\ttransitions.push([Math.round(data1.valueToPosition(s1.to)), Math.round(data2.valueToPosition(s2.to))]);\r\n\r\n\t\t\t\t// make sure duration is calculated based on transition length\r\n\t\t\t\tframes = [Math.abs((transitions[0][0] - transitions[0][1])/width), Math.abs((transitions[1][0] - transitions[1][1])/width)];\r\n\r\n\t\t\t\ttransitions.forEach((t, handleIndex)=>{\r\n\t\t\t\t\tvar duration = 0;\r\n\r\n\t\t\t\t\twhile(t[0] !== t[1]){\r\n\t\t\t\t\t\tsetTimeout(onTransition.bind(this, t[0], selectionIndex, handleIndex), duration);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tduration = duration+0.5/frames[handleIndex];\r\n\t\t\t\t\t\tt[0] = t[0]>t[1]?t[0]-1:t[0]+1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// call final complete fn only if duration is > 0, this prevents premature animation end\r\n\t\t\t\t\t// when one of the sides is in the same position\r\n\t\t\t\t\tif (duration>0){\r\n\t\t\t\t\t\tsetTimeout(function(p, si, hi){\r\n\t\t\t\t\t\t\tonTransition(p, si, hi)\r\n\t\t\t\t\t\t\tonComplete(p, si, hi);\r\n\t\t\t\t\t\t}.bind(this, t[1], selectionIndex, handleIndex), ++duration);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t* @private\r\n\t* Updates selection\r\n\t*/\r\n\t_updateSelection(){\r\n\t\tvar selection = this._histogramSelection.getSelection();\r\n\t\tvar bars = this._groupEl.selectAll(\".\"+style.bar);\r\n\r\n\t\t// fills bars with given selection\r\n\t\tvar fillBars = (s, data) => {\r\n\t\t\t// handle bar colors\r\n\t\t\tbars.attr(\"fill\", (d)=> {\r\n\t\t\t\tvar barX = this._histogramData.valueToPosition(d.value);\r\n\t\t\t\treturn this._getBarColor(barX, s, data, d);\r\n\t\t\t})\r\n\r\n\t\t\t// handle bar opacity\r\n\t\t\tbars.attr(\"fill-opacity\", (d)=> {\r\n\t\t\t\tvar barX = this._histogramData.valueToPosition(d.value);\r\n\t\t\t\treturn this._getBarOpacity(barX, s, data, d);\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// handle animation if previous selection is set\r\n\t\tif (this._animate && this._prevSelection){\r\n\t\t\tvar prevSelection = this._prevSelection;\r\n\t\t\tvar prevData = this._prevHistogramData;\r\n\t\t\t\r\n\t\t\t// set prev selection\r\n\t\t\tfillBars(prevSelection, this._prevHistogramData);\r\n\r\n\t\t\t// set handle positions to prev selection\r\n\t\t\tprevSelection.forEach((s, i)=>{\r\n\t\t\t\tvar p1 = this._prevHistogramData.valueToPosition(s.from);\r\n\t\t\t\tvar p2 = this._prevHistogramData.valueToPosition(s.to);\r\n\r\n\t\t\t\tthis._handles[i].setHandleXPosition(p1).setLabelPosition(p1);\r\n\t\t\t\tthis._handles[i+1].setHandleXPosition(p2).setLabelPosition(p2)\r\n\t\t\t});\r\n\r\n\t\t\tthis._animating = true;\r\n\t\t\t//fill bars on selection transition and move handles\r\n\t\t\tthis._onSelectionTransition(prevSelection, selection, prevData, this._histogramData, \r\n\t\t\t\t// on transition callback\r\n\t\t\t\t(p, selectionIndex, handleIndex)=>{\r\n\t\t\t\t\tvar bar = d3.select(bars.nodes()[p]);\r\n\t\t\t\t\tbar.attr(\"fill\", d=>{\r\n\t\t\t\t\t\treturn this._getBarColor(p, selection, this._histogramData, d);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t//var handleText = this._options.format(this._histogramData.positionToValue(p));\r\n\t\t\t\t\t// move handles\r\n\t\t\t\t\t[this._handles[selectionIndex], this._handles[selectionIndex+1]][handleIndex].setHandleXPosition(p).setLabelPosition(p)\r\n\r\n\t\t\t\t// on complete callback\t\t\r\n\t\t\t},()=>{\r\n\t\t\t\t\t// hide handles\r\n\t\t\t\t\t//[this._handles[selectionIndex], this._handles[selectionIndex+1]][handleIndex].hideLabel();\r\n\t\t\t\t\tfillBars(selection, this._histogramData)\r\n\t\t\t\t\tthis._animating = false;\r\n\t\t\t\t}\r\n\t\t\t);\r\n\r\n\t\t\tthis._prevSelection = null;\r\n\t\t\tthis._prevHistogramData = null;\r\n\t\t\r\n\t\t} else {\r\n\t\t\tfillBars(selection, this._histogramData)\r\n\t\t}\r\n\t\t\r\n\t\t// selection rects\r\n\t\tthis._groupEl.selectAll(\".\"+style.selectionbar)\r\n\t\t\t.data(selection)\r\n\t\t\t.attr(\"data-selection-index\", function(d,i){\r\n\t\t\t\treturn i;\r\n\t\t\t})\r\n\t\t\t.attr(\"x\", (d) => { \r\n\t\t\t\treturn this._histogramData.valueToPosition(d.from);\r\n\t\t\t})\r\n\t\t\t.attr(\"width\", (d) => {\r\n\t\t\t\treturn this._histogramData.valueToPosition(d.to) - this._histogramData.valueToPosition(d.from);\r\n\t\t\t})\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Shows selection labels\r\n\t */\r\n\tshowSelectionLabels(){\r\n\t\t// show label without calculating offsets when animating\r\n\t\tif (this._animating) {\r\n\t\t\treturn this._handles.forEach(handle=>handle.showLabel());\r\n\t\t}\r\n\r\n\t\tthis._histogramSelection.getSelection().forEach((s,i)=>{\r\n\t\t\tvar handle1 = this._handles[i];\r\n\t\t\tvar handle2 = this._handles[i+1];\r\n\r\n\t\t\tvar labelOffsets = PositionUtils.getHandlePositionOffsets(handle1, handle2, this._options.fontSize, this._options.width);\r\n\t\t\thandle1.setLabelOffset(labelOffsets[0]);\r\n\t\t\thandle2.setLabelOffset(labelOffsets[1]);\r\n\t\t});\r\n\t\t\r\n\t\tthis._handles.forEach(handle=>handle.showLabel());\r\n\t}\r\n\r\n\t/**\r\n\t * Hides selection labels\r\n\t */\r\n\thideSelectionLabels(){\r\n\t\tthis._handles.forEach(handle=>handle.hideLabel());\r\n\t}\t\t\r\n\r\n\t/**\r\n\t * @public\r\n\t * Destorys histogram UI  \r\n\t */\r\n\tdestroy() {\r\n\t\tthis._observable.destroy();\r\n\t\tthis._clear();\r\n\r\n\t\treturn this;\r\n    }\t\t\r\n}","import style from \"./Histogram.css\";\r\nimport HistogramSelectionRenderer from \"./selection/HistogramSelectionRenderer\";\r\nimport * as Defaults from \"./HistogramDefaults\";\r\nimport Observable from \"../utils/Observable\";\r\nimport * as d3 from \"d3\";\r\n\r\n/**\r\n * @class\r\n * Histogram renderer class\r\n * @param {Object} options\r\n */\r\nexport default class HistogramRenderer {\r\n    constructor(options) {\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Histogram options\r\n\t\t */\r\n\t\tthis._options = options;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * DOM container of this widget\r\n\t\t */\r\n\t\tthis._containerEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Main group element of this widget\r\n\t\t */\r\n\t\tthis._groupEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Main SVG element of this widget\r\n\t\t */\r\n\t\tthis._svgEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * Bar data \r\n\t\t */\r\n\t\tthis._historyData = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * X axis\r\n\t\t */\r\n\t\tthis._xAxis = d3.scaleBand().range([0, options.width]);\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * Y axis\r\n\t\t */\r\n\t\tthis._yAxis = d3.scaleLinear().range([options.height, 0]);\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * true if histogram has been rendered\r\n\t\t */\r\n\t\tthis._rendered = false;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * stores previous data for animation\r\n\t\t */\r\n\t\tthis._prevData = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * selection renderer\r\n\t\t */\r\n\t\tthis._selectionRenderer = new HistogramSelectionRenderer(options);\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * True if labels are visible\r\n\t\t */\r\n\t\tthis._labelsVisible = false;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * observable handler\r\n\t\t */\r\n\t\tthis._observable = new Observable([\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when mouse is over a category\r\n\t\t\t * @param {int} selectionIndex\r\n\t\t\t */\r\n\t\t\t\"selectionOver\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when selection is toggled\r\n\t\t\t * @param {int} selectionIndex\r\n\t\t\t * @param {bool} enabled\r\n\t\t\t */\r\n\t\t\t\"toggleSelection\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when selection is changed\r\n\t\t\t * @param {Array} selection\r\n\t\t\t */\r\n\t\t\t\"selectionChanged\",\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when user clicks on a handle\r\n\t\t\t * @param {int} handleIndex\r\n\t\t\t * @param {Number} handleValue\r\n\t\t\t */\r\n\t\t\t\"handleClick\"\r\n\t\t]);\t\t\r\n\r\n\t\t// relay selection events\r\n\t\tthis._selectionRenderer.on(\"selectionOver\", (selectionIndex)=>{\r\n\t\t\tthis._observable.fire(\"selectionOver\", selectionIndex);\r\n\t\t});\r\n\r\n\t\tthis._selectionRenderer.on(\"toggleSelection\", (selectionIndex, enabled)=>{\r\n\t\t\tthis._observable.fire(\"toggleSelection\", selectionIndex, enabled);\r\n\t\t});\r\n\r\n\t\tthis._selectionRenderer.on(\"selectionChanged\", (selection)=>{\r\n\t\t\tthis._observable.fire(\"selectionChanged\", selection);\r\n\t\t});\r\n\r\n\t\tthis._selectionRenderer.on(\"handleClick\", (handleIndex, handleValue)=>{\r\n\t\t\tthis._observable.fire(\"handleClick\", handleIndex, handleValue);\r\n\t\t});\t\t\r\n    }\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns whether histogram has been rendered or not\r\n\t * @returns {boolean} true if histogram has been rendered\r\n\t */\r\n\tisRendered(){\r\n\t\treturn this._rendered;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Bind handle event\r\n\t * @param {String} event event name\r\n\t * @param {Function} handler event handler\r\n\t * @returns {HistogramHandle} returns this handle instance\r\n\t */\r\n\ton(eventName, handler) {\r\n\t\tthis._observable.on(eventName, handler);\r\n\t\treturn this;\r\n\t}\t\r\n\r\n\t/**\r\n\t * @public\r\n\t * Render logic of this widget\r\n\t * @param {String|DOMElement} selector selector or DOM element \r\n\t * @returns {Histogram} returns this widget instance\r\n\t */\r\n\trender(selector){\r\n\t\t// get container element using selector or given element\r\n\t\tvar ct = this._containerEl = d3.select(selector);\r\n\t\tvar width = this._options.width;\r\n\t\tvar height = this._options.height;\r\n\t\tvar margin = Defaults.MARGIN;\r\n\r\n\t\t// render SVG\r\n\t\tvar svg = this._svgEl = ct.append(\"svg\")\r\n\t\t\t.attr(\"width\", width + margin.left + margin.right)\r\n\t\t\t.attr(\"height\", height + margin.top + this._options.fontSize + margin.bottom)\r\n\t\t\t.classed(style.histogram, true);\r\n\r\n\t\t// render group element\r\n\t\tvar g = this._groupEl = this._svgEl.append(\"g\")\r\n\t\t\t.classed(style.inactive, true)\r\n\t\t\t.attr(\"transform\",\r\n\t\t\t\"translate(\" + margin.left + \",\" + margin.top + \")\");\r\n\r\n\t\t// handle hover over svg element\r\n\t\tsvg.on(\"mouseover.hover\", ()=>{\r\n\t\t\tg.classed(style.active, true)\r\n\t\t\tg.classed(style.inactive, false)\r\n\t\t})\r\n\r\n\t\tsvg.on(\"mouseout.hover\", ()=>{\r\n\t\t\tg.classed(style.inactive, true)\r\n\t\t\tg.classed(style.active, false)\r\n\t\t})\r\n\r\n\t\tthis._selectionRenderer.render(g);\r\n\r\n\t\tthis._rendered = true;\r\n\r\n\t\treturn this;\r\n\t} \r\n\r\n\t/**\r\n\t * @private\r\n\t * Clears selection controls and data \r\n\t */\r\n\t_clear(){\r\n\t\tthis._groupEl.node().innerHTML = \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Refreshes histogram data \r\n\t * @param {HistogramData}\r\n\t * @param {HistogramSelection}\r\n\t * @param {Object} options\r\n\t */\r\n\trefresh(histogramData, histogramSelection, options){\r\n\t\tthis._animate = options && options.animate;\r\n\r\n\t\tthis._histogramData = histogramData;\t\t\r\n\t\tthis._clear();\r\n\r\n\t\tthis._xAxis.domain(histogramData.getData().map(function (d) {return d.value; }));\r\n\t\tthis._yAxis.domain([0, d3.max(histogramData.getData(), function (d) { return Math.max.apply(Math, d.volume); })]);\r\n\r\n\t\tthis._renderXAxis();\t\t\r\n\t\tthis._renderDataBars();\r\n\r\n\t\tthis._prevData = histogramData.getData();\t\t\t\r\n\r\n\t\tthis._selectionRenderer.refresh(histogramData, histogramSelection, options);\t\r\n\r\n\t\tif (this._labelsVisible){\r\n\t\t\tthis.showSelectionLabels()\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * Shows selection labels\r\n\t */\r\n\tshowSelectionLabels(){\r\n\t\tthis._selectionRenderer.showSelectionLabels();\r\n\t\t// hide axis labels when selection labels are visible\r\n\t\tthis._groupEl.selectAll(\".\"+style[\"x-axis\"]).attr(\"display\", \"none\");\r\n\t\tthis._labelsVisible = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Hides selection labels\r\n\t */\r\n\thideSelectionLabels(){\r\n\t\tthis._selectionRenderer.hideSelectionLabels();\r\n\t\t// show axis labels when selection labels are not visible\r\n\t\tthis._groupEl.selectAll(\".\"+style[\"x-axis\"]).attr(\"display\", \"block\");\t\t\r\n\t\tthis._labelsVisible = false;\r\n\t}\t\r\n\r\n\t/**\r\n\t * @private\r\n\t * Renders data bars\r\n\t*/\r\n\t_renderDataBars() { \r\n\t\tvar data = this._histogramData.getData();\r\n\t\t// var prevData = this._prevData;\r\n\t\tvar height = this._options.height;\r\n\r\n\t\tvar y = this._yAxis;\r\n\r\n\t\tdata.forEach(d=>{\r\n\t\t\td.volume.forEach((v, i)=>{\r\n\t\t\t\tthis._groupEl\r\n\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t.datum({\r\n\t\t\t\t\t\tvalue:d.value,\r\n\t\t\t\t\t\tvolumeIndex:i\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.attr(\"class\", style.bar)\r\n\t\t\t\t\t.attr(\"x\", this._histogramData.valueToPosition(d.value))\r\n\t\t\t\t\t.attr(\"width\", \"1\")\r\n\t\t\t\t\t.attr(\"y\", Math.floor(y(d.volume[i])))\r\n\t\t\t\t\t.attr(\"height\", Math.ceil(height - y(d.volume[i])))\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t* @private\r\n\t* Renders X axis \r\n\t*/        \r\n\t_renderXAxis(){\r\n\t\tvar minMax = this._histogramData.getMinMax();\r\n\t\tvar format = this._options.format;\r\n\t\tvar height = this._options.height + this._options.fontSize + Defaults.LABEL_MARGIN;\r\n\r\n\t\tthis._groupEl.selectAll(\".\"+style[\"x-axis\"])\r\n\t\t\t.data([minMax.min, minMax.max])\r\n\t\t\t.enter()\r\n\t\t\t.append(\"text\")\r\n\t\t\t.text((d)=>format(d))\r\n\t\t\t.attr(\"font-size\", this._options.fontSize)\r\n\t\t\t.attr(\"transform\", (d, i)=>{\r\n\t\t\t\treturn [\r\n\t\t\t\t\t\"translate(\"+0+\",\" + height + \")\",\r\n\t\t\t\t\t\"translate(\"+this._options.width+\",\" + height + \")\"\r\n\t\t\t\t][i]\r\n\t\t\t})\r\n\t\t\t.attr(\"text-anchor\", function(d, i){\r\n\t\t\t\treturn [\"start\", \"end\"][i];\r\n\t\t\t})\r\n\t\t\t.classed(style[\"x-axis\"], true)\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Destorys histogram UI  \r\n\t */\r\n\tdestroy() {\r\n\t\tif (this._rendered){\r\n\t\t\tthis._containerEl.node().removeChild(this._svgEl.node());\r\n\t\t}\r\n\r\n\t\tthis._observable.destroy();\r\n\t\tthis._selectionRenderer.destroy();\r\n\r\n\t\treturn this;\r\n    }\t\r\n\t\r\n}","/**\n * @abstract\n * abstract HistogramSelection class\n */\nexport default class HistogramSelection {\n\tconstructor(histogramData, selection){\n\t\tthis._selection = selection.map(s=>{\n\t\t\treturn Object.assign(s, {\n\t\t\t\tposition:{\n\t\t\t\t\tfrom:histogramData.valueToPosition(s.from),\n\t\t\t\t\tto:histogramData.valueToPosition(s.to)\n\t\t\t\t}\n\t\t\t});\n\t\t});\n    }\n\n\t/**\n\t * @public\n\t * @implements HistogramSelection.getSelection()\n\t * Returns histogram selection\n\t */\n\tgetSelection(){\n\t\treturn this._selection;\n\t}\n\n\t/**\n\t * @public\n\t * @abstract\n\t * @returns {Array} histogram selection\n\t * Returns histogram selection \n\t */\n\tgetOutputSelection(){\n\t\tthrow \"HistogramSelection.getOutputSelection() has to be implemented\";\n\t}\n\n\t/**\n\t * @public \n\t * @abstract\n\t * @returns {String}\n\t * Returns histogram selection type\n\t */\n\tgetSelectionType(){\n\t\tthrow \"HistogramSelection.getSelectionType() has to be implemented\";\n\t}\n\n\t/**\n\t * @abstract\n\t * @public \n\t * @returns {Boolean}\n\t * Returns true if toogle is allowed\n\t */\n\tallowsToggle(){\n\t\tthrow \"HistogramSelection.allowsToogle() has to be implemented\";\n\t}\t\n\n\t/**\n\t * @public\n\t * @abstract \n\t * @returns {Array}\n\t * Returns histogram selection points\n\t */\n\tgetSelectionPoints(){\n\t\tthrow \"HistogramSelection.getSelection() has to be implemented\";\n\t}  \t\n}\n\nvar SelectionTypes = {\n\tMULTI:\"multi\",\n\tFILTER:\"filter\",\n\tINVERTED_FILTER:\"inverted-filter\"\n}\n\nexport {SelectionTypes} ","import HistogramSelection from \"./HistogramSelection\";\nimport {SelectionTypes} from \"./HistogramSelection\";\n\n/**\n * @class\n * MultipleHistogramSelection representing histogram selection that support multiple selections\n */\nexport default class MultipleHistogramSelection extends HistogramSelection{\n\t/**\n\t * @param {HistogramData} histogramData\n\t * @param {Array} selection\n\t */\n    constructor(histogramData, selection) {\n\t\tsuper(histogramData, selection);\n    }\n\n\t/**\n\t * @public\n\t * @implements HistogramSelection.getSelectionType()\n\t * Returns histogram selection\n\t */\n\tgetSelectionType(){\n\t\treturn SelectionTypes.MULTI;\n\t}\n\n\t/**\n\t * @public\n\t * @returns {Array} histogram selection\n\t * @implements HistogramSelection.getOutputSelection()\n\t * Returns histogram selection \n\t */\n\tgetOutputSelection(){\n\t\treturn this._selection;\n\t}\t\n\n\t/**\n\t * @public\n\t * @implements HistogramSelection.allowsToggle()\n\t * Returns true if selection allows toggle\n\t */\n\tallowsToggle(){\n\t\treturn true;\n\t}\n\n\t/**\n\t * @public \n\t * @implements HistogramSelection.getSelectionPoints()\n\t * Returns histogram selection points\n\t */\n\tgetSelectionPoints(){\n\t\tvar result = [];\n\t\tvar selection = this.getSelection();\n\t\tselection.forEach((s, index)=>{\n\t\t\tresult.push({\n\t\t\t\tvalue:s.from\n\t\t\t});\n\t\t\t\n\t\t\tif (index == selection.length-1){\n\t\t\t\tresult.push({\n\t\t\t\t\tvalue:s.to\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}  \t \t\n}","import MultipleHistogramSelectionImpl from \"./MultipleHistogramSelectionImpl\";\nimport * as Defaults from \"../HistogramDefaults\";\n\n/**\n * @class\n * DefaultHistogramSelectionImpl representing histogram selection\n */\nexport default class DefaultHistogramSelectionImpl extends MultipleHistogramSelectionImpl {\n\t/**\n\t * @param {HistogramData} histogramData\n\t * @param {Array} selection\n\t */\n    constructor(histogramData) {\n\t\tvar minMax = histogramData.getMinMax();\n\t\tvar colors = Defaults.DEFAULT_COLORS;\n\t\tvar start = minMax.min;\n\t\tvar step = (minMax.max - minMax.min) / colors.length;\n\t\tvar selection = colors.map(color=>{\n\t\t\tvar from = start;\n\t\t\tvar to = start + step;\n\t\t\tstart += step;\n\n\t\t\treturn {\n\t\t\t\tfrom:from, \n\t\t\t\tto:to,\n\t\t\t\tcolor:color\n\t\t\t}\n\t\t});\n\n\t\tsuper(histogramData, selection);\n    }\n}","import HistogramSelection from \"./HistogramSelection\";\nimport {SelectionTypes} from \"./HistogramSelection\";\n\n/**\n * @class\n * MultipleHistogramSelection representing histogram selection that support multiple selections\n */\nexport default class FilterHistogramSelectionImpl extends HistogramSelection{\n\t/**\n\t * @param {HistogramData} histogramData\n\t * @param {Array} selection\n\t */\n    constructor(histogramData, selection) {\n\t\tif (selection.length != 1){\n\t\t\tthrow \"Filter selection doesn't allow more than one selection\"\n\t\t}\n\t\tsuper(histogramData, selection);\n\t}\n\t/**\n\t * @public\n\t * @returns {Array} histogram selection\n\t * @implements HistogramSelection.getOutputSelection()\n\t * Returns histogram selection \n\t */\n\tgetOutputSelection(){\n\t\treturn this._selection;\n\t}\t\t\n\n\t/**\n\t * @public\n\t * @implements HistogramSelection.getSelectionType()\n\t * Returns histogram selection\n\t */\n\tgetSelectionType(){\n\t\treturn SelectionTypes.FILTER;\n\t}\t\n\n\t/**\n\t * @public\n\t * @implements HistogramSelection.allowsToggle()\n\t * Returns true if selection allows toggle\n\t */\n\tallowsToggle(){\n\t\treturn false;\n\t}\t\n\n\t/**\n\t * @public \n\t * @implements HistogramSelection.getSelectionPoints()\n\t * Returns histogram selection points\n\t */\n\tgetSelectionPoints(){\n\t\tvar result = [];\n\t\tvar selection = this.getSelection();\n\t\tselection.forEach((s, index)=>{\n\t\t\tresult.push({\n\t\t\t\tvalue:s.from\n\t\t\t});\n\n\t\t\tif (index == selection.length-1){\n\t\t\t\tresult.push({\n\t\t\t\t\tvalue:s.to\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn result;\n\t}  \t\n}","import FilterHistogramSelectionImpl from \"./FilterHistogramSelectionImpl\";\nimport {SelectionTypes} from \"./HistogramSelection\";\n\n/**\n * @class\n * MultipleHistogramSelection representing histogram selection that support multiple selections\n */\nexport default class InvertedFilterHistogramSelectionImpl extends FilterHistogramSelectionImpl {\n\t/**\n\t * @param {HistogramData} histogramData\n\t * @param {Array} selection\n\t */\n    constructor(histogramData, selection) {\n\t\tsuper(histogramData, selection);\n\n\t\tthis._selection = this._getInvertedSelection(histogramData, selection);\n    }\n\n\n\t_getInvertedSelection(histogramData, selection){\n\t\tvar minMax = histogramData.getMinMax();\n\n\t\treturn [\n\t\t\t{\n\t\t\t\tfrom:minMax.min,\n\t\t\t\tto:selection[0].from\n\t\t\t},\n\t\t\t{\n\t\t\t\tfrom:selection[0].from,\n\t\t\t\tdisabled:true,\n\t\t\t\tto:selection[0].to\n\t\t\t},\n\t\t\t{\n\t\t\t\tfrom:selection[0].to,\n\t\t\t\tto:minMax.max\n\t\t\t}\n\t\t];\n\t}\n\n\t/**\n\t * @public\n\t * @returns {Array} histogram selection\n\t * @implements HistogramSelection.getOutputSelection()\n\t * Returns histogram selection \n\t */\n\tgetOutputSelection(){\n\t\treturn [\n\t\t\t{\n\t\t\t\tfrom:this._selection[1].from,\n\t\t\t\tto:this._selection[1].to\n\t\t\t}\n\t\t];\n\t}\t\n\n\t/**\n\t * @public\n\t * @implements HistogramSelection.getSelectionType()\n\t * Returns histogram selection\n\t */\n\tgetSelectionType(){\n\t\treturn SelectionTypes.INVERTED_FILTER;\n\t}\n\n\t/**\n\t * @public \n\t * @implements HistogramSelection.getSelectionPoints()\n\t * Returns histogram selection points\n\t */\n\tgetSelectionPoints(){\n\t\tvar result = super.getSelectionPoints();\n\t\t\n\t\tresult[0].hidden = true;\n\t\tresult[result.length-1].hidden = true;\n\n\t\treturn result;\n\t}  \t\n}","import DefaultHistogramSelectionImpl from \"./DefaultHistogramSelectionImpl\";\nimport MultipleHistogramSelectionImpl from \"./MultipleHistogramSelectionImpl\";\nimport FilterHistogramSelectionImpl from \"./FilterHistogramSelectionImpl\";\nimport InvertedFilterHistogramSelectionImpl from \"./InvertedFilterHistogramSelectionImpl\";\nimport {SelectionTypes} from \"./HistogramSelection\";\n\n/**\n * @class\n * HistogramSelection factory returns appropriate selection implementation\n */\nexport default class HistogramSelectionFactory {\n\t/**\n\t * @param {Object} options\n\t */\n\tconstructor(options) {\n\t\tthis._options = options;\n\t}\n\n\t/**\n\t * @public\n\t * @param {HistogramData} histogramData\n\t * @returns {HistogramSelection} returns histogram selection\n\t * Returns histogram selection\n\t */\n\tgetHistogramSelection(selection, histogramData){\t\t\n\t\t// use default histogram selection if selection is not provided\n\t\tif (!selection){\n\t\t\treturn new DefaultHistogramSelectionImpl(histogramData, this._options.selection);\n\t\t} else if (this._options.selectionType == SelectionTypes.FILTER){\n\t\t\treturn new FilterHistogramSelectionImpl(histogramData, selection);\n\t\t} else if (this._options.selectionType == SelectionTypes.INVERTED_FILTER){\n\t\t\treturn new InvertedFilterHistogramSelectionImpl(histogramData, selection);\n\t\t} else {\n\t\t\treturn new MultipleHistogramSelectionImpl(histogramData, selection);\n\t\t}\n\t}  \t\n}","/**\r\n * @public\r\n * Default widget width\r\n */\r\nexport const WIDTH = 360;\r\n\r\n/**\r\n * @public\r\n * Default widget height\r\n */\r\nexport const HEIGHT = 200;\r\n\r\n/**\r\n * @public\r\n * Default line color\r\n */\r\nexport const LINE_COLOR = \"#7ed321\";\r\n\r\n/**\r\n * @public\r\n * Default line colors\r\n */\r\nexport const LINE_COLORS = [];\r\n\r\n/**\r\n * @public\r\n * Default line opacity\r\n */\r\nexport const LINE_OPACITY = 1;\r\n\r\n/**\r\n * @public\r\n * Default fill color\r\n */\r\nexport const FILL_COLOR = \"#7ed321\";\r\n\r\n/**\r\n * @public\r\n * Default fill colors\r\n */\r\nexport const FILL_COLORS = [];\r\n\r\n/**\r\n * @public\r\n * Default fill opacity\r\n */\r\nexport const FILL_OPACITY = 0.1;\r\n\r\n/**\r\n * @public\r\n * Default line width\r\n */\r\nexport const LINE_WIDTH = 3;\r\n\r\n/**\r\n * @public\r\n * Default dot size\r\n */\r\nexport const DOT_SIZE = 6;\r\n\r\n/**\r\n * @public\r\n * Default margin \r\n */\r\nexport const MARGIN = {\r\n    bottom:28\r\n};\r\n\r\n/**\r\n * @public \r\n * Default axis color \r\n */\r\nexport const AXIS_COLOR = \"#f0f0f0\";\r\n\r\n\r\n/**\r\n * @public \r\n * Vertical label offset\r\n */\r\nexport const LABEL_OFFSET = 5;\r\n\r\n\r\n/**\r\n * @public \r\n * Zero line color\r\n */\r\nexport const ZERO_LINE_COLOR = \"#bababa\";","import * as d3 from \"d3\";\r\n\r\n/**\r\n * @class\r\n * series representing data for the line\r\n */\r\nexport default class LineData {\r\n\t/**\r\n\t * @param {Array} series\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(series) {\r\n\t\tthis._series = series.slice();\r\n\t\tthis._minMax = this._calculateMinMax(this._series);\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns min max of history data\r\n\t * @returns {Object} minMax\r\n\t * @returns {Number} minMax.min\r\n\t * @returns {Number} minMax.max\r\n\t */\r\n\tgetMinMax() {\r\n\t\treturn this._minMax;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns line series\r\n\t * @returns {Array} line series\r\n\t */\r\n\tgetSeries() {\r\n\t\treturn this._series;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns all data from all series merged into one array\r\n\t * @returns {Array}\r\n\t */\r\n\tgetAllData() {\r\n\t\treturn [].concat.apply([], this._series);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns merged data where each unique label has an array of values\r\n\t */\r\n\tgetMergedData() {\r\n\t\tvar dataMap = {};\r\n\t\tthis.getAllData().forEach((item=>{\r\n\t\t\tconst result = dataMap[item.label] || {\r\n\t\t\t\tlabel:item.label,\r\n\t\t\t\tvalues:[],\r\n\t\t\t\ttooltips:[]\r\n\t\t\t};\r\n\t\t\tresult.values.push(item.value);\r\n\t\t\tresult.tooltips.push(item.tooltip);\r\n\t\t\tdataMap[item.label] = result;\r\n\t\t}));\r\n\r\n\t\treturn Object.values(dataMap);\r\n\t}\r\n\r\n\t/**\r\n\t* @private\r\n\t* Returns min max values for given series\r\n\t* @param {Array} series\r\n\t* @returns {Object} minMax.min\r\n\t* @returns {Object} minMax.max\r\n\t*/\r\n\t_calculateMinMax(series) {\r\n\t\tvar data = [].concat.apply([], series);\r\n\t\tvar min = d3.min(data, function (d) { return d.value; });\r\n\t\tvar max = d3.max(data, function (d) { return d.value; });\r\n\r\n\t\tif (data.length <= series.length) {\r\n\t\t\tmin = Math.min(min, 0);\r\n\t\t\tmax = Math.max(max, 0);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tmin: min,\r\n\t\t\tmax: max\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns precision (number of floating digits) for given number\r\n\t */\r\n\tgetPrecision() {\r\n\t\tvar num = this._minMax.max;\r\n\t\tvar numParts = num.toString().split(\".\");\r\n\t\tif (numParts.length > 1) {\r\n\t\t\treturn numParts[1].length;\r\n\t\t} else {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t}\r\n}","import style from \"./Line.css\";\r\nimport * as Defaults from \"./LineDefaults\";\r\nimport Observable from \"../utils/Observable\";\r\nimport * as d3 from \"d3\";\r\n\r\nvar gradientID = 0;\r\n\r\n/**\r\n * @class\r\n * Line renderer class\r\n * @param {Object} options\r\n */\r\nexport default class TooltipRenderer {\r\n    constructor(options) {\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Line options\r\n\t\t */\r\n\t\tthis._options = options;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Main group element of this widget\r\n\t\t */\r\n\t\tthis._groupEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * Line data \r\n\t\t */\r\n\t\tthis._lineData = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * X axis\r\n\t\t */\r\n\t\tthis._xAxis = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * Y axis\r\n\t\t */\r\n\t\tthis._yAxis = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * true if Line has been rendered\r\n\t\t */\r\n\t\tthis._rendered = false;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * observable handler\r\n\t\t */\r\n\t\tthis._observable = new Observable([\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when mouse is over a line point\r\n\t\t\t * @param {Array} [x,y] data\r\n\t\t\t */\r\n\t\t\t\"pointOver\"\r\n\t\t]);\r\n    }\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns whether Line has been rendered or not\r\n\t * @returns {boolean} true if Line has been rendered\r\n\t */\r\n\tisRendered(){\r\n\t\treturn this._rendered;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Bind handle event\r\n\t * @param {String} event event name\r\n\t * @param {Function} handler event handler\r\n\t * @returns {LineHandle} returns this handle instance\r\n\t */\r\n\ton(eventName, handler) {\r\n\t\tthis._observable.on(eventName, handler);\r\n\t\treturn this;\r\n\t}\t\r\n\r\n\t/**\r\n\t * @public\r\n\t * Render logic of this widget\r\n\t * @param {String|DOMElement} selector selector or DOM element \r\n\t * @returns {Line} returns this widget instance\r\n\t */\r\n\trender(groupEl){\r\n\t\tthis._groupEl = groupEl;\r\n\t\tthis._rendered = true;\r\n\r\n\t\tthis._groupEl.on(\"mouseout\", this._onMouseOut.bind(this))\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t_getTextAnchor(xPos, bottomLabelWidth, width){\r\n\t\tvar xpos = xPos;\r\n\t\tif (xpos - bottomLabelWidth/2 < 0){\r\n\t\t\treturn \"start\"\r\n\t\t} else if (xpos + bottomLabelWidth/2 > width){\r\n\t\t\treturn \"end\"\r\n\t\t} else {\r\n\t\t\treturn \"middle\";\r\n\t\t}\r\n\t}\r\n\r\n\t_getTooltipHTML(d){\r\n\t\treturn d.tooltips.filter((tooltip, index)=>{\r\n\t\t\treturn d.values[index] != null;\r\n\t\t}).map((tooltip, index)=>{\r\n\t\t\tconst value = tooltip || this._options.format(d.values[index]);\r\n\t\t\tvar color = this._options.lineColors[index] || this._options.lineColor;\r\n\t\t\tconst icon = `\r\n\t\t\t\t<span style=\"display:inline-block;position:relative;top:-1px;margin-right:5px;width:6px;height:6px;border-radius:50%;background-color:${color}\"></span>\r\n\t\t\t`;\r\n\t\t\treturn icon + value;\r\n\t\t}).join(\"<br />\");\r\n\t}\r\n\r\n\t_onHoverAreaOver(d){\r\n\t\tvar duration = this._tooltipGroup.attr(\"visibility\") == \"visible\"?0:0;\r\n\t\tvar x = this._xAxis;\r\n\t\tvar y = this._yAxis;\r\n\t\tvar width = this._options.width;\r\n\t\tvar xPos = x(d.label);\r\n\r\n\t\t// update tooltip position\r\n\t\tthis._tooltipGroup\r\n\t\t\t.transition()\r\n\t\t\t.duration(duration)\r\n\t\t\t.attr(\"visibility\", \"visible\")\r\n\t\t\t.attr(\"transform\", \"translate(\"+xPos+\", 0)\")\r\n\r\n\t\t// update tooltip bottom label\r\n\t\tvar bottomLabelWidth = this._tooltipBottomLabel.node().getBBox().width;\r\n\t\tvar bottomMaskPadding = 25;\r\n\t\tvar textAnchor = this._getTextAnchor(xPos, bottomLabelWidth, width);\r\n\r\n\t\tthis._tooltipBottomLabel\r\n\t\t\t.text(d.label)\r\n\t\t\t.attr(\"text-anchor\", textAnchor);\r\n\r\n\t\tthis._tooltipBottomLabel.attr(\"transform\", ()=>{\r\n\t\t\treturn {\r\n\t\t\t\t\"start\":\"translate(\"+-xPos+\", 0)\",\r\n\t\t\t\t\"middle\":\"translate(0, 0)\",\r\n\t\t\t\t\"end\":\"translate(\"+(width-xPos)+\", 0)\"\r\n\t\t\t}[textAnchor]\r\n\t\t});\r\n\t\t\r\n\t\tvar bottomMaskWidth = bottomMaskPadding*2 + bottomLabelWidth;\r\n\t\tthis._tooltipBottomLabelMask\r\n\t\t\t.attr(\"width\", bottomMaskWidth)\r\n\t\t\t.attr(\"x\", ()=>{\r\n\t\t\t\treturn {\r\n\t\t\t\t\t\"start\":-xPos-bottomMaskPadding,\r\n\t\t\t\t\t\"middle\":-bottomMaskWidth/2,\r\n\t\t\t\t\t\"end\":width-xPos-bottomMaskWidth+bottomMaskPadding,\r\n\t\t\t\t}[textAnchor]\r\n\t\t\t})\r\n\r\n\t\tthis._handleMaskGradientEl.attr(\"x1\", -bottomMaskWidth/2);\r\n\t\tthis._handleMaskGradientEl.attr(\"x2\", bottomMaskWidth/2);\t\t\t\r\n\r\n\t\t// update tooltip top label \r\n\t\tvar tooltipHtml = this._getTooltipHTML(d);\r\n\t\tthis._tooltipTopLabel.node().innerHTML = tooltipHtml;\r\n\t\tvar labelLeft = this._getLabelLeft(xPos);\r\n\r\n\t\t// if value is not null or undefined\r\n\t\tif (d.values.some(d => d != null)){\r\n\t\t\tthis._tooltipTopLabel\r\n\t\t\t\t.style(\"left\", labelLeft+\"px\")\r\n\t\t\t\t.style(\"visibility\", \"visible\")\r\n\t\t\t\t.style(\"top\", y(Math.max.apply(Math,d.values))-50+\"px\")\r\n\r\n\t\t\t// update line circle\r\n\t\t\tthis._tooltipLineCircle\r\n\t\t\t\t.transition()\r\n\t\t\t\t.duration(duration)\r\n\t\t\t\t.style(\"visibility\", (circle, i)=>{\r\n\t\t\t\t\treturn d.values[i]?\"visible\":\"hidden\";\r\n\t\t\t\t})\r\n\t\t\t\t.attr(\"cy\", (circle, i)=>{\r\n\t\t\t\t\treturn d.values[i]?y(d.values[i]):0\r\n\t\t\t\t})\t\t\t\t\r\n\t\t} else {\r\n\t\t\tthis._tooltipTopLabel.style(\"visibility\", \"hidden\");\r\n\t\t\tthis._tooltipLineCircle.style(\"visibility\", \"hidden\");\r\n\t\t}\r\n\t\r\n\t}\r\n\r\n\t_getLabelLeft(xPos){\r\n\t\tvar labelWidth = this._tooltipTopLabel.node().offsetWidth;\r\n\t\tvar labelLeft = xPos-labelWidth/2;\r\n\t\t\r\n\t\tif (labelLeft<0){\r\n\t\t\tlabelLeft = 0;\r\n\t\t}\r\n\r\n\t\tif (labelLeft>this._options.width - labelWidth){\r\n\t\t\tlabelLeft = this._options.width - labelWidth;\r\n\t\t}\r\n\r\n\t\treturn labelLeft;\r\n\t}\r\n\r\n\t_onMouseOut(){\r\n\t\t// only hide when mouse is outside of widget\r\n\t\tif (!this._groupEl.node().parentNode.contains(d3.event.relatedTarget)){\r\n\t\t\tthis._hideTooltip();\r\n\t\t\tthis._tooltipLineCircle.style(\"visibility\", \"hidden\");\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\t_hideTooltip(){\r\n\t\tthis._tooltipGroup.attr(\"visibility\", \"hidden\")\r\n\t\tthis._tooltipTopLabel.style(\"visibility\", \"hidden\")\r\n\t}\r\n\r\n\t_renderTooltip(){\r\n\t\tvar data = this._lineData.getMergedData();\r\n\t\t\r\n\t\tvar series = this._lineData.getSeries();\r\n\t\tvar hoverWidth;\r\n\t\tif (data.length>series.length){\r\n\t\t\thoverWidth = this._options.width / (data.length-1);\r\n\t\t} else {\r\n\t\t\thoverWidth = this._options.width;\r\n\t\t}\r\n\r\n\t\tthis._hoverAreas = this._groupEl\r\n\t\t\t.selectAll(\".\"+style[\"tooltip-hover-area\"])\r\n\t\t\t.data(data)\r\n\t\t\t.enter()\r\n\t\t\t.append(\"rect\")\r\n\t\t\t.attr(\"class\", style[\"tooltip-hover-area\"])\r\n\t\t\t.attr(\"width\", hoverWidth)\r\n\t\t\t.attr(\"fill-opacity\", 0.00)\r\n\t\t\t.attr(\"x\", (d)=>{\r\n\t\t\t\treturn this._xAxis(d.label) - hoverWidth/2\r\n\t\t\t})\r\n\t\t\t.attr(\"height\", this._options.height)\r\n\t\t\t.on(\"mouseover\", this._onHoverAreaOver.bind(this))\r\n\r\n\t\tthis._tooltipGroup = this._groupEl\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"visibility\", \"hidden\")\r\n\t\t\t.attr(\"class\", style[\"tooltip-group\"])\r\n\r\n\r\n\t\tthis._tooltipLineCircle = this._tooltipGroup\r\n\t\t\t.selectAll(\".\"+style[\"tooltip-line-circle\"])\r\n\t\t\t.data(series)\r\n\t\t\t.enter()\r\n\t\t\t.append(\"circle\")\r\n\t\t\t.attr(\"visibility\", \"hidden\")\r\n\t\t\t.attr(\"class\", style[\"tooltip-line-circle\"])\r\n\t\t\t.attr(\"stroke-width\", this._options.lineWidth)\r\n\t\t\t.attr(\"stroke\", (d, i)=>{\r\n\t\t\t\treturn this._options.lineColors[i] || this._options.lineColor;\r\n\t\t\t})\r\n\t\t\t.attr(\"stroke-opacity\", this._options.lineOpacity)\r\n\t\t\t.attr(\"r\", 2.5+this._options.lineWidth/2)\r\n\r\n\t\tthis._tooltipAxisCircle = this._tooltipGroup\r\n\t\t\t.append(\"circle\")\r\n\t\t\t.attr(\"class\", style[\"tooltip-axis-circle\"])\r\n\t\t\t.attr(\"stroke-width\", 1)\r\n\t\t\t.attr(\"cy\", this._options.height - Defaults.MARGIN.bottom)\r\n\t\t\t.attr(\"r\", 2.5 + 1/2)\r\n\r\n\t\tthis._tooltipBottomLabelMask = this._tooltipGroup\r\n\t\t\t.append(\"rect\")\r\n\t\t\t.attr(\"fill\", \"url(#\"+this._handleMaskGradientEl.attr(\"id\")+\")\")\r\n\t\t\t.attr(\"class\", style[\"tooltip-label-mask\"])\r\n\t\t\t.attr(\"y\", this._options.height - Defaults.LABEL_OFFSET-15)\r\n\t\t\t.attr(\"height\", 20)\r\n\r\n\t\tthis._tooltipBottomLabel = this._tooltipGroup\r\n\t\t\t.append(\"text\")\r\n\t\t\t.attr(\"class\", style[\"tooltip-label\"])\r\n\t\t\t.attr(\"y\", this._options.height - Defaults.LABEL_OFFSET)\r\n\t\t\t.attr(\"text-anchor\", \"start\")\r\n\t\t\t.text(data[0].label)\r\n\r\n\t\tthis._tooltipTopLabel = d3.select(this._groupEl.node().parentNode.parentNode)\r\n\t\t\t.insert(\"span\", \":first-child\")\r\n\t\t\t.attr(\"class\", style[\"tooltip-top-label\"])\r\n\t\t\t.style(\"position\", \"absolute\")\r\n\t\t\t.style(\"visibility\", \"hidden\")\r\n\r\n\t\tthis._tooltipRendered = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates mask gradient element\r\n\t * @param {Number} handleIndex \r\n\t */\r\n\t_createMaskGradientElement(){\r\n\t\tthis._handleMaskGradientEl = this._groupEl.append(\"linearGradient\")\r\n\t\t\t.attr(\"id\", style[\"tooltip-label-mask\"]+\"-\"+(gradientID++)+\"-gradient\")\r\n\t\t\t.attr(\"gradientUnits\", \"userSpaceOnUse\")\r\n\t\t\t.attr(\"y1\", \"0\").attr(\"x1\", \"0\")\r\n\t\t\t.attr(\"y2\", \"0\").attr(\"x2\", \"0\");\r\n\r\n\t\tthis._handleMaskGradientEl.selectAll(\"stop\")\r\n\t\t\t.data([\r\n\t\t\t\t{ offset: \"0%\", color: \"rgba(255,255,255,0)\" },\r\n\t\t\t\t{ offset: \"20%\", color: \"rgba(255,255,255,1)\" },\r\n\t\t\t\t{ offset: \"80%\", color: \"rgba(255,255,255,1)\" },\r\n\t\t\t\t{ offset: \"100%\", color: \"rgba(255,255,255,0)\" }\r\n\t\t\t])\r\n\t\t\t.enter().append(\"stop\")\r\n\t\t\t.attr(\"offset\", function (d) { return d.offset; })\r\n\t\t\t.attr(\"stop-color\", function (d) { return d.color; });\r\n\r\n\t\treturn this._handleMaskGradientEl;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Clears selection controls and data \r\n\t */\r\n\t_clear(){\r\n\t\tif (this._tooltipRendered){\r\n\t\t\tthis._hoverAreas.remove();\r\n\t\t\tthis._tooltipGroup.remove();\r\n\t\t\tthis._tooltipTopLabel.remove();\r\n\t\t\tthis._tooltipRendered = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Sets line data \r\n\t * @param {LineData}\r\n\t */\r\n\tupdate(lineData, x, y){\r\n\t\tthis._xAxis = x;\r\n\t\tthis._yAxis = y; \r\n\t\tthis._lineData = lineData;\r\n\r\n\t\tthis._createMaskGradientElement();\r\n\t\tthis._clear();\r\n\t\tthis._renderTooltip();\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Destorys Line UI  \r\n\t */\r\n\tdestroy() {\r\n\t\tif (this._rendered){\r\n\t\t\tthis._clear();\r\n\t\t}\r\n\r\n\t\tthis._observable.destroy();\r\n\r\n\t\treturn this;\r\n    }\t\r\n\t\r\n}","import style from \"./Line.css\";\r\nimport * as Defaults from \"./LineDefaults\";\r\nimport Observable from \"../utils/Observable\";\r\nimport TooltipRenderer from \"./TooltipRenderer\";\r\nimport * as d3 from \"d3\";\r\n\r\n/**\r\n * @class\r\n * Line renderer class\r\n * @param {Object} options\r\n */\r\nexport default class LineRenderer {\r\n    constructor(options) {\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Line options\r\n\t\t */\r\n\t\tthis._options = options;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * DOM container of this widget\r\n\t\t */\r\n\t\tthis._containerEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Main group element of this widget\r\n\t\t */\r\n\t\tthis._groupEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private \r\n\t\t * Main SVG element of this widget\r\n\t\t */\r\n\t\tthis._svgEl = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * Line data \r\n\t\t */\r\n\t\tthis._lineData = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * X axis\r\n\t\t */\r\n\t\tthis._xAxis = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * Y axis\r\n\t\t */\r\n\t\tthis._yAxis = null;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * true if Line has been rendered\r\n\t\t */\r\n\t\tthis._rendered = false;\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * stores previous data for animation\r\n\t\t */\r\n\t\tthis._prevData = null;\t\t\r\n\r\n\t\t/**\r\n\t\t * @private\r\n\t\t * observable handler\r\n\t\t */\r\n\t\tthis._observable = new Observable([\r\n\t\t\t/**\r\n\t\t\t * @event \r\n\t\t\t * Fires when mouse is over a line point\r\n\t\t\t * @param {Array} [x,y] data\r\n\t\t\t */\r\n\t\t\t\"pointOver\"\r\n\t\t]);\r\n\r\n\t\tthis._tooltipRenderer = new TooltipRenderer(options);\r\n    }\r\n\r\n\t/**\r\n\t * @public\r\n\t * Returns whether Line has been rendered or not\r\n\t * @returns {boolean} true if Line has been rendered\r\n\t */\r\n\tisRendered(){\r\n\t\treturn this._rendered;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Bind handle event\r\n\t * @param {String} event event name\r\n\t * @param {Function} handler event handler\r\n\t * @returns {LineHandle} returns this handle instance\r\n\t */\r\n\ton(eventName, handler) {\r\n\t\tthis._observable.on(eventName, handler);\r\n\t\treturn this;\r\n\t}\t\r\n\r\n\t/**\r\n\t * @public\r\n\t * Render logic of this widget\r\n\t * @param {String|DOMElement} selector selector or DOM element \r\n\t * @returns {Line} returns this widget instance\r\n\t */\r\n\trender(selector){\r\n\t\t// get container element using selector or given element\r\n\t\tvar ct = this._containerEl = d3.select(selector);\r\n\t\tvar width = this._options.width;\r\n\t\tvar height = this._options.height;\r\n\r\n\t\t// force position relative so the toolip shows correctly\r\n\t\tct.style(\"position\", \"relative\");\r\n\r\n\t\t// render SVG\r\n\t\tthis._svgEl = ct.append(\"svg\")\r\n\t\t\t.attr(\"width\", width)\r\n\t\t\t.attr(\"height\", height)\r\n\t\t\t.classed(style.svg, true)\r\n\t\t\t.classed(style.line, true);\r\n\r\n\t\t// render group element\r\n\t\tthis._groupEl = this._svgEl.append(\"g\");\r\n\r\n\t\tthis._tooltipRenderer.render(this._groupEl);\r\n\r\n\t\tthis._rendered = true;\r\n\r\n\t\treturn this;\r\n\t} \r\n\r\n\t/**\r\n\t * @private\r\n\t * Clears selection controls and data \r\n\t */\r\n\t_clear(){\r\n\t\tthis._groupEl.node().innerHTML = \"\";\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Sets line data \r\n\t * @param {LineData}\r\n\t */\r\n\tupdate(lineData){\r\n\t\tthis._lineData = lineData;\t\t\r\n\t\tthis._clear();\r\n\r\n\t\tvar width = this._options.width;\r\n\t\tvar height = this._options.height;\r\n\t\tvar verticalSpacing = this._options.verticalSpacing;\r\n\r\n\t\tvar series = lineData.getSeries();\r\n\t\tvar allData = lineData.getAllData()\r\n\t\tvar minMax = lineData.getMinMax();\r\n\r\n\t\tvar x = this._xAxis = d3.scalePoint().range([0, width]);\t\r\n\t\tvar y = this._yAxis = d3.scaleLinear().range([height-verticalSpacing, verticalSpacing]);\r\n\r\n\t\tx.domain(allData.map(function (d) {return d.label; }));\r\n\t\ty.domain([minMax.min, minMax.max]);\r\n\r\n\t\tthis._renderZeroLine(allData);\r\n\t\tseries.forEach((data, seriesIndex)=>{\r\n\t\t\tthis._renderDataLines(data, seriesIndex);\r\n\t\t});\r\n\t\tthis._renderXAxis(allData);\r\n\t\tthis._tooltipRenderer.update(lineData, x, y);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {Array} data\r\n\t * Renders x axis\r\n\t*/\r\n\t_renderXAxis(data){\r\n\t\tthis._groupEl.append(\"line\")\r\n\t\t\t.attr(\"x1\", 0)\r\n\t\t\t.attr(\"x2\", this._options.width)\r\n\t\t\t.attr(\"y1\", this._options.height-Defaults.MARGIN.bottom)\r\n\t\t\t.attr(\"y2\", this._options.height-Defaults.MARGIN.bottom)\r\n\t\t\t.attr(\"stroke-width\", 1)\r\n\t\t\t.attr(\"stroke\", this._options.axisColor)\r\n\r\n\t\t// render to labels on start and end sides if multiple items are available\r\n\t\tif (data.length>1){\r\n\t\t\tthis._groupEl\r\n\t\t\t\t.append(\"text\")\r\n\t\t\t\t.text(data[0].label)\r\n\t\t\t\t.attr(\"x\", 0)\r\n\t\t\t\t.attr(\"y\", this._options.height-Defaults.LABEL_OFFSET)\r\n\r\n\t\t\tthis._groupEl\r\n\t\t\t\t.append(\"text\")\r\n\t\t\t\t.text(data[data.length-1].label)\r\n\t\t\t\t.attr(\"x\", this._options.width)\r\n\t\t\t\t.attr(\"text-anchor\", \"end\")\r\n\t\t\t\t.attr(\"y\", this._options.height-Defaults.LABEL_OFFSET)\t\r\n\r\n\t\t// render single label in the middle if only one item is available\t\t\t\t\r\n\t\t} else if (data.length == 1){\r\n\t\t\tthis._groupEl\r\n\t\t\t\t.append(\"text\")\r\n\t\t\t\t.text(data[0].label)\r\n\t\t\t\t.attr(\"x\", this._options.width/2)\r\n\t\t\t\t.attr(\"text-anchor\", \"middle\")\r\n\t\t\t\t.attr(\"y\", this._options.height-Defaults.LABEL_OFFSET)\t\r\n\t\t}\t\r\n\t}\r\n\t/**\r\n\t * Returns true if graph should render zero line\r\n\t * @param {Array} data \r\n\t */\r\n\t_showZeroLine(){\r\n\t\tvar zeroLinePosition = this._yAxis(0);\r\n\t\tvar axisPosition = this._options.height-Defaults.MARGIN.bottom;\r\n\t\tvar treshold = 10;\r\n\t\treturn zeroLinePosition<axisPosition-treshold;\r\n\t}\r\n\t/**\r\n\t * @private\r\n\t * @param {Array} data\r\n\t * Renders zero line\r\n\t*/\r\n\t_renderZeroLine(){\r\n\t\tif (this._showZeroLine()){\r\n\t\t\tthis._groupEl.append(\"line\")\r\n\t\t\t\t.attr(\"x1\", 0)\r\n\t\t\t\t.attr(\"x2\", this._options.width)\r\n\t\t\t\t.attr(\"y1\", Math.round(this._yAxis(0)))\r\n\t\t\t\t.attr(\"y2\", Math.round(this._yAxis(0)))\r\n\t\t\t\t.attr(\"stroke-dasharray\",\"2 ,2\")\r\n\t\t\t\t.attr(\"stroke\", this._options.zeroLineColor)\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * @param {Array} data\r\n\t * @param {Number} seriesIndex\r\n\t * Renders data lines\r\n\t*/\r\n\t_renderDataLines(data, seriesIndex) { \r\n\t\tvar x = this._xAxis;\r\n\t\tvar y = this._yAxis;\r\n\t\t\r\n\t\tvar options = this._options;\r\n\t\tvar minHeight = this._options.height-Defaults.MARGIN.bottom;\r\n\t\tvar areaZero = this._showZeroLine()?Math.min(minHeight, y(0)):minHeight;\r\n\t\tvar lineColor = options.lineColors[seriesIndex] || options.lineColor;\r\n\t\tvar fillColor = options.fillColors[seriesIndex] || options.fillColor;\r\n\r\n\t\t// define the area\r\n\t\tvar area = d3.area()\r\n\t\t\t.x(function(d) {return x(d.label); })\r\n\t\t\t.y0(areaZero)\r\n\t\t\t.y1(function(d) { return y(d.value); });\r\n\r\n\t\t// define the line\r\n\t\tvar line = d3.line()\r\n\t\t\t.x(function(d) { return x(d.label); })\r\n\t\t\t.y(function(d) { return y(d.value); });\t\t\r\n\r\n\t\t// apply grouping if needed (null or other splits)\r\n\t\tconst groupedData = this._getGroupedData(data);\r\n\r\n\t\tgroupedData.forEach(lineData=>{\r\n\t\t\t// only add area if not rendering a dot\r\n\t\t\tif (lineData.length>1){\r\n\t\t\t\t// add the area path\r\n\t\t\t\tthis._groupEl.append(\"path\")\r\n\t\t\t\t.data([lineData])\r\n\t\t\t\t.attr(\"class\", style[\"area\"])\r\n\t\t\t\t.attr(\"fill\", fillColor)\r\n\t\t\t\t.attr(\"fill-opacity\", options.fillOpacity)\r\n\t\t\t\t.attr(\"d\", area);\r\n\t\t\t}\r\n\r\n\t\t\tif (lineData.length){\r\n\t\t\t\t// add the line path\r\n\t\t\t\tthis._groupEl.append(\"path\")\r\n\t\t\t\t\t.data([lineData])\r\n\t\t\t\t\t.attr(\"fill\", \"none\")\r\n\t\t\t\t\t.attr(\"stroke-linecap\", \"round\")\r\n\t\t\t\t\t.attr(\"stroke\", lineColor)\r\n\t\t\t\t\t.attr(\"stroke-opacity\", 1)\r\n\t\t\t\t\t// note that in case of a single item, dot is rendered with a different size\r\n\t\t\t\t\t.attr(\"stroke-width\", lineData.length>1?options.lineWidth:options.dotSize)\r\n\t\t\t\t\t.attr(\"class\", style[\"line\"])\r\n\t\t\t\t\t.attr(\"d\", (d)=>{\r\n\t\t\t\t\t\tvar path = line(d);\r\n\t\t\t\t\t\t// Fix issue in Chrome on Mac and Surface where\r\n\t\t\t\t\t\t// path points are not rendererd if it's a single point \r\n\t\t\t\t\t\tif (path && path.split(\",\").length == 2){\r\n\t\t\t\t\t\t\treturn path + \" \" + path;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn path;\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @private\r\n\t * Splits given array into multiple in case there is null in value\r\n\t * @param {Array} data \r\n\t */\r\n\t_getGroupedData(data){\r\n\t\tlet group = [];\r\n\t\tconst result = [group];\r\n\t\t\r\n\t\tdata.forEach(item=>{\r\n\t\t\tif (item.value === null){\r\n\t\t\t\tgroup = [];\r\n\t\t\t\tresult.push(group);\r\n\t\t\t} else {\r\n\t\t\t\tgroup.push(item);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * @public\r\n\t * Destorys Line UI  \r\n\t */\r\n\tdestroy() {\r\n\t\tif (this._rendered){\r\n\t\t\tthis._containerEl.node().removeChild(this._svgEl.node());\r\n\t\t}\r\n\r\n\t\tthis._observable.destroy();\r\n\r\n\t\treturn this;\r\n    }\t\r\n\t\r\n}","import Bar from \"./bar/Bar\";\r\nimport Doughnut from \"./doughnut/Doughnut\";\r\nimport Histogram from \"./histogram/Histogram\";\r\nimport Line from \"./line/Line\";\r\n\r\nexport default {\r\n\tBar:Bar,\r\n    Doughnut:Doughnut,\r\n    Histogram:Histogram,\r\n    Line:Line\r\n}"],"names":["getOptionValue","optionValue","defaultOptionValue","getHandlePositionOffsets","handle1","handle2","maskPadding","width","label1Box","getLabelBox","label2Box","conflictDiff","x","posDiff1","posDiff2","xMax","Observable","events","_handlers","reduce","acc","cur","event","handler","this","push","handlers","index","indexOf","splice","args","i","length","apply","WIDTH","BAR_HEIGHT","INACTIVE_BAR_COLOR","OVER_BAR_COLOR","ACTIVE_BAR_COLOR","ACTIVE_BAR_COLORS","ENABLE_BAR_TOGGLE","ENABLE_BAR_HOVER","LABEL_FONT_SIZE","VALUE_FONT_SIZE","MINMAX","BarData","series","options","_options","_series","slice","_minMax","_calculateMinMax","concat","dataMap","getAllData","forEach","result","item","label","disabled","highlighted","values","value","tooltips","tooltip","colors","color","Object","data","minMax","sums","map","d3","d","Math","max","min","numParts","toString","split","BarRenderer","_containerEl","_groupEl","_svgEl","_barData","_xAxis","_yAxis","_rendered","_observable","_maskIndex","MASK_INDEX","eventName","on","selector","ct","height","append","attr","style","bar","_clipPath","labelFontSize","node","innerHTML","barData","_clear","getMergedData","getMinMax","barHeight","range","domain","reverse","_renderDataBars","y","observable","barGroup","_this","datum","floor","classed","enableBarHover","fire","enableBarToggle","text","tooltipX","valueIndex","tooltipEl","reversedIndex","format","valueFontSize","getComputedTextLength","activeBarColors","activeBarColor","barOffset","Defaults","removeChild","destroy","Bar","inactiveBarColor","overBarColor","_barRenderer","barIndex","off","render","isRendered","getPrecision","setData","OUTER_RADIUS","INNER_RADIUS","VALUE","ACTIVE_COLOR","INACTIVE_COLOR","BACKGROUND_COLOR","ANIMATION_DURATION","DoughnutRenderer","offsetWidth","offsetHeight","_value","angle","_angle","tau","innerRadius","_innerRadius","outerRadius","_outerRadius","arc","_arc","startAngle","g","_inactiveArc","endAngle","inactiveColor","_activeArc","activeColor","_backgroundArc","backgroundColor","_hoverEl","opts","activeArcTransition","transition","duration","animationDuration","attrTween","_arcTween","_this2","interpolateOuterRadius","interpolateInnerRadius","interpolateAngle","t","_this3","Doughnut","renderTo","_doughnutRenderer","update","HEIGHT","MARGIN","INACTIVE_BAR_OPACITY","OVER_SELECTION_COLOR","OVER_SELECTION_OPACITY","SELECTION_COLOR","ENABLE_SELECTION_TOGGLE","FONT_SIZE","DEFAULT_COLORS","HistogramData","_histogramData","_loadHistogramData","histogramData","position","getValueRatio","valueRatio","constrainedValue","round","numOfBarsPerBucket","bucket","step","volume","Array","isArray","HistogramHandle","groupEl","_handleEl","_handleLineEl","_handleCircleEl","_handleMaskEl","_handleMaskGradientEl","_handleLabelEl","_isOver","_index","_initialValue","Number","_position","valueToPosition","_initialPosition","_labelSizeCache","_elements","_renderHandle","element","remove","_createHandleElement","_createHandleLineElement","_createHandleCircleElement","_createDragMaskElement","_createMaskGradientElement","_createDragLabelElement","_handleHoverState","_handleDrag","parseInt","_updateLabelPosition","getBBox","offset","setLabelOffset","setHoverState","unsetHoverState","xpos","positionToValue","_getLabelText","call","_onDrag","bind","_onStartDrag","_onEndDrag","content","fontSize","textLength","_getComputedLabelTextLength","maskWidth","xPosition","gradientIndex","selectAll","enter","HistogramSelectionRenderer","_histogramSelection","_overSelectionIndex","_handles","_draggingHandle","_prevSelection","_animating","_destroyHandles","_selectionBars","handle","handleIndex","handleValue","promptHandler","then","promptResult","startSelectionSnapshot","JSON","stringify","getOutputSelection","parseFloat","points","getSelectionPoints","positions","sort","p1","p2","point","_updateSelectionPositions","_updateSelection","_renderHandles","selection","selectionIndex","enabled","target","allowsToggle","_toggleSelection","_onHandleClick","_onClick","histogramSelection","_animate","animate","getSelection","_prevHistogramData","_renderSelection","_handleClick","handles","h1","h2","getXPosition","labelOffsets","PositionUtils","nodes","_updateSelectionControlsHoverState","selectionbar","_onSelectionMouseOut","_onSelectionMouseOver","p","from","to","pos","hidden","hide","_onHandleDrag","disable","enable","barX","s","isLast","volumeIndex","selectionColor","overSelectionColor","barSelectionIndex","_getBarSelectionIndex","_getSelectionColor","isOver","isDisabled","overSelectionOpacity","inactiveBarOpacity","opacity","selection1","selection2","data1","data2","onTransition","onComplete","s1","s2","_this4","transitions","frames","abs","si","hi","bars","fillBars","_this5","_getBarColor","_getBarOpacity","prevSelection","prevData","setHandleXPosition","setLabelPosition","_onSelectionTransition","showLabel","_this6","hideLabel","HistogramRenderer","_historyData","_prevData","_selectionRenderer","_labelsVisible","margin","svg","left","right","top","bottom","histogram","inactive","active","getData","_renderXAxis","refresh","showSelectionLabels","hideSelectionLabels","v","ceil","HistogramSelection","_selection","assign","SelectionTypes","MultipleHistogramSelection","MULTI","DefaultHistogramSelectionImpl","start","MultipleHistogramSelectionImpl","FilterHistogramSelectionImpl","FILTER","InvertedFilterHistogramSelectionImpl","_getInvertedSelection","INVERTED_FILTER","HistogramSelectionFactory","selectionType","Histogram","enableSelectionToggle","_histogramRenderer","_selectionFactory","getHistogramSelection","String","setSelection","LINE_COLOR","LINE_COLORS","LINE_OPACITY","FILL_COLOR","FILL_COLORS","FILL_OPACITY","LINE_WIDTH","DOT_SIZE","AXIS_COLOR","ZERO_LINE_COLOR","LineData","TooltipRenderer","_lineData","_onMouseOut","xPos","bottomLabelWidth","filter","lineColors","lineColor","join","_tooltipGroup","_tooltipBottomLabel","textAnchor","_getTextAnchor","bottomMaskWidth","bottomMaskPadding","_tooltipBottomLabelMask","tooltipHtml","_getTooltipHTML","_tooltipTopLabel","labelLeft","_getLabelLeft","some","_tooltipLineCircle","circle","labelWidth","parentNode","contains","relatedTarget","_hideTooltip","hoverWidth","getSeries","_hoverAreas","_onHoverAreaOver","lineWidth","lineOpacity","_tooltipAxisCircle","insert","_tooltipRendered","gradientID","lineData","_renderTooltip","LineRenderer","_tooltipRenderer","line","verticalSpacing","allData","_renderZeroLine","seriesIndex","_renderDataLines","axisColor","_showZeroLine","zeroLineColor","minHeight","areaZero","fillColor","fillColors","area","y0","y1","_getGroupedData","fillOpacity","dotSize","path","group","_lineRenderer"],"mappings":"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"}
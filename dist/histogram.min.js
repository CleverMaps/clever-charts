!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.Histogram=e(t.d3)}(this,function(t){"use strict";function e(t,e,n,i){var o=t.getLabelBox(),r=e.getLabelBox(),a=r.x-(o.x+o.width)-n;if(a<0){var s=a/2,l=a/2;o.x+s<0&&(s=o.x,l*=2);var h=r.x+r.width-l;return h>i&&(l+=h-i,s*=2),[s,-l]}return[0,0]}function n(t,e){return void 0===t?e:t}var i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function t(e,n,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(i)},a=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},l=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];i(this,t),this._handlers=e.reduce(function(t,e){return t[e]=[],t},{})}return o(t,[{key:"on",value:function(t,e){if(!(t in this._handlers))throw"No such event: "+t;return this._handlers[t].push(e),this}},{key:"off",value:function(t,e){if(!(t in this._handlers))throw"No such event: "+t;if(e){var n=this._handlers[t],i=n.indexOf(e);-1!=i&&n.splice(i,1)}else this._handlers[t]=[];return this}},{key:"fire",value:function(t){if(!(t in this._handlers))throw"No such event: "+t;for(var e=this._handlers[t],n=arguments.length,i=Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];for(var r=0;r<e.length;r++)e[r].apply(this,i);return this}},{key:"destroy",value:function(){return this._handlers=null,this}}]),t}(),h=360,u=150,c={top:0,left:5,right:5,bottom:15},_="#f0f0f0",d=1,f="#ffea00",g=1,v="#49ace2",p=!0,m=11,b=["#e6f3fb","#cbe7f6","#b1dbf2","#98cfee","#7ec4ea"],y=function(){function e(t,n){i(this,e),this._histogramData=this._loadHistogramData(t,n.width),this._minMax=this._calculateMinMax(this._histogramData),this._options=n}return o(e,[{key:"getMinMax",value:function(){return this._minMax}},{key:"getData",value:function(){return this._histogramData}},{key:"_calculateMinMax",value:function(e){return{min:t.min(e,function(t){return t.value}),max:t.max(e,function(t){return t.value})}}},{key:"getValueRatio",value:function(){return(this._minMax.max-this._minMax.min)/this._options.width}},{key:"getPrecision",value:function(){var t=this._minMax.min,e=t.toString().split(".");return e.length>1?e[1].length:0}},{key:"positionToValue",value:function(t){return t*this.getValueRatio()+this.getMinMax().min}},{key:"valueToPosition",value:function(t){var e=this.getValueRatio();return t/e-this.getMinMax().min/e}},{key:"_loadHistogramData",value:function(e,n){var i=[],o=(n-1)/e.length;return e.forEach(function(n,r){var a=(n.max-n.min)/o;t.range(n.min,n.max,a).forEach(function(t){i.push({value:t,volume:n.content[0].frequency})}),r==e.length-1&&i.push({value:n.max,volume:n.content[0].frequency})}),i}}]),e}(),S=function(t,e){if("undefined"==typeof document)return e;t=t||"";var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");return i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),n.appendChild(i),e}("text {\r\n    font-family: Roboto;\r\n}\r\n\r\n._bar_1szrd_9 {\r\n\r\n}\r\n\r\ng {\r\n    border:1px solid #eeeeee;\r\n}\r\n\r\ng ._selectionbar_1szrd_25 {\r\n    cursor:default;\r\n}\r\n\r\n._x-axis_1szrd_33>path {\r\n    stroke: #F1F1F1;\r\n}\r\n\r\n._x-axis_1szrd_33 {\r\n    border:0;\r\n}\r\n\r\ng > text {\r\n    user-select: none;\r\n}\r\n\r\n._x-axis_1szrd_33>._tick_1szrd_57>text {\r\n    fill:#7d7d7d;\r\n}\r\n\r\ng._active_1szrd_65 ._custom-handle-circle_1szrd_65 {\r\n    stroke:#4a4a4a;\r\n}\r\n\r\ng._inactive_1szrd_73:not(._dragging_1szrd_73) ._custom-handle-circle_1szrd_65 {\r\n    stroke:#bababa;\r\n    r:2.5;\r\n}\r\n\r\ng._inactive_1szrd_73._dragging_1szrd_73 ._custom-handle-circle_1szrd_65 {\r\n    stroke:#4a4a4a;\r\n}    \r\n\r\ng._brush-drag_1szrd_91 ._custom-handle-circle_1szrd_65 {\r\n    stroke:#4a4a4a;\r\n}    \r\n\r\n._custom-handle-circle_1szrd_65 {\r\n    transition: r 0.1s ease-out;\r\n    pointer-events: none;\r\n}\r\n\r\n._brush-axis-line_1szrd_109 {\r\n    stroke:#4a4a4a;\r\n    display: none;\r\n    stroke-width: 1px;\r\n}\r\n\r\n._custom-handle-line_1szrd_121 {\r\n    stroke-width:0;\r\n    fill:#4A4A4A;\r\n    pointer-events: none;\r\n}\r\n\r\n._handle_1szrd_133 {\r\n    transition: all 0.05s ease-out;\r\n}\r\n\r\n._brush_1szrd_91>._selection_1szrd_25 {\r\n    fill: rgba(0, 0, 0, 0);\r\n    stroke: transparent;\r\n    cursor: grab;\r\n    cursor: -webkit-grab;\r\n    cursor: -moz-grab;\r\n}\r\n\r\n._brush_1szrd_91>._overlay_1szrd_157._grabbing_1szrd_157,\r\n._brush_1szrd_91>._selection_1szrd_25._grabbing_1szrd_157 {\r\n    cursor: grabbing ;\r\n    cursor: -webkit-grabbing ;\r\n    cursor: -moz-grabbing ;\r\n}\r\n\r\n._custom-handle_1szrd_65 {\r\n\r\n}\r\n\r\n._drag-label_1szrd_179 {\r\n    fill:#4A4A4A;\r\n}",{bar:"_bar_1szrd_9",selectionbar:"_selectionbar_1szrd_25","x-axis":"_x-axis_1szrd_33",tick:"_tick_1szrd_57",active:"_active_1szrd_65","custom-handle-circle":"_custom-handle-circle_1szrd_65",inactive:"_inactive_1szrd_73",dragging:"_dragging_1szrd_73","brush-drag":"_brush-drag_1szrd_91","brush-axis-line":"_brush-axis-line_1szrd_109","custom-handle-line":"_custom-handle-line_1szrd_121",handle:"_handle_1szrd_133",brush:"_brush_1szrd_91",selection:"_selection_1szrd_25",overlay:"_overlay_1szrd_157",grabbing:"_grabbing_1szrd_157","custom-handle":"_custom-handle_1szrd_65","drag-label":"_drag-label_1szrd_179"}),k=0,E=function(){function e(t,n,o,r,a){i(this,e),this._observable=new l(["drag","startDrag","endDrag"]),this._handleEl=null,this._handleLineEl=null,this._handleCircleEl=null,this._handleMaskEl=null,this._handleMaskGradientEl=null,this._handleLabelEl=null,this._isOver=!1,this._groupEl=t,this._index=o,this._value=n,this._position=r.valueToPosition(n),this._options=a,this._histogramData=r,this._labelSizeCache={},this._elements=[],this._renderHandle()}return o(e,[{key:"destroy",value:function(){this._elements.forEach(function(t){return t.remove()}),this._elements=[]}},{key:"_renderHandle",value:function(){this._elements=[this._createHandleElement(),this._createHandleLineElement(),this._createHandleCircleElement(),this._createDragMaskElement(),this._createMaskGradientElement(),this._createDragLabelElement()],this._handleHoverState(),this._handleDrag()}},{key:"hide",value:function(){this._elements.forEach(function(t){return t.attr("visibility","hidden")})}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"getXPosition",value:function(){return parseInt(this._handleEl.attr("x"))+2}},{key:"setHoverState",value:function(){this._handleLineEl.attr("fill-opacity",1),this._handleLabelEl.attr("fill-opacity",1),this._handleMaskEl.attr("display","block"),this._handleCircleEl.attr("stroke-width",3),this._updateLabelPosition(this._position)}},{key:"getLabelBox",value:function(){return this._handleLabelEl.node().getBBox()}},{key:"setLabelOffset",value:function(t){this._handleLabelEl.attr("transform","translate("+t+", 0)"),this._handleMaskEl.attr("transform","translate("+t+", 0)"),this._updateLabelPosition(this._position)}},{key:"setHandleXPosition",value:function(t){return this._handleCircleEl.attr("transform","translate("+t+", "+this._options.height+")"),this}},{key:"setLabelText",value:function(t){return this._handleLabelEl.text(t),this}},{key:"showLabel",value:function(){return this._handleLabelEl.attr("fill-opacity",1),this._handleMaskEl.attr("display","block"),this}},{key:"hideLabel",value:function(){return this._handleLabelEl.attr("fill-opacity",0),this._handleMaskEl.attr("display","none"),this}},{key:"setLabelPosition",value:function(t){return this.setLabelOffset(0),this._updateLabelPosition(t),this}},{key:"unsetHoverState",value:function(){this._handleLineEl.attr("fill-opacity",0),this._handleLabelEl.attr("fill-opacity",0),this._handleMaskEl.attr("display","none"),this._handleCircleEl.attr("stroke-width",1),this._handleLabelEl.attr("transform","translate(0, 0)"),this._handleMaskEl.attr("transform","translate(0, 0)")}},{key:"enable",value:function(){this._elements.forEach(function(t){return t.attr("pointer-events","all")})}},{key:"disable",value:function(){this._elements.forEach(function(t){return t.attr("pointer-events","none")})}},{key:"_handleHoverState",value:function(){var t=this;this._handleEl.on("mouseover",function(){t._isOver=!0,t.setHoverState()}),this._handleEl.on("mouseout",function(){t._isOver=!1,t.unsetHoverState()})}},{key:"_onStartDrag",value:function(){this._groupEl.classed(S.dragging,!0),this._observable.fire("startDrag",this)}},{key:"_onDrag",value:function(){var e=this,n=this._options.width,i=this._options.height,o=Math.round(Math.max(Math.min(t.event.x,n),0)),r=this._options.format;this._handleEl.attr("x",o-2),this._handleLineEl.attr("x",o-2),this._handleCircleEl.attr("transform","translate("+o+","+i+")"),this._handleEl.attr("data-handle-value",this._histogramData.positionToValue(o)),this.setHoverState(),this._value=this._histogramData.positionToValue(o),this._position=o,this._handleLabelEl.text(function(){return r(e._value)}),this._updateLabelPosition(o),this._observable.fire("drag")}},{key:"_onEndDrag",value:function(){this._groupEl.classed(S.dragging,!1),this._isOver||this.unsetHoverState(),this._observable.fire("endDrag",this)}},{key:"_handleDrag",value:function(){this._handleEl.call(t.drag().on("drag",this._onDrag.bind(this)).on("start",this._onStartDrag.bind(this)).on("end",this._onEndDrag.bind(this)))}},{key:"_getComputedLabelTextLength",value:function(t){var e=t.innerHTML;return this._labelSizeCache[e]=this._labelSizeCache[e]||t.getComputedTextLength(),this._labelSizeCache[e]}},{key:"_updateLabelPosition",value:function(t){var e=this._handleLabelEl.node(),n=this._options.fontSize,i=this._getComputedLabelTextLength(e),o=i+2*n,r=t-i/2;r<0&&(r=0),r+i>this._options.width?(r=this._options.width-i,this._handleLabelEl.attr("x",this._options.width),this._handleLabelEl.attr("text-anchor","end")):(this._handleLabelEl.attr("x",r),this._handleLabelEl.attr("text-anchor","start")),this._handleMaskEl.attr("x",function(){return parseInt(r)-n}),this._handleMaskGradientEl.attr("x1",r-n),this._handleMaskGradientEl.attr("x2",r+o-n),this._handleMaskEl.attr("width",o),this._handleMaskEl.attr("height",this._options.fontSize)}},{key:"_createMaskGradientElement",value:function(){return this._handleMaskGradientEl=this._groupEl.append("linearGradient").attr("id","brush-mask-gradient-"+k++).attr("gradientUnits","userSpaceOnUse").attr("y1",0).attr("x1",50).attr("y2",0).attr("x2",0),this._handleMaskGradientEl.selectAll("stop").data([{offset:"0%",color:"rgba(255,255,255,0)"},{offset:"20%",color:"rgba(255,255,255,1)"},{offset:"80%",color:"rgba(255,255,255,1)"},{offset:"100%",color:"rgba(255,255,255,0)"}]).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}),this._handleMaskGradientEl}},{key:"_createHandleElement",value:function(){return this._handleEl=this._groupEl.append("rect").attr("class",S["custom-handle"]).attr("fill-opacity",0).attr("data-handle-index",this._index).attr("data-handle-value",this._value).attr("cursor","ew-resize").attr("width",4).attr("height",this._options.height+5).attr("x",this._position-2),this._handleEl}},{key:"_createHandleLineElement",value:function(){return this._handleLineEl=this._groupEl.append("rect").attr("class",S["custom-handle-line"]).attr("width",4).attr("height",this._options.height).attr("fill-opacity",0).attr("x",this._position-2),this._handleLineEl}},{key:"_createHandleCircleElement",value:function(){return this._handleCircleEl=this._groupEl.append("circle").attr("class",S["custom-handle-circle"]).attr("transform","translate("+this._position+","+this._options.height+")").attr("fill","#ffffff").attr("fill-opacity",1).attr("stroke","#000").attr("stroke-width",1).attr("cursor","ew-resize").attr("r",3.5),this._handleCircleEl}},{key:"_createDragMaskElement",value:function(){return this._handleMaskEl=this._groupEl.append("rect").attr("class",S["drag-label-mask"]).attr("fill","url(#brush-mask-gradient-"+k+")").attr("y",this._options.height+7).attr("display","none"),this._handleMaskEl}},{key:"_createDragLabelElement",value:function(){var t=this,e=this._options.format,n=this._histogramData,i=this._options.height;return this._handleLabelEl=this._groupEl.append("text").attr("class",S["drag-label"]).attr("fill-opacity",0).attr("font-size",this._options.fontSize).text(function(){return e(n.positionToValue(t._position))}).attr("y",i+this._options.fontSize+7),this._updateLabelPosition(this._position),this._handleLabelEl}}]),e}(),x=function(){function n(t){i(this,n),this._options=t,this._groupEl=null,this._histogramData=null,this._histogramSelection=null,this._overSelectionIndex=null,this._rendered=!1,this._handles=[],this._draggingHandle=!1,this._prevSelection=null,this._rendered=!1,this._observable=new l(["selectionOver","toggleSelection","selectionChanged","handleClick"])}return o(n,[{key:"isRendered",value:function(){return this._rendered}},{key:"render",value:function(t){return this._rendered=!0,this._groupEl=t,this}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"_clear",value:function(){this._destroyHandles(),this._selectionBars&&this._selectionBars.remove()}},{key:"_destroyHandles",value:function(){this._handles.forEach(function(t){return t.destroy()}),this._handles=[]}},{key:"_onHandleClick",value:function(t,e){var n=this;this._options.promptHandler&&this._options.promptHandler(e).then(function(e){e=parseFloat(e);var i=n._histogramData.getMinMax();e=Math.min(i.max,e),e=Math.max(i.min,e);var o=n._histogramSelection.getSelectionPoints();o[t]={value:e};var r=o.map(function(t){return n._histogramData.valueToPosition(t.value)}).sort(function(t,e){return t-e});n._updateSelectionPositions(r),n._updateSelection(),n._destroyHandles(),n._renderHandles()}),this._observable.fire("handleClick",t,e)}},{key:"_toggleSelection",value:function(t){var e=this._options.selection[t];e.disabled=!e.disabled;var n=!e.disabled;this._updateSelection(),this._observable.fire("toggleSelection",t,n)}},{key:"_onClick",value:function(){var e=t.select(t.event.target),n=e.attr("data-selection-index"),i=e.attr("data-handle-index");null!=n&&this._histogramSelection.allowsToggle()?this._toggleSelection(n):null!=i&&this._onHandleClick(i,e.attr("data-handle-value"))}},{key:"_handleClick",value:function(){this._groupEl.on("click",this._onClick.bind(this))}},{key:"refresh",value:function(t,e,n){return this._animate=n&&n.animate,this._animate&&this._histogramSelection&&this._histogramSelection.getSelection().length==e.getSelection().length&&(this._prevSelection=this._histogramSelection.getSelection(),this._prevHistogramData=this._histogramSelection.getSelection()),this._animate&&this._histogramData&&(this._prevHistogramData=this._histogramData),this._histogramData=t,this._histogramSelection=e,this._clear(),this._renderSelection(),this._updateSelection(),this._handleHoverState(),this._handleClick(),this}},{key:"_updateSelectionControlsHoverState",value:function(t){var n=this._handles.slice().sort(function(t,e){return t.getXPosition()-e.getXPosition()});if(n.forEach(function(t){return t.unsetHoverState()}),null!=t){var i=n[t],o=n[t+1];i.setHoverState(),o.setHoverState();var r=e(i,o,this._options.fontSize,this._options.width);i.setLabelOffset(r[0]),o.setLabelOffset(r[1])}}},{key:"_onSelectionMouseOver",value:function(e,n,i){if(!this._draggingHandle){t.select(i[n]).attr("fill","rgba(0,0,0,0.00)");var o=parseInt(t.select(t.event.target).attr("data-selection-index"));this._overSelectionIndex!=o&&(this._overSelectionIndex=o,this._updateSelection(),this._updateSelectionControlsHoverState(o),this._observable.fire("selectionOver",this._overSelectionIndex))}}},{key:"_onSelectionMouseOut",value:function(e,n,i){this._draggingHandle||(t.select(i[n]).attr("fill","rgba(0,0,0,0)"),this._overSelectionIndex=null,this._updateSelectionControlsHoverState(null),this._updateSelection(),this._observable.fire("selectionOver",this._overSelectionIndex))}},{key:"_handleHoverState",value:function(){var t=this._groupEl;t.selectAll("."+S.selectionbar).on("mouseout",this._onSelectionMouseOut.bind(this)),t.selectAll("."+S.selectionbar).on("mouseover",this._onSelectionMouseOver.bind(this))}},{key:"_onHandleDrag",value:function(){var t=this._handles.map(function(t){return t.getXPosition()}).sort(function(t,e){return t-e});this._updateSelectionPositions(t)}},{key:"_updateSelectionPositions",value:function(t){var e=this,n=this._histogramSelection.getSelection();t.forEach(function(i,o){o>n.length-1||(n[o].from=e._histogramData.positionToValue(i),n[o].to=e._histogramData.positionToValue(t[o+1]))}),this._updateSelection()}},{key:"_renderSelection",value:function(){var t=this._options.height,e=this._histogramSelection.getSelection();this._selectionBars=this._groupEl.selectAll("."+S.selectionbar).data(e).enter().append("rect").attr("class",S.selectionbar).attr("y",0).attr("fill","rgba(0,0,0,0.00)").attr("height",t),this._renderHandles()}},{key:"_renderHandles",value:function(){var t=this;this._handles=this._histogramSelection.getSelectionPoints().map(function(e,n){var i=e.value,o=new E(t._groupEl,i,n,t._histogramData,t._options);e.hidden&&o.hide(),o.on("drag",function(){t._onHandleDrag()},t);var r;return o.on("startDrag",function(){r=JSON.stringify(t._options.selection),t._draggingHandle=!0,t._handles.forEach(function(t){return t.disable()}),o.enable()},t),o.on("endDrag",function(){t._draggingHandle=!1,t._handles.forEach(function(t){return t.enable()}),JSON.stringify(t._options.selection)!=r&&t._observable.fire("selectionChanged",t._histogramSelection.getOutputSelection())},t),o})}},{key:"_getBarSelectionIndex",value:function(t,e,n){for(var i=0;i<e.length;i++){var o=e[i];if(t>=n.valueToPosition(o.from)&&t<n.valueToPosition(o.to))return i}return null}},{key:"_getBarColor",value:function(t,e,n){var i=this._options.inactiveBarColor,o=this._options.overSelectionColor,r=this._getBarSelectionIndex(t,e,n);return null==r?i:e[r].disabled?i:this._histogramSelection.allowsToggle()&&this._overSelectionIndex==r?o:e[r].color||this._options.selectionColor}},{key:"_getBarOpacity",value:function(t,e,n){var i=this._getBarSelectionIndex(t,e,n),o=this._histogramSelection.allowsToggle()&&this._overSelectionIndex==i,r=null!=i&&e[i].disabled;return o?this._options.overSelectionOpacity:r?this._options.inactiveBarOpacity:null!=i&&null!=e[i].opacity?e[i].opacity:1}},{key:"_onSelectionTransition",value:function(t,e,n,i,o,r){var a=this;t.forEach(function(s,l){var h=e[l],u=a._options.width;if(t[l]){var c=[],_=[];c.push([Math.round(n.valueToPosition(s.from)),Math.round(i.valueToPosition(h.from))]),c.push([Math.round(n.valueToPosition(s.to)),Math.round(i.valueToPosition(h.to))]),_=[Math.abs((c[0][0]-c[0][1])/u),Math.abs((c[1][0]-c[1][1])/u)],c.forEach(function(t,e){for(var n=0;t[0]!==t[1];)setTimeout(o.bind(a,t[0],l,e),n),n+=1/_[e],t[0]=t[0]>t[1]?t[0]-1:t[0]+1;setTimeout(function(t,e,n){o(t,e,n),r(t,e,n)}.bind(a,t[1],l,e),++n)})}})}},{key:"_updateSelection",value:function(){var e=this,n=this._histogramSelection.getSelection(),i=this._groupEl.selectAll("."+S.bar),o=function(t,n){i.attr("fill",function(i){var o=e._histogramData.valueToPosition(i.value);return e._getBarColor(o,t,n)}),i.attr("fill-opacity",function(i){var o=e._histogramData.valueToPosition(i.value);return e._getBarOpacity(o,t,n)})};if(this._animate&&this._prevSelection){var r=this._prevSelection,a=this._prevHistogramData;o(r,this._prevHistogramData),r.forEach(function(t,n){var i=e._prevHistogramData.valueToPosition(t.from),o=e._prevHistogramData.valueToPosition(t.to);e._handles[n].setHandleXPosition(i).setLabelPosition(i),e._handles[n+1].setHandleXPosition(o).setLabelPosition(o)}),this._onSelectionTransition(r,n,a,this._histogramData,function(o,r,a){var s=t.select(i.nodes()[o-1]),l=e._getBarColor(o,n,e._histogramData);s.attr("fill",l),[e._handles[r],e._handles[r+1]][a].setHandleXPosition(o).setLabelPosition(o)},function(){o(n,e._histogramData)}),this._prevSelection=null,this._prevHistogramData=null}else o(n,this._histogramData);this._groupEl.selectAll("."+S.selectionbar).data(n).attr("data-selection-index",function(t,e){return e}).attr("x",function(t){return e._histogramData.valueToPosition(t.from)}).attr("width",function(t){return e._histogramData.valueToPosition(t.to)-e._histogramData.valueToPosition(t.from)})}},{key:"showSelectionLabels",value:function(){var t=this;this._histogramSelection.getSelection().forEach(function(n,i){var o=t._handles[i],r=t._handles[i+1],a=e(o,r,t._options.fontSize,t._options.width);o.setLabelOffset(a[0]),r.setLabelOffset(a[1])}),this._handles.forEach(function(t){return t.showLabel()})}},{key:"hideSelectionLabels",value:function(){this._handles.forEach(function(t){return t.hideLabel()})}},{key:"destroy",value:function(){return this._observable.destroy(),this._clear(),this}}]),n}(),w=function(){function e(n){var o=this;i(this,e),this._options=n,this._containerEl=null,this._groupEl=null,this._svgEl=null,this._historyData=null,this._xAxis=t.scaleBand().range([0,n.width]),this._yAxis=t.scaleLinear().range([n.height,0]),this._rendered=!1,this._prevData=null,this._selectionRenderer=new x(n),this._labelsVisible=!1,this._observable=new l(["selectionOver","toggleSelection","selectionChanged","handleClick"]),this._selectionRenderer.on("selectionOver",function(t){o._observable.fire("selectionOver",t)}),this._selectionRenderer.on("toggleSelection",function(t,e){o._observable.fire("toggleSelection",t,e)}),this._selectionRenderer.on("selectionChanged",function(t){o._observable.fire("selectionChanged",t)}),this._selectionRenderer.on("handleClick",function(t,e){o._observable.fire("handleClick",t,e)})}return o(e,[{key:"isRendered",value:function(){return this._rendered}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"render",value:function(e){var n=this._containerEl=t.select(e),i=this._options.width,o=this._options.height,r=c,a=this._svgEl=n.append("svg").attr("width",i+r.left+r.right).attr("height",o+r.top+this._options.fontSize+r.bottom),s=this._groupEl=this._svgEl.append("g").classed(S.inactive,!0).attr("transform","translate("+r.left+","+r.top+")");return a.on("mouseover.hover",function(){s.classed(S.active,!0),s.classed(S.inactive,!1)}),a.on("mouseout.hover",function(){s.classed(S.inactive,!0),s.classed(S.active,!1)}),this._selectionRenderer.render(s),this._rendered=!0,this}},{key:"_clear",value:function(){this._groupEl.node().innerHTML=""}},{key:"refresh",value:function(e,n,i){return this._animate=i&&i.animate,this._histogramData=e,this._clear(),this._xAxis.domain(e.getData().map(function(t){return t.value})),this._yAxis.domain([0,t.max(e.getData(),function(t){return t.volume})]),this._renderXAxis(),this._renderDataBars(),this._prevData=e.getData(),this._selectionRenderer.refresh(e,n,i),this._labelsVisible&&this.showSelectionLabels(),this}},{key:"showSelectionLabels",value:function(){this._selectionRenderer.showSelectionLabels(),this._groupEl.selectAll("."+S["x-axis"]).attr("display","none"),this._labelsVisible=!0}},{key:"hideSelectionLabels",value:function(){this._selectionRenderer.hideSelectionLabels(),this._groupEl.selectAll("."+S["x-axis"]).attr("display","block"),this._labelsVisible=!1}},{key:"_renderDataBars",value:function(){var e=this._histogramData.getData(),n=this._prevData,i=this._options.height,o=this._xAxis,r=this._yAxis;this._animate&&n?(o.domain(n.map(function(t){return t.value})),r.domain([0,t.max(n,function(t){return t.volume})]),this._groupEl.selectAll("."+S.bar).data(n).enter().append("rect").attr("class",S.bar).attr("x",function(t){return o(t.value)}).attr("width",o.bandwidth()).attr("y",function(t){return Math.floor(r(t.volume))}).attr("height",function(t){return Math.ceil(i-r(t.volume))}),o.domain(e.map(function(t){return t.value})),r.domain([0,t.max(e,function(t){return t.volume})]),this._groupEl.selectAll("."+S.bar).data(e).transition().duration(500).attr("y",function(t){return Math.floor(r(t.volume))}).attr("height",function(t){return Math.ceil(i-r(t.volume))})):this._groupEl.selectAll("."+S.bar).data(e).enter().append("rect").attr("class",S.bar).attr("x",function(t){return o(t.value)}).attr("width",o.bandwidth()).attr("y",function(t){return Math.floor(r(t.volume))}).attr("height",function(t){return Math.ceil(i-r(t.volume))})}},{key:"_renderXAxis",value:function(){var t=this,e=this._histogramData.getMinMax(),n=this._options.format,i=this._options.height+this._options.fontSize+7;this._groupEl.selectAll("."+S["x-axis"]).data([e.min,e.max]).enter().append("text").text(function(t){return n(t)}).attr("font-size",this._options.fontSize).attr("transform",function(e,n){return["translate(0,"+i+")","translate("+t._options.width+","+i+")"][n]}).attr("text-anchor",function(t,e){return["start","end"][e]}).classed(S["x-axis"],!0)}},{key:"destroy",value:function(){return this._rendered&&this._containerEl.node().removeChild(this._svgEl.node()),this._observable.destroy(),this._selectionRenderer.destroy(),this}}]),e}(),D=function(){function t(){i(this,t)}return o(t,[{key:"getSelection",value:function(){throw"HistogramSelection.getSelection() has to be implemented"}},{key:"getOutputSelection",value:function(){throw"HistogramSelection.getOutputSelection() has to be implemented"}},{key:"getSelectionType",value:function(){throw"HistogramSelection.getSelectionType() has to be implemented"}},{key:"allowsToggle",value:function(){throw"HistogramSelection.allowsToogle() has to be implemented"}},{key:"getSelectionPoints",value:function(){throw"HistogramSelection.getSelection() has to be implemented"}}]),t}(),L={MULTI:"multi",FILTER:"filter",INVERTED_FILTER:"inverted-filter"},M=function(t){function e(t,n){i(this,e);var o=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o._selection=n.slice(),o}return a(e,t),o(e,[{key:"getSelectionType",value:function(){return L.MULTI}},{key:"getSelection",value:function(){return this._selection}},{key:"getOutputSelection",value:function(){return this._selection}},{key:"allowsToggle",value:function(){return!0}},{key:"getSelectionPoints",value:function(){var t=[],e=this.getSelection();return e.forEach(function(n,i){t.push({value:n.from}),i==e.length-1&&t.push({value:n.to})}),t}}]),e}(D),z=function(t){function e(t){i(this,e);var n=t.getMinMax(),o=b,r=n.min,a=(n.max-n.min)/o.length,l=o.map(function(t){var e=r,n=r+a;return r+=a,{from:e,to:n,color:t}});return s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l))}return a(e,t),e}(M),T=function(t){function e(t,n){if(i(this,e),1!=n.length)throw"Filter selection doesn't allow more than one selection";var o=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return o._selection=n.slice(),o}return a(e,t),o(e,[{key:"getSelection",value:function(){return this._selection}},{key:"getOutputSelection",value:function(){return this._selection}},{key:"getSelectionType",value:function(){return L.FILTER}},{key:"allowsToggle",value:function(){return!1}},{key:"getSelectionPoints",value:function(){var t=[],e=this.getSelection();return e.forEach(function(n,i){t.push({value:n.from}),i==e.length-1&&t.push({value:n.to})}),t}}]),e}(D),H=function(t){function e(t,n){i(this,e);var o=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return o._selection=o._getInvertedSelection(t,n),o}return a(e,t),o(e,[{key:"_getInvertedSelection",value:function(t,e){var n=t.getMinMax();return[{from:n.min,to:e[0].from},{from:e[0].from,disabled:!0,to:e[0].to},{from:e[0].to,to:n.max}]}},{key:"getOutputSelection",value:function(){return[{from:this._selection[1].from,to:this._selection[1].to}]}},{key:"getSelectionType",value:function(){return L.INVERTED_FILTER}},{key:"getSelectionPoints",value:function(){var t=r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getSelectionPoints",this).call(this);return t[0].hidden=!0,t[t.length-1].hidden=!0,t}}]),e}(T),O=function(){function t(e){i(this,t),this._options=e}return o(t,[{key:"getHistogramSelection",value:function(t,e){return t?this._options.selectionType==L.FILTER?new T(e,t):this._options.selectionType==L.INVERTED_FILTER?new H(e,t):new M(e,t):new z(e,this._options.selection)}}]),t}(),C=function(){function e(t){var o=this;i(this,e),this._options={},this._options.promptHandler=t.promptHandler||null,this._options.width=n(t.width,h),this._options.height=n(t.height,u),this._options.format=n(t.format,null),this._options.inactiveBarColor=n(t.inactiveBarColor,_),this._options.inactiveBarOpacity=n(t.inactiveBarOpacity,d),this._options.overSelectionColor=n(t.overSelectionColor,f),this._options.overSelectionOpacity=n(t.overSelectionOpacity,g),this._options.selectionColor=n(t.selectionColor,v),this._options.enableSelectionToggle=n(t.enableSelectionToggle,p),this._options.fontSize=n(t.fontSize,m),this._options.selectionType=n(t.selectionType,null),this._observable=new l(["selectionOver","toggleSelection","selectionChanged","handleClick"]),this._histogramRenderer=new w(this._options),this._histogramRenderer.on("selectionOver",function(t){o._observable.fire("selectionOver",t)}),this._histogramRenderer.on("toggleSelection",function(t,e){o._observable.fire("toggleSelection",t,e)}),this._histogramRenderer.on("selectionChanged",function(t){o._observable.fire("selectionChanged",t)}),this._histogramRenderer.on("handleClick",function(t,e){o._observable.fire("handleClick",t,e)}),this._selectionFactory=new O(this._options)}return o(e,[{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"off",value:function(t,e){return this._observable.off(t,e),this}},{key:"destroy",value:function(){return this._observable.destroy(),this._histogramRenderer.destroy(),this._options=null,this}},{key:"render",value:function(t){return this._histogramRenderer.render(t),this}},{key:"setData",value:function(e,n,i){if(!this._histogramRenderer.isRendered())throw"Can't call setData() when widget is not rendered, please call .render() first.";var o=this._histogramData=new y(e,this._options),r=this._histogramSelection=this._selectionFactory.getHistogramSelection(n,o);return this._options.selection=r.getSelection(),this._selection=n,this._options.format?"string"==typeof this._options.format&&(this._options.format=t.format(this._options.format)):this._options.format=t.format(",."+this._histogramData.getPrecision()+"f"),this._histogramRenderer.refresh(o,r,i),this}},{key:"setSelectionType",value:function(t){return this._options.selectionType=t,this.setSelection(this._selection),this}},{key:"showSelectionLabels",value:function(){this._histogramRenderer.showSelectionLabels()}},{key:"hideSelectionLabels",value:function(){this._histogramRenderer.hideSelectionLabels()}},{key:"setSelection",value:function(t,e){if(!this._histogramRenderer.isRendered())throw"Can't call setData() when widget is not rendered, please call .render() first.";if(!this._histogramData)throw"Can't call setSelection() when no data is available.";var n=this._histogramSelection=this._selectionFactory.getHistogramSelection(t,this._histogramData);return this._options.selection=n.getSelection(),this._selection=t,
this._histogramRenderer.refresh(this._histogramData,this._histogramSelection,e),this}}]),e}();return C.SelectionTypes=L,C});
//# sourceMappingURL=histogram.min.js.map

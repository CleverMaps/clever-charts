!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.Histogram=e(t.d3)}(this,function(t){"use strict";function e(t,e,n,i){var a=t.getLabelBox(),r=e.getLabelBox(),o=r.x-(a.x+a.width)-n;if(o<0){var s=o/2,l=o/2;a.x+s<0&&(s=a.x,l*=2);var h=r.x+r.width-l;if(h>i){l+=h-i-2,s*=2}return[s,-l]}return[0,0]}function n(t,e){return void 0===t?e:t}var i=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=function t(e,n,i){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,n);if(void 0===a){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in a)return a.value;var o=a.get;if(void 0!==o)return o.call(i)},o=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},s=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},l=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];i(this,t),this._handlers=e.reduce(function(t,e){return t[e]=[],t},{})}return a(t,[{key:"on",value:function(t,e){if(!(t in this._handlers))throw"No such event: "+t;return this._handlers[t].push(e),this}},{key:"off",value:function(t,e){if(!(t in this._handlers))throw"No such event: "+t;if(e){var n=this._handlers[t],i=n.indexOf(e);-1!=i&&n.splice(i,1)}else this._handlers[t]=[];return this}},{key:"fire",value:function(t){if(!(t in this._handlers))throw"No such event: "+t;for(var e=this._handlers[t],n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];for(var r=0;r<e.length;r++)e[r].apply(this,i);return this}},{key:"destroy",value:function(){return this._handlers=null,this}}]),t}(),h=360,u=150,c={top:0,left:5,right:5,bottom:25},_="#f0f0f0",d="#ffea00",f="#49ace2",g=!0,v=10,p=["#e6f3fb","#cbe7f6","#b1dbf2","#98cfee","#7ec4ea"],m=function(){function e(t,n){i(this,e),this._histogramData=this._loadHistogramData(t,n.width),this._minMax=this._calculateMinMax(this._histogramData),this._options=n}return a(e,[{key:"getMinMax",value:function(){return this._minMax}},{key:"getData",value:function(){return this._histogramData}},{key:"_calculateMinMax",value:function(e){return{min:t.min(e,function(t){return t.value}),max:t.max(e,function(t){return t.value})}}},{key:"getValueRatio",value:function(){return(this._minMax.max-this._minMax.min)/this._options.width}},{key:"getPrecision",value:function(){var t=this._minMax.min,e=t.toString().split(".");return e.length>1?e[1].length:0}},{key:"positionToValue",value:function(t){return t*this.getValueRatio()+this.getMinMax().min}},{key:"valueToPosition",value:function(t){var e=this.getValueRatio();return t/e-this.getMinMax().min/e}},{key:"_loadHistogramData",value:function(e,n){var i=[],a=(n-1)/e.length;return e.forEach(function(n,r){var o=(n.max-n.min)/a;t.range(n.min,n.max,o).forEach(function(t){i.push({value:t,volume:n.content[0].frequency})}),r==e.length-1&&i.push({value:n.max,volume:n.content[0].frequency})}),i}}]),e}(),b=function(t,e){if("undefined"==typeof document)return e;t=t||"";var n=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");return i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),n.appendChild(i),e}("text {\r\n    font-size: 10px;\r\n    font-family: Roboto;\r\n}\r\n\r\n._bar_iaaj7_11 {\r\n\r\n}\r\n\r\ng {\r\n    border:1px solid #eeeeee;\r\n}\r\n\r\ng ._selectionbar_iaaj7_27 {\r\n    cursor:default;\r\n}\r\n\r\n._x-axis_iaaj7_35>path {\r\n    stroke: #F1F1F1;\r\n}\r\n\r\n._x-axis_iaaj7_35 {\r\n    border:0;\r\n}\r\n\r\ng > text {\r\n    user-select: none;\r\n}\r\n\r\n._x-axis_iaaj7_35>._tick_iaaj7_59>text {\r\n    fill:#7d7d7d;\r\n}\r\n\r\ng._active_iaaj7_67 ._custom-handle-circle_iaaj7_67 {\r\n    stroke:#4a4a4a;\r\n}\r\n\r\ng._inactive_iaaj7_75:not(._dragging_iaaj7_75) ._custom-handle-circle_iaaj7_67 {\r\n    stroke:#bababa;\r\n    r:2.5;\r\n}\r\n\r\n\r\ng._inactive_iaaj7_75._dragging_iaaj7_75 ._custom-handle-circle_iaaj7_67 {\r\n    stroke:#4a4a4a;\r\n}    \r\n\r\ng._brush-drag_iaaj7_95 ._custom-handle-circle_iaaj7_67 {\r\n    stroke:#4a4a4a;\r\n}    \r\n\r\n._custom-handle-circle_iaaj7_67 {\r\n    transition: r 0.1s ease-out;\r\n    pointer-events: none;\r\n}\r\n\r\n._brush-axis-line_iaaj7_113 {\r\n    stroke:#4a4a4a;\r\n    display: none;\r\n    stroke-width: 1px;\r\n}\r\n\r\n._custom-handle-line_iaaj7_125 {\r\n    stroke-width:0;\r\n    fill:#4A4A4A;\r\n    pointer-events: none;\r\n}\r\n\r\n._handle_iaaj7_137 {\r\n    transition: all 0.05s ease-out;\r\n}\r\n\r\n._brush_iaaj7_95>._selection_iaaj7_27 {\r\n    fill: rgba(0, 0, 0, 0);\r\n    stroke: transparent;\r\n    cursor: grab;\r\n    cursor: -webkit-grab;\r\n    cursor: -moz-grab;\r\n}\r\n\r\n._brush_iaaj7_95>._overlay_iaaj7_161._grabbing_iaaj7_161,\r\n._brush_iaaj7_95>._selection_iaaj7_27._grabbing_iaaj7_161 {\r\n    cursor: grabbing ;\r\n    cursor: -webkit-grabbing ;\r\n    cursor: -moz-grabbing ;\r\n}\r\n\r\n._custom-handle_iaaj7_67 {\r\n\r\n}\r\n\r\n._drag-label_iaaj7_183 {\r\n    fill:#4A4A4A;\r\n}",{bar:"_bar_iaaj7_11",selectionbar:"_selectionbar_iaaj7_27","x-axis":"_x-axis_iaaj7_35",tick:"_tick_iaaj7_59",active:"_active_iaaj7_67","custom-handle-circle":"_custom-handle-circle_iaaj7_67",inactive:"_inactive_iaaj7_75",dragging:"_dragging_iaaj7_75","brush-drag":"_brush-drag_iaaj7_95","brush-axis-line":"_brush-axis-line_iaaj7_113","custom-handle-line":"_custom-handle-line_iaaj7_125",handle:"_handle_iaaj7_137",brush:"_brush_iaaj7_95",selection:"_selection_iaaj7_27",overlay:"_overlay_iaaj7_161",grabbing:"_grabbing_iaaj7_161","custom-handle":"_custom-handle_iaaj7_67","drag-label":"_drag-label_iaaj7_183"}),y=0,k=function(){function e(t,n,a,r,o){i(this,e),this._observable=new l(["drag","startDrag","endDrag"]),this._handleEl=null,this._handleLineEl=null,this._handleCircleEl=null,this._handleMaskEl=null,this._handleMaskGradientEl=null,this._handleLabelEl=null,this._isOver=!1,this._groupEl=t,this._index=a,this._value=n,this._position=r.valueToPosition(n),this._options=o,this._histogramData=r,this._elements=[],this._renderHandle()}return a(e,[{key:"destroy",value:function(){this._elements.forEach(function(t){return t.remove()}),this._elements=[]}},{key:"_renderHandle",value:function(){this._elements=[this._createHandleElement(),this._createHandleLineElement(),this._createHandleCircleElement(),this._createDragMaskElement(),this._createMaskGradientElement(),this._createDragLabelElement()],this._handleHoverState(),this._handleDrag()}},{key:"hide",value:function(){this._elements.forEach(function(t){return t.attr("visibility","hidden")})}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"getXPosition",value:function(){return parseInt(this._handleEl.attr("x"))+5}},{key:"setHoverState",value:function(){this._handleLineEl.attr("fill-opacity",1),this._handleLabelEl.attr("fill-opacity",1),this._handleMaskEl.attr("display","block"),this._handleCircleEl.attr("stroke-width",3)}},{key:"getLabelBox",value:function(){return this._handleLabelEl.node().getBBox()}},{key:"setLabelOffset",value:function(t){this._handleLabelEl.attr("transform","translate("+t+", 0)"),this._handleMaskEl.attr("transform","translate("+t+", 0)")}},{key:"setHandleXPosition",value:function(t){this._handleCircleEl.attr("transform","translate("+t+", "+this._options.height+")")}},{key:"unsetHoverState",value:function(){this._handleLineEl.attr("fill-opacity",0),this._handleLabelEl.attr("fill-opacity",0),this._handleMaskEl.attr("display","none"),this._handleCircleEl.attr("stroke-width",1),this._handleLabelEl.attr("transform","translate(0, 0)"),this._handleMaskEl.attr("transform","translate(0, 0)")}},{key:"enable",value:function(){this._elements.forEach(function(t){return t.attr("pointer-events","all")})}},{key:"disable",value:function(){this._elements.forEach(function(t){return t.attr("pointer-events","none")})}},{key:"_handleHoverState",value:function(){var t=this;this._handleEl.on("mouseover",function(){t._isOver=!0,t.setHoverState()}),this._handleEl.on("mouseout",function(){t._isOver=!1,t.unsetHoverState()})}},{key:"_onStartDrag",value:function(){this._groupEl.classed(b.dragging,!0),this._observable.fire("startDrag",this)}},{key:"_onDrag",value:function(){var e=this,n=this._options.width,i=this._options.height,a=Math.round(Math.max(Math.min(t.event.x,n),0)),r=this._options.format;this._handleEl.attr("x",a-5),this._handleLineEl.attr("x",a-2),this._handleCircleEl.attr("transform","translate("+a+","+i+")"),this._handleEl.attr("data-handle-value",this._histogramData.positionToValue(a)),this.setHoverState(),this._handleLabelEl.text(function(){return r(e._histogramData.positionToValue(a))}),this._updateLabelPosition(a),this._observable.fire("drag")}},{key:"_onEndDrag",value:function(){this._groupEl.classed(b.dragging,!1),this._isOver||this.unsetHoverState(),this._observable.fire("endDrag",this)}},{key:"_handleDrag",value:function(){this._handleEl.call(t.drag().on("drag",this._onDrag.bind(this)).on("start",this._onStartDrag.bind(this)).on("end",this._onEndDrag.bind(this)))}},{key:"_updateLabelPosition",value:function(t){var e=this._handleLabelEl.node(),n=this._options.maskPadding,i=e.getComputedTextLength(),a=i+2*n,r=t-i/2;r<0&&(r=0),r+i>this._options.width?(r=this._options.width-i,this._handleLabelEl.attr("x",this._options.width),this._handleLabelEl.attr("text-anchor","end")):(this._handleLabelEl.attr("x",r),this._handleLabelEl.attr("text-anchor","start")),this._handleMaskEl.attr("x",function(){return parseInt(r)-n}),this._handleMaskGradientEl.attr("x1",r-n),this._handleMaskGradientEl.attr("x2",r+a-n),this._handleMaskEl.attr("width",a),this._handleMaskEl.attr("height",20)}},{key:"_createMaskGradientElement",value:function(){return this._handleMaskGradientEl=this._groupEl.append("linearGradient").attr("id","brush-mask-gradient-"+y++).attr("gradientUnits","userSpaceOnUse").attr("y1",0).attr("x1",50).attr("y2",0).attr("x2",0),this._handleMaskGradientEl.selectAll("stop").data([{offset:"0%",color:"rgba(255,255,255,0)"},{offset:"20%",color:"rgba(255,255,255,1)"},{offset:"80%",color:"rgba(255,255,255,1)"},{offset:"100%",color:"rgba(255,255,255,0)"}]).enter().append("stop").attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color}),this._handleMaskGradientEl}},{key:"_createHandleElement",value:function(){return this._handleEl=this._groupEl.append("rect").attr("class",b["custom-handle"]).attr("fill-opacity",0).attr("data-handle-index",this._index).attr("data-handle-value",this._value).attr("cursor","ew-resize").attr("width",10).attr("height",this._options.height+5).attr("x",this._position-5),this._handleEl}},{key:"_createHandleLineElement",value:function(){return this._handleLineEl=this._groupEl.append("rect").attr("class",b["custom-handle-line"]).attr("width",4).attr("height",this._options.height).attr("fill-opacity",0).attr("x",this._position-2),this._handleLineEl}},{key:"_createHandleCircleElement",value:function(){return this._handleCircleEl=this._groupEl.append("circle").attr("class",b["custom-handle-circle"]).attr("transform","translate("+this._position+","+this._options.height+")").attr("fill","#ffffff").attr("fill-opacity",1).attr("stroke","#000").attr("stroke-width",1).attr("cursor","ew-resize").attr("r",3.5),this._handleCircleEl}},{key:"_createDragMaskElement",value:function(){return this._handleMaskEl=this._groupEl.append("rect").attr("class",b["drag-label-mask"]).attr("fill","url(#brush-mask-gradient-"+y+")").attr("y",this._options.height+12).attr("display","none"),this._handleMaskEl}},{key:"_createDragLabelElement",value:function(){var t=this,e=this._options.format,n=this._histogramData,i=this._options.height;return this._handleLabelEl=this._groupEl.append("text").attr("class",b["drag-label"]).attr("fill-opacity",0).text(function(){return e(n.positionToValue(t._position))}).attr("y",i+22),this._updateLabelPosition(this._position),this._handleLabelEl}}]),e}(),S=function(){function n(t){i(this,n),this._options=t,this._groupEl=null,this._histogramData=null,this._histogramSelection=null,this._overSelectionIndex=null,this._rendered=!1,this._handles=[],this._draggingHandle=!1,this._prevSelection=null,this._rendered=!1,this._observable=new l(["selectionOver","toggleSelection","selectionChanged","handleClick"])}return a(n,[{key:"isRendered",value:function(){return this._rendered}},{key:"render",value:function(t){return this._rendered=!0,this._groupEl=t,this}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"_clear",value:function(){this._destroyHandles(),this._selectionBars&&this._selectionBars.remove()}},{key:"_destroyHandles",value:function(){this._handles.forEach(function(t){return t.destroy()}),this._handles=[]}},{key:"_onHandleClick",value:function(t,e){var n=this;this._options.promptHandler&&this._options.promptHandler(this._options.format(e)).then(function(e){e=parseFloat(e);var i=n._histogramData.getMinMax();e=Math.min(i.max,e),e=Math.max(i.min,e);var a=n._histogramSelection.getSelectionPoints();a[t]={value:e};var r=a.map(function(t){return n._histogramData.valueToPosition(t.value)}).sort(function(t,e){return t-e});n._updateSelectionPositions(r),n._updateSelection(),n._destroyHandles(),n._renderHandles()}),this._observable.fire("handleClick",t,e)}},{key:"_toggleSelection",value:function(t){var e=this._options.selection[t];e.disabled=!e.disabled;var n=!e.disabled;this._updateSelection(),this._observable.fire("toggleSelection",t,n)}},{key:"_onClick",value:function(){var e=t.select(t.event.target),n=e.attr("data-selection-index"),i=e.attr("data-handle-index");null!=n&&this._histogramSelection.allowsToggle()?this._toggleSelection(n):null!=i&&this._onHandleClick(i,e.attr("data-handle-value"))}},{key:"_handleClick",value:function(){this._groupEl.on("click",this._onClick.bind(this))}},{key:"refresh",value:function(t,e){return this._histogramSelection&&this._histogramSelection.getSelection().length==e.getSelection().length&&(this._prevSelection=this._histogramSelection.getSelection()),this._histogramData=t,this._histogramSelection=e,this._clear(),this._renderSelection(),this._updateSelection(),this._handleHoverState(),this._handleClick(),this}},{key:"_updateSelectionControlsHoverState",value:function(t){var n=this._handles.slice().sort(function(t,e){return t.getXPosition()-e.getXPosition()});if(n.forEach(function(t){return t.unsetHoverState()}),null!=t){var i=n[t],a=n[t+1];i.setHoverState(),a.setHoverState();var r=e(i,a,this._options.maskPadding,this._options.width);i.setLabelOffset(r[0]),a.setLabelOffset(r[1])}}},{key:"_onSelectionMouseOver",value:function(e,n,i){if(!this._draggingHandle){t.select(i[n]).attr("fill","rgba(0,0,0,0.00)");var a=parseInt(t.select(t.event.target).attr("data-selection-index"));this._overSelectionIndex!=a&&(this._overSelectionIndex=a,this._updateSelection(),this._updateSelectionControlsHoverState(a),this._observable.fire("selectionOver",this._overSelectionIndex))}}},{key:"_onSelectionMouseOut",value:function(e,n,i){this._draggingHandle||(t.select(i[n]).attr("fill","rgba(0,0,0,0)"),this._overSelectionIndex=null,this._updateSelectionControlsHoverState(null),this._updateSelection(),this._observable.fire("selectionOver",this._overSelectionIndex))}},{key:"_handleHoverState",value:function(){var t=this._groupEl;t.selectAll("."+b.selectionbar).on("mouseout",this._onSelectionMouseOut.bind(this)),t.selectAll("."+b.selectionbar).on("mouseover",this._onSelectionMouseOver.bind(this))}},{key:"_onHandleDrag",value:function(){var t=this._handles.map(function(t){return t.getXPosition()}).sort(function(t,e){return t-e});this._updateSelectionPositions(t)}},{key:"_updateSelectionPositions",value:function(t){var e=this,n=this._histogramSelection.getSelection();t.forEach(function(i,a){a>n.length-1||(n[a].from=e._histogramData.positionToValue(i),n[a].to=e._histogramData.positionToValue(t[a+1]))}),this._updateSelection()}},{key:"_renderSelection",value:function(){var t=this._options.height,e=this._histogramSelection.getSelection();this._selectionBars=this._groupEl.selectAll("."+b.selectionbar).data(e).enter().append("rect").attr("class",b.selectionbar).attr("y",0).attr("fill","rgba(0,0,0,0.00)").attr("height",t),this._renderHandles()}},{key:"_renderHandles",value:function(){var t=this;this._handles=this._histogramSelection.getSelectionPoints().map(function(e,n){var i=e.value,a=new k(t._groupEl,i,n,t._histogramData,t._options);e.hidden&&a.hide(),a.on("drag",function(){t._onHandleDrag()},t);var r;return a.on("startDrag",function(){r=JSON.stringify(t._options.selection),t._draggingHandle=!0,t._handles.forEach(function(t){return t.disable()}),a.enable()},t),a.on("endDrag",function(){t._draggingHandle=!1,t._handles.forEach(function(t){return t.enable()}),JSON.stringify(t._options.selection)!=r&&t._observable.fire("selectionChanged",t._histogramSelection.getOutputSelection())},t),a})}},{key:"_getBarSelectionIndex",value:function(t,e){for(var n=0;n<e.length;n++){var i=e[n];if(t>=this._histogramData.valueToPosition(i.from)&&t<this._histogramData.valueToPosition(i.to))return n}return null}},{key:"_getBarColor",value:function(t,e){var n=this._options.inactiveBarColor,i=this._options.overSelectionColor,a=this._getBarSelectionIndex(t,e);return null==a?n:e[a].disabled?n:this._histogramSelection.allowsToggle()&&this._overSelectionIndex==a?i:e[a].color||this._options.selectionColor}},{key:"_onSelectionTransition",value:function(t,e,n){var i=this,a=this._histogramData;t.forEach(function(r,o){var s=e[o],l=i._options.width;if(t[o]){var h=[],u=[];h.push([Math.round(a.valueToPosition(r.from)),Math.round(a.valueToPosition(s.from))]),h.push([Math.round(a.valueToPosition(r.to)),Math.round(a.valueToPosition(s.to))]),u=[Math.abs((h[0][0]-h[0][1])/l),Math.abs((h[1][0]-h[1][1])/l)],h.forEach(function(t,e){for(var a=0;t[0]!==t[1];)setTimeout(n.bind(i,t[0],o,e),a),a+=1/u[e],t[0]=t[0]>t[1]?t[0]-1:t[0]+1;setTimeout(n.bind(i,t[1],o,e),++a)})}})}},{key:"_updateSelection",value:function(){var e=this,n=this._histogramSelection.getSelection(),i=this._groupEl.selectAll("."+b.bar),a=function(t){i.attr("fill",function(n){var i=e._histogramData.valueToPosition(n.value);return e._getBarColor(i,t)})};this._prevSelection?(a(this._prevSelection),this._prevSelection.forEach(function(t,n){e._handles[n].setHandleXPosition(e._histogramData.valueToPosition(t.from)),e._handles[n+1].setHandleXPosition(e._histogramData.valueToPosition(t.to))}),this._onSelectionTransition(this._prevSelection,n,function(a,r,o){t.select(i.nodes()[a-1]).attr("fill",e._getBarColor(a,n)),[e._handles[r],e._handles[r+1]][o].setHandleXPosition(a)}),this._prevSelection=null):a(n),this._groupEl.selectAll("."+b.selectionbar).data(n).attr("data-selection-index",function(t,e){return e}).attr("x",function(t){return e._histogramData.valueToPosition(t.from)}).attr("width",function(t){return e._histogramData.valueToPosition(t.to)-e._histogramData.valueToPosition(t.from)})}},{key:"destroy",value:function(){return this._observable.destroy(),this._clear(),this}}]),n}(),E=function(){function e(n){var a=this;i(this,e),this._options=n,this._containerEl=null,this._groupEl=null,this._svgEl=null,this._historyData=null,this._xAxis=t.scaleBand().range([0,n.width]),this._yAxis=t.scaleLinear().range([n.height,0]),this._rendered=!1,this._prevData=null,this._selectionRenderer=new S(n),this._observable=new l(["selectionOver","toggleSelection","selectionChanged","handleClick"]),this._selectionRenderer.on("selectionOver",function(t){a._observable.fire("selectionOver",t)}),this._selectionRenderer.on("toggleSelection",function(t,e){a._observable.fire("toggleSelection",t,e)}),this._selectionRenderer.on("selectionChanged",function(t){a._observable.fire("selectionChanged",t)}),this._selectionRenderer.on("handleClick",function(t,e){a._observable.fire("handleClick",t,e)})}return a(e,[{key:"isRendered",value:function(){return this._rendered}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"render",value:function(e){var n=this._containerEl=t.select(e),i=this._options.width,a=this._options.height,r=c,o=this._svgEl=n.append("svg").attr("width",i+r.left+r.right).attr("height",a+r.top+r.bottom),s=this._groupEl=this._svgEl.append("g").classed(b.inactive,!0).attr("transform","translate("+r.left+","+r.top+")");return o.on("mouseover.hover",function(){s.classed(b.active,!0),s.classed(b.inactive,!1)}),o.on("mouseout.hover",function(){s.classed(b.inactive,!0),s.classed(b.active,!1)}),this._selectionRenderer.render(s),this._rendered=!0,this}},{key:"_clear",value:function(){this._groupEl.node().innerHTML=""}},{key:"refresh",value:function(e,n){return this._histogramData=e,this._clear(),this._xAxis.domain(e.getData().map(function(t){return t.value})),this._yAxis.domain([0,t.max(e.getData(),function(t){return t.volume})]),this._renderXAxis(),this._renderDataBars(),this._prevData=e.getData(),this._selectionRenderer.refresh(e,n),this}},{key:"_renderDataBars",value:function(){var e=this._histogramData.getData(),n=this._prevData,i=this._options.height,a=this._xAxis,r=this._yAxis;n?(a.domain(n.map(function(t){return t.value})),r.domain([0,t.max(n,function(t){return t.volume})]),this._groupEl.selectAll("."+b.bar).data(n).enter().append("rect").attr("class",b.bar).attr("x",function(t){return a(t.value)}).attr("width",a.bandwidth()).attr("y",function(t){return Math.floor(r(t.volume))}).attr("height",function(t){return Math.ceil(i-r(t.volume))}),a.domain(e.map(function(t){return t.value})),r.domain([0,t.max(e,function(t){return t.volume})]),this._groupEl.selectAll("."+b.bar).data(e).transition().duration(500).attr("y",function(t){return Math.floor(r(t.volume))}).attr("height",function(t){return Math.ceil(i-r(t.volume))})):this._groupEl.selectAll("."+b.bar).data(e).enter().append("rect").attr("class",b.bar).attr("x",function(t){return a(t.value)}).attr("width",a.bandwidth()).attr("y",function(t){return Math.floor(r(t.volume))}).attr("height",function(t){return Math.ceil(i-r(t.volume))})}},{key:"_renderXAxis",value:function(){var e=this._histogramData.getMinMax(),n=this._options.format,i=this._options.width,a=this._options.height,r=t.axisBottom(this._xAxis).tickValues([e.min,e.max]).tickSize(0).tickFormat(n).tickPadding(15),o=this._groupEl.append("g").attr("transform","translate(0,"+a+")").classed(b["x-axis"],!0).call(r);o.selectAll(".tick").attr("transform",function(t,e){return["translate(0,0)","translate("+i+",0)"][e]}),o.selectAll(".tick>text").attr("x",0),o.selectAll(".tick").attr("text-anchor",function(t,e){return["start","end"][e]})}},{key:"destroy",value:function(){return this._rendered&&this._containerEl.node().removeChild(this._svgEl.node()),this._observable.destroy(),this._selectionRenderer.destroy(),this}}]),e}(),x=function(){function t(){i(this,t)}return a(t,[{key:"getSelection",value:function(){throw"HistogramSelection.getSelection() has to be implemented"}},{key:"getOutputSelection",value:function(){throw"HistogramSelection.getOutputSelection() has to be implemented"}},{key:"getSelectionType",value:function(){throw"HistogramSelection.getSelectionType() has to be implemented"}},{key:"allowsToggle",value:function(){throw"HistogramSelection.allowsToogle() has to be implemented"}},{key:"getSelectionPoints",value:function(){throw"HistogramSelection.getSelection() has to be implemented"}}]),t}(),w={MULTI:"multi",FILTER:"filter",INVERTED_FILTER:"inverted-filter"},D=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a._selection=n.slice(),a}return o(e,t),a(e,[{key:"getSelectionType",value:function(){return w.MULTI}},{key:"getSelection",value:function(){return this._selection}},{key:"getOutputSelection",value:function(){return this._selection}},{key:"allowsToggle",value:function(){return!0}},{key:"getSelectionPoints",value:function(){var t=[],e=this.getSelection();return e.forEach(function(n,i){t.push({value:n.from}),i==e.length-1&&t.push({value:n.to})}),t}}]),e}(x),M=function(t){function e(t){i(this,e);var n=t.getMinMax(),a=p,r=n.min,o=(n.max-n.min)/a.length,l=a.map(function(t){var e=r,n=r+o;return r+=o,{from:e,to:n,color:t}});return s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,l))}return o(e,t),e}(D),T=function(t){function e(t,n){if(i(this,e),1!=n.length)throw"Filter selection doesn't allow more than one selection";var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a._selection=n.slice(),a}return o(e,t),a(e,[{key:"getSelection",value:function(){return this._selection}},{key:"getOutputSelection",value:function(){return this._selection}},{key:"getSelectionType",value:function(){return w.FILTER}},{key:"allowsToggle",value:function(){return!1}},{key:"getSelectionPoints",value:function(){var t=[],e=this.getSelection();return e.forEach(function(n,i){t.push({value:n.from}),i==e.length-1&&t.push({value:n.to})}),t}}]),e}(x),j=function(t){function e(t,n){i(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return a._selection=a._getInvertedSelection(t,n),a}return o(e,t),a(e,[{key:"_getInvertedSelection",value:function(t,e){var n=t.getMinMax();return[{from:n.min,to:e[0].from},{from:e[0].from,disabled:!0,to:e[0].to},{from:e[0].to,to:n.max}]}},{key:"getOutputSelection",value:function(){return[{from:this._selection[1].from,to:this._selection[1].to}]}},{key:"getSelectionType",value:function(){return w.INVERTED_FILTER}},{key:"getSelectionPoints",value:function(){var t=r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"getSelectionPoints",this).call(this);return t[0].hidden=!0,t[t.length-1].hidden=!0,t}}]),e}(T),H=function(){function t(e){i(this,t),this._options=e}return a(t,[{key:"getHistogramSelection",value:function(t,e){return t?this._options.selectionType==w.FILTER?new T(e,t):this._options.selectionType==w.INVERTED_FILTER?new j(e,t):new D(e,t):new M(e,this._options.selection)}}]),t}(),C=function(){function e(t){var a=this;i(this,e),this._options={},this._options.promptHandler=t.promptHandler||null,this._options.width=n(t.width,h),this._options.height=n(t.height,u),this._options.format=n(t.format,null),this._options.inactiveBarColor=n(t.inactiveBarColor,_),this._options.overSelectionColor=n(t.overSelectionColor,d),this._options.selectionColor=n(t.selectionColor,f),this._options.enableSelectionToggle=n(t.enableSelectionToggle,g),this._options.maskPadding=n(t.maskPadding,v),this._options.selectionType=n(t.selectionType,null),this._observable=new l(["selectionOver","toggleSelection","selectionChanged","handleClick"]),this._histogramRenderer=new E(this._options),this._histogramRenderer.on("selectionOver",function(t){a._observable.fire("selectionOver",t)}),this._histogramRenderer.on("toggleSelection",function(t,e){a._observable.fire("toggleSelection",t,e)}),this._histogramRenderer.on("selectionChanged",function(t){a._observable.fire("selectionChanged",t)}),this._histogramRenderer.on("handleClick",function(t,e){a._observable.fire("handleClick",t,e)}),this._selectionFactory=new H(this._options)}return a(e,[{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"off",value:function(t,e){return this._observable.off(t,e),this}},{key:"destroy",value:function(){return this._observable.destroy(),this._histogramRenderer.destroy(),this._options=null,this}},{key:"render",value:function(t){return this._histogramRenderer.render(t),this}},{key:"setData",value:function(e,n){if(!this._histogramRenderer.isRendered())throw"Can't call setData() when widget is not rendered, please call .render() first.";var i=this._histogramData=new m(e,this._options),a=this._histogramSelection=this._selectionFactory.getHistogramSelection(n,i);return this._options.selection=a.getSelection(),this._selection=n,this._options.format?"string"==typeof this._options.format&&(this._options.format=t.format(this._options.format)):this._options.format=t.format(",."+this._histogramData.getPrecision()+"f"),this._histogramRenderer.refresh(i,a),this}},{key:"setSelectionType",value:function(t){return this._options.selectionType=t,this.setSelection(this._selection),this}},{key:"setSelection",value:function(t){if(!this._histogramRenderer.isRendered())throw"Can't call setData() when widget is not rendered, please call .render() first.";if(!this._histogramData)throw"Can't call setSelection() when no data is available.";var e=this._histogramSelection=this._selectionFactory.getHistogramSelection(t,this._histogramData);return this._options.selection=e.getSelection(),this._selection=t,this._histogramRenderer.refresh(this._histogramData,this._histogramSelection),this}}]),e}();return C.SelectionTypes=w,C});
//# sourceMappingURL=histogram.min.js.map
